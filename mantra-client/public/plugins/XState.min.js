(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}(g.PLUGINS || (g.PLUGINS = {})).XState = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(e){return[]},process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};

},{}],2:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _tslib=require("./_virtual/_tslib.js"),utils=require("./utils.js"),serviceScope=require("./serviceScope.js");function createNullActor(t){var e;return(e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}})[utils.symbolObservable]=function(){return this},e}function createInvocableActor(t,e,r,o){var n,c=utils.toInvokeSource(t.src),i=null===(n=null==e?void 0:e.options.services)||void 0===n?void 0:n[c.type],u=t.data?utils.mapContext(t.data,r,o):void 0,s=i?createDeferredActor(i,t.id,u):createNullActor(t.id);return s.meta=t,s}function createDeferredActor(t,e,r){var o=createNullActor(e);if(o.deferred=!0,utils.isMachine(t)){var n=o.state=serviceScope.provide(void 0,function(){return(r?t.withContext(r):t).initialState});o.getSnapshot=function(){return n}}return o}function isActor(t){try{return"function"==typeof t.send}catch(t){return!1}}function isSpawnedActor(t){return isActor(t)&&"id"in t}function toActorRef(t){var e;return _tslib.__assign(((e={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}})[utils.symbolObservable]=function(){return this},e),t)}exports.createDeferredActor=createDeferredActor,exports.createInvocableActor=createInvocableActor,exports.createNullActor=createNullActor,exports.isActor=isActor,exports.isSpawnedActor=isSpawnedActor,exports.toActorRef=toActorRef;

},{"./_virtual/_tslib.js":6,"./serviceScope.js":21,"./utils.js":24}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var StateNode=require("./StateNode.js"),environment=require("./environment.js"),warned=!1;function Machine(e,t,n){return void 0===n&&(n=e.context),new StateNode.StateNode(e,t,n)}function createMachine(e,t){return environment.IS_PRODUCTION||"predictableActionArguments"in e||warned||(warned=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new StateNode.StateNode(e,t)}exports.Machine=Machine,exports.createMachine=createMachine;

},{"./StateNode.js":5,"./environment.js":12}],4:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _tslib=require("./_virtual/_tslib.js"),constants=require("./constants.js"),utils=require("./utils.js"),stateUtils=require("./stateUtils.js"),actions=require("./actions.js"),environment=require("./environment.js");function stateValuesEqual(t,i){if(t===i)return!0;if(void 0===t||void 0===i)return!1;if(utils.isString(t)||utils.isString(i))return t===i;var e=Object.keys(t),n=Object.keys(i);return e.length===n.length&&e.every(function(e){return stateValuesEqual(t[e],i[e])})}function isStateConfig(t){return"object"==typeof t&&null!==t&&("value"in t&&"_event"in t)}var isState=isStateConfig;function bindActionToState(t,i){var e=t.exec;return _tslib.__assign(_tslib.__assign({},t),{exec:void 0!==e?function(){return e(i.context,i.event,{action:t,state:i,_event:i._event})}:void 0})}var State=function(){function t(t){var i,e=this;this.actions=[],this.activities=constants.EMPTY_ACTIVITY_MAP,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||constants.EMPTY_ACTIVITY_MAP,this.meta=stateUtils.getMeta(t.configuration),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=null!==(i=Array.isArray(t.tags)?new Set(t.tags):t.tags)&&void 0!==i?i:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return stateUtils.nextEvents(e.configuration)}})}return t.from=function(i,e){return i instanceof t?i.context!==e?new t({value:i.value,context:e,_event:i._event,_sessionid:null,historyValue:i.historyValue,history:i.history,actions:[],activities:i.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):i:new t({value:i,context:e,_event:actions.initEvent,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(i){return new t(i)},t.inert=function(i,e){if(i instanceof t){if(!i.actions.length)return i;var n=actions.initEvent;return new t({value:i.value,context:e,_event:n,_sessionid:null,historyValue:i.historyValue,history:i.history,activities:i.activities,configuration:i.configuration,transitions:[],children:{}})}return t.from(i,e)},t.prototype.toStrings=function(t,i){var e=this;if(void 0===t&&(t=this.value),void 0===i&&(i="."),utils.isString(t))return[t];var n=Object.keys(t);return n.concat.apply(n,_tslib.__spreadArray([],_tslib.__read(n.map(function(n){return e.toStrings(t[n],i).map(function(t){return n+i+t})})),!1))},t.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var i=t.tags;t.machine;var e=_tslib.__rest(t,["configuration","transitions","tags","machine"]);return _tslib.__assign(_tslib.__assign({},e),{tags:Array.from(i)})},t.prototype.matches=function(t){return utils.matchesState(t,this.value)},t.prototype.hasTag=function(t){return this.tags.has(t)},t.prototype.can=function(t){var i;environment.IS_PRODUCTION&&utils.warn(!!this.machine,"state.can(...) used outside of a machine-created State object; this will always return false.");var e=null===(i=this.machine)||void 0===i?void 0:i.getTransitionData(this,t);return!!(null==e?void 0:e.transitions.length)&&e.transitions.some(function(t){return void 0!==t.target||t.actions.length})},t}();exports.State=State,exports.bindActionToState=bindActionToState,exports.isState=isState,exports.isStateConfig=isStateConfig,exports.stateValuesEqual=stateValuesEqual;

},{"./_virtual/_tslib.js":6,"./actions.js":8,"./constants.js":10,"./environment.js":12,"./stateUtils.js":22,"./utils.js":24}],5:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _tslib=require("./_virtual/_tslib.js"),utils=require("./utils.js"),State=require("./State.js"),actionTypes=require("./actionTypes.js"),actions=require("./actions.js"),environment=require("./environment.js"),constants=require("./constants.js"),stateUtils=require("./stateUtils.js"),Actor=require("./Actor.js"),invokeUtils=require("./invokeUtils.js"),NULL_EVENT="",STATE_IDENTIFIER="#",WILDCARD="*",EMPTY_OBJECT={},isStateId=function(t){return t[0]===STATE_IDENTIFIER},createDefaultOptions=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},validateArrayifiedTransitions=function(t,i,e){var n=e.slice(0,-1).some(function(t){return!("cond"in t)&&!("in"in t)&&(utils.isString(t.target)||utils.isMachine(t.target))}),r=i===NULL_EVENT?"the transient event":"event '".concat(i,"'");utils.warn(!n,"One or more transitions for ".concat(r," on state '").concat(t.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},StateNode=function(){function t(i,e,n,r){void 0===n&&(n="context"in i?i.context:void 0);var s,a=this;this.config=i,this._context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(createDefaultOptions(),e),this.parent=null==r?void 0:r.parent,this.key=this.config.key||(null==r?void 0:r.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:constants.STATE_DELIMITER),this.id=this.config.id||_tslib.__spreadArray([this.machine.key],_tslib.__read(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:null!==(s=this.config.schema)&&void 0!==s?s:{},this.description=this.config.description,environment.IS_PRODUCTION||utils.warn(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '.concat(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '".concat(this.type,"'`")," in the config for state node '").concat(this.id,"' instead.")),this.initial=this.config.initial,this.states=this.config.states?utils.mapValues(this.config.states,function(i,e){var n,r=new t(i,{},void 0,{parent:a,key:e});return Object.assign(a.idMap,_tslib.__assign(((n={})[r.id]=r,n),r.idMap)),r}):EMPTY_OBJECT;var o=0;!function t(i){var e,n;i.order=o++;try{for(var r=_tslib.__values(stateUtils.getAllChildren(i)),s=r.next();!s.done;s=r.next())t(s.value)}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}(this),this.history=!0===this.config.history?"shallow":this.config.history||!1,this._transient=!!this.config.always||!!this.config.on&&(Array.isArray(this.config.on)?this.config.on.some(function(t){return t.event===NULL_EVENT}):NULL_EVENT in this.config.on),this.strict=!!this.config.strict,this.onEntry=utils.toArray(this.config.entry||this.config.onEntry).map(function(t){return actions.toActionObject(t)}),this.onExit=utils.toArray(this.config.exit||this.config.onExit).map(function(t){return actions.toActionObject(t)}),this.meta=this.config.meta,this.doneData="final"===this.type?this.config.data:void 0,this.invoke=utils.toArray(this.config.invoke).map(function(t,i){var e,n;if(utils.isMachine(t)){var r=utils.createInvokeId(a.id,i);return a.machine.options.services=_tslib.__assign(((e={})[r]=t,e),a.machine.options.services),invokeUtils.toInvokeDefinition({src:r,id:r})}if(utils.isString(t.src)){r=t.id||utils.createInvokeId(a.id,i);return invokeUtils.toInvokeDefinition(_tslib.__assign(_tslib.__assign({},t),{id:r,src:t.src}))}if(utils.isMachine(t.src)||utils.isFunction(t.src)){r=t.id||utils.createInvokeId(a.id,i);return a.machine.options.services=_tslib.__assign(((n={})[r]=t.src,n),a.machine.options.services),invokeUtils.toInvokeDefinition(_tslib.__assign(_tslib.__assign({id:r},t),{src:r}))}var s=t.src;return invokeUtils.toInvokeDefinition(_tslib.__assign(_tslib.__assign({id:utils.createInvokeId(a.id,i)},t),{src:s}))}),this.activities=utils.toArray(this.config.activities).concat(this.invoke).map(function(t){return actions.toActivityDefinition(t)}),this.transition=this.transition.bind(this),this.tags=utils.toArray(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||stateUtils.getAllStateNodes(this).forEach(function(t){return t.on})},t.prototype.withConfig=function(i,e){var n=this.options,r=n.actions,s=n.activities,a=n.guards,o=n.services,c=n.delays;return new t(this.config,{actions:_tslib.__assign(_tslib.__assign({},r),i.actions),activities:_tslib.__assign(_tslib.__assign({},s),i.activities),guards:_tslib.__assign(_tslib.__assign({},a),i.guards),services:_tslib.__assign(_tslib.__assign({},o),i.services),delays:_tslib.__assign(_tslib.__assign({},c),i.delays)},null!=e?e:this.context)},t.prototype.withContext=function(i){return new t(this.config,this.options,i)},Object.defineProperty(t.prototype,"context",{get:function(){return utils.isFunction(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:utils.mapValues(this.states,function(t){return t.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce(function(t,i){return t[i.eventType]=t[i.eventType]||[],t[i.eventType].push(i),t},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var i=t===NULL_EVENT,e=this.transitions.filter(function(e){var n=e.eventType===t;return i?n:n||e.eventType===WILDCARD});return this.__cache.candidates[t]=e,e},t.prototype.getDelayedTransitions=function(){var t=this,i=this.config.after;if(!i)return[];var e=function(i,e){var n=utils.isFunction(i)?"".concat(t.id,":delay[").concat(e,"]"):i,r=actions.after(n,t.id);return t.onEntry.push(actions.send(r,{delay:i})),t.onExit.push(actions.cancel(r)),r};return(utils.isArray(i)?i.map(function(t,i){var n=e(t.delay,i);return _tslib.__assign(_tslib.__assign({},t),{event:n})}):utils.flatten(Object.keys(i).map(function(t,n){var r=i[t],s=utils.isString(r)?{target:r}:r,a=isNaN(+t)?t:+t,o=e(a,n);return utils.toArray(s).map(function(t){return _tslib.__assign(_tslib.__assign({},t),{event:o,delay:a})})}))).map(function(i){var e=i.delay;return _tslib.__assign(_tslib.__assign({},t.formatTransition(i)),{delay:e})})},t.prototype.getStateNodes=function(t){var i,e=this;if(!t)return[];var n=t instanceof State.State?t.value:utils.toStateValue(t,this.delimiter);if(utils.isString(n)){var r=this.getStateNode(n).initial;return void 0!==r?this.getStateNodes(((i={})[n]=r,i)):[this,this.states[n]]}var s=Object.keys(n),a=[this];return a.push.apply(a,_tslib.__spreadArray([],_tslib.__read(utils.flatten(s.map(function(t){return e.getStateNode(t).getStateNodes(n[t])}))),!1)),a},t.prototype.handles=function(t){var i=utils.getEventType(t);return this.events.includes(i)},t.prototype.resolveState=function(t){var i=t instanceof State.State?t:State.State.create(t),e=Array.from(stateUtils.getConfiguration([],this.getStateNodes(i.value)));return new State.State(_tslib.__assign(_tslib.__assign({},i),{value:this.resolve(i.value),configuration:e,done:stateUtils.isInFinalState(e,this),tags:stateUtils.getTagsFromConfiguration(e),machine:this.machine}))},t.prototype.transitionLeafNode=function(t,i,e){var n=this.getStateNode(t).next(i,e);return n&&n.transitions.length?n:this.next(i,e)},t.prototype.transitionCompoundNode=function(t,i,e){var n=Object.keys(t),r=this.getStateNode(n[0])._transition(t[n[0]],i,e);return r&&r.transitions.length?r:this.next(i,e)},t.prototype.transitionParallelNode=function(t,i,e){var n,r,s={};try{for(var a=_tslib.__values(Object.keys(t)),o=a.next();!o.done;o=a.next()){var c=o.value,l=t[c];if(l){var u=this.getStateNode(c)._transition(l,i,e);u&&(s[c]=u)}}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}var h=Object.keys(s).map(function(t){return s[t]}),f=utils.flatten(h.map(function(t){return t.transitions}));if(!h.some(function(t){return t.transitions.length>0}))return this.next(i,e);var d=utils.flatten(Object.keys(s).map(function(t){return s[t].configuration}));return{transitions:f,exitSet:utils.flatten(h.map(function(t){return t.exitSet})),configuration:d,source:i,actions:utils.flatten(Object.keys(s).map(function(t){return s[t].actions}))}},t.prototype._transition=function(t,i,e){return utils.isString(t)?this.transitionLeafNode(t,i,e):1===Object.keys(t).length?this.transitionCompoundNode(t,i,e):this.transitionParallelNode(t,i,e)},t.prototype.getTransitionData=function(t,i){return this._transition(t.value,t,utils.toSCXMLEvent(i))},t.prototype.next=function(t,i){var e,n,r,s=this,a=i.name,o=[],c=[];try{for(var l=_tslib.__values(this.getCandidates(a)),u=l.next();!u.done;u=l.next()){var h=u.value,f=h.cond,d=h.in,_=t.context,p=!d||(utils.isString(d)&&isStateId(d)?t.matches(utils.toStateValue(this.getStateNodeById(d).path,this.delimiter)):utils.matchesState(utils.toStateValue(d,this.delimiter),utils.path(this.path.slice(0,-2))(t.value))),v=!1;try{v=!f||utils.evaluateGuard(this.machine,f,_,i,t)}catch(t){throw new Error("Unable to evaluate guard '".concat(f.name||f.type,"' in transition for event '").concat(a,"' in state node '").concat(this.id,"':\n").concat(t.message))}if(v&&p){void 0!==h.target&&(c=h.target),o.push.apply(o,_tslib.__spreadArray([],_tslib.__read(h.actions),!1)),r=h;break}}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}if(r){if(!c.length)return{transitions:[r],exitSet:[],configuration:t.value?[this]:[],source:t,actions:o};var y=utils.flatten(c.map(function(i){return s.getRelativeStateNodes(i,t.historyValue)}));return{transitions:[r],exitSet:!!r.internal?[]:utils.flatten(c.map(function(t){return s.getPotentiallyReenteringNodes(t)})),configuration:y,source:t,actions:o}}},t.prototype.getPotentiallyReenteringNodes=function(t){if(this.order<t.order)return[this];for(var i=[],e=this,n=t;e&&e!==n;)i.push(e),e=e.parent;return e!==n?[]:(i.push(n),i)},t.prototype.getActions=function(t,i,e,n,r,s,a){var o,c,l,u,h=this,f=s?stateUtils.getConfiguration([],this.getStateNodes(s.value)):[],d=new Set;try{for(var _=_tslib.__values(Array.from(t).sort(function(t,i){return t.order-i.order})),p=_.next();!p.done;p=_.next()){var v=p.value;(!stateUtils.has(f,v)||stateUtils.has(e.exitSet,v)||v.parent&&d.has(v.parent))&&d.add(v)}}catch(t){o={error:t}}finally{try{p&&!p.done&&(c=_.return)&&c.call(_)}finally{if(o)throw o.error}}try{for(var y=_tslib.__values(f),g=y.next();!g.done;g=y.next()){v=g.value;stateUtils.has(t,v)&&!stateUtils.has(e.exitSet,v.parent)||e.exitSet.push(v)}}catch(t){l={error:t}}finally{try{g&&!g.done&&(u=y.return)&&u.call(y)}finally{if(l)throw l.error}}e.exitSet.sort(function(t,i){return i.order-t.order});var m=Array.from(d).sort(function(t,i){return t.order-i.order}),b=new Set(e.exitSet),S=utils.flatten(m.map(function(t){var i=[];if("final"!==t.type)return i;var s=t.parent;if(!s.parent)return i;i.push(actions.done(t.id,t.doneData),actions.done(s.id,t.doneData?utils.mapContext(t.doneData,n,r):void 0));var a=s.parent;return"parallel"===a.type&&stateUtils.getChildren(a).every(function(t){return stateUtils.isInFinalState(e.configuration,t)})&&i.push(actions.done(a.id)),i})),T=m.map(function(t){var i=t.onEntry,e=t.activities.map(function(t){return actions.start(t)});return{type:"entry",actions:actions.toActionObjects(a?_tslib.__spreadArray(_tslib.__spreadArray([],_tslib.__read(i),!1),_tslib.__read(e),!1):_tslib.__spreadArray(_tslib.__spreadArray([],_tslib.__read(e),!1),_tslib.__read(i),!1),h.machine.options.actions)}}).concat({type:"state_done",actions:S.map(function(t){return actions.raise(t)})}),A=Array.from(b).map(function(t){return{type:"exit",actions:actions.toActionObjects(_tslib.__spreadArray(_tslib.__spreadArray([],_tslib.__read(t.onExit),!1),_tslib.__read(t.activities.map(function(t){return actions.stop(t)})),!1),h.machine.options.actions)}}).concat({type:"transition",actions:actions.toActionObjects(e.actions,this.machine.options.actions)}).concat(T);if(i){var E=actions.toActionObjects(utils.flatten(_tslib.__spreadArray([],_tslib.__read(t),!1).sort(function(t,i){return i.order-t.order}).map(function(t){return t.onExit})),this.machine.options.actions).filter(function(t){return!utils.isRaisableAction(t)});return A.concat({type:"stop",actions:E})}return A},t.prototype.transition=function(t,i,e,n){void 0===t&&(t=this.initialState);var r,s=utils.toSCXMLEvent(i);if(t instanceof State.State)r=void 0===e?t:this.resolveState(State.State.from(t,e));else{var a=utils.isString(t)?this.resolve(utils.pathToStateValue(this.getResolvedPath(t))):this.resolve(t),o=null!=e?e:this.machine.context;r=this.resolveState(State.State.from(a,o))}if(!environment.IS_PRODUCTION&&s.name===WILDCARD)throw new Error("An event cannot have the wildcard type ('".concat(WILDCARD,"')"));if(this.strict&&!this.events.includes(s.name)&&!utils.isBuiltInEvent(s.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(s.name,"'"));var c=this._transition(r.value,r,s)||{transitions:[],configuration:[],exitSet:[],source:r,actions:[]},l=stateUtils.getConfiguration([],this.getStateNodes(r.value)),u=c.configuration.length?stateUtils.getConfiguration(l,c.configuration):l;return c.configuration=_tslib.__spreadArray([],_tslib.__read(u),!1),this.resolveTransition(c,r,r.context,n,s)},t.prototype.resolveRaisedTransition=function(t,i,e,n){var r,s=t.actions;return(t=this.transition(t,i,void 0,n))._event=e,t.event=e.data,(r=t.actions).unshift.apply(r,_tslib.__spreadArray([],_tslib.__read(s),!1)),t},t.prototype.resolveTransition=function(t,i,e,n,r){var s,a,o,c,l=this;void 0===r&&(r=actions.initEvent);var u=t.configuration,h=!i||t.transitions.length>0,f=h?t.configuration:i?i.configuration:[],d=stateUtils.isInFinalState(f,this),_=h?stateUtils.getValue(this.machine,u):void 0,p=i?i.historyValue?i.historyValue:t.source?this.machine.historyValue(i.value):void 0:void 0,v=this.getActions(new Set(f),d,t,e,r,i,n),y=i?_tslib.__assign({},i.activities):{};try{for(var g=_tslib.__values(v),m=g.next();!m.done;m=g.next()){var b=m.value;try{for(var S=(o=void 0,_tslib.__values(b.actions)),T=S.next();!T.done;T=S.next()){var A=T.value;A.type===actionTypes.start?y[A.activity.id||A.activity.type]=A:A.type===actionTypes.stop&&(y[A.activity.id||A.activity.type]=!1)}}catch(t){o={error:t}}finally{try{T&&!T.done&&(c=S.return)&&c.call(S)}finally{if(o)throw o.error}}}}catch(t){s={error:t}}finally{try{m&&!m.done&&(a=g.return)&&a.call(g)}finally{if(s)throw s.error}}var E=_tslib.__read(actions.resolveActions(this,i,e,r,v,n,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),N=E[0],x=E[1],I=_tslib.__read(utils.partition(N,utils.isRaisableAction),2),w=I[0],O=I[1],k=N.filter(function(t){var i;return t.type===actionTypes.start&&(null===(i=t.activity)||void 0===i?void 0:i.type)===actionTypes.invoke}).reduce(function(t,i){return t[i.activity.id]=Actor.createInvocableActor(i.activity,l.machine,x,r),t},i?_tslib.__assign({},i.children):{}),P=new State.State({value:_||i.value,context:x,_event:r,_sessionid:i?i._sessionid:null,historyValue:_?p?utils.updateHistoryValue(p,_):void 0:i?i.historyValue:void 0,history:!_||t.source?i:void 0,actions:_?O:[],activities:_?y:i?i.activities:{},events:[],configuration:f,transitions:t.transitions,children:k,done:d,tags:stateUtils.getTagsFromConfiguration(f),machine:this}),C=e!==x;P.changed=r.name===actionTypes.update||C;var j=P.history;j&&delete j.history;var V=!d&&(this._transient||u.some(function(t){return t._transient}));if(!(h||V&&r.name!==NULL_EVENT))return P;var D=P;if(!d)for(V&&(D=this.resolveRaisedTransition(D,{type:actionTypes.nullEvent},r,n));w.length;){var U=w.shift();D=this.resolveRaisedTransition(D,U._event,r,n)}var R=D.changed||(j?!!D.actions.length||C||typeof j.value!=typeof D.value||!State.stateValuesEqual(D.value,j.value):void 0);return D.changed=R,D.history=j,D},t.prototype.getStateNode=function(t){if(isStateId(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var i=this.states[t];if(!i)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return i},t.prototype.getStateNodeById=function(t){var i=isStateId(t)?t.slice(STATE_IDENTIFIER.length):t;if(i===this.id)return this;var e=this.machine.idMap[i];if(!e)throw new Error("Child state node '#".concat(i,"' does not exist on machine '").concat(this.id,"'"));return e},t.prototype.getStateNodeByPath=function(t){if("string"==typeof t&&isStateId(t))try{return this.getStateNodeById(t.slice(1))}catch(t){}for(var i=utils.toStatePath(t,this.delimiter).slice(),e=this;i.length;){var n=i.shift();if(!n.length)break;e=e.getStateNode(n)}return e},t.prototype.resolve=function(t){var i,e=this;if(!t)return this.initialStateValue||EMPTY_OBJECT;switch(this.type){case"parallel":return utils.mapValues(this.initialStateValue,function(i,n){return i?e.getStateNode(n).resolve(t[n]||i):EMPTY_OBJECT});case"compound":if(utils.isString(t)){var n=this.getStateNode(t);return"parallel"===n.type||"compound"===n.type?((i={})[t]=n.initialStateValue,i):t}return Object.keys(t).length?utils.mapValues(t,function(t,i){return t?e.getStateNode(i).resolve(t):EMPTY_OBJECT}):this.initialStateValue||{};default:return t||EMPTY_OBJECT}},t.prototype.getResolvedPath=function(t){if(isStateId(t)){var i=this.machine.idMap[t.slice(STATE_IDENTIFIER.length)];if(!i)throw new Error("Unable to find state node '".concat(t,"'"));return i.path}return utils.toStatePath(t,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var t,i;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;if("parallel"===this.type)i=utils.mapFilterValues(this.states,function(t){return t.initialStateValue||EMPTY_OBJECT},function(t){return!("history"===t.type)});else if(void 0!==this.initial){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));i=stateUtils.isLeafNode(this.states[this.initial])?this.initial:((t={})[this.initial]=this.states[this.initial].initialStateValue,t)}else i={};return this.__cache.initialStateValue=i,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(t,i){this._init();var e=this.getStateNodes(t);return this.resolveTransition({configuration:e,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,null!=i?i:this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var t;if("history"===this.type){var i=this.config;t=utils.isString(i.target)&&isStateId(i.target)?utils.pathToStateValue(this.machine.getStateNodeById(i.target).path.slice(this.path.length-1)):i.target}return t},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(t,i,e){return void 0===e&&(e=!0),e?"history"===t.type?t.resolveHistory(i):t.initialStateNodes:[t]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var t=this;if(stateUtils.isLeafNode(this))return[this];if("compound"===this.type&&!this.initial)return environment.IS_PRODUCTION||utils.warn(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var i=utils.toStatePaths(this.initialStateValue);return utils.flatten(i.map(function(i){return t.getFromRelativePath(i)}))},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var i=_tslib.__read(t),e=i[0],n=i.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(e,"' from node with no states"));var r=this.getStateNode(e);if("history"===r.type)return r.resolveHistory();if(!this.states[e])throw new Error("Child state '".concat(e,"' does not exist on '").concat(this.id,"'"));return this.states[e].getFromRelativePath(n)},t.prototype.historyValue=function(t){if(Object.keys(this.states).length)return{current:t||this.initialStateValue,states:utils.mapFilterValues(this.states,function(i,e){if(!t)return i.historyValue();var n=utils.isString(t)?void 0:t[e];return i.historyValue(n||i.initialStateValue)},function(t){return!t.history})}},t.prototype.resolveHistory=function(t){var i=this;if("history"!==this.type)return[this];var e=this.parent;if(!t){var n=this.target;return n?utils.flatten(utils.toStatePaths(n).map(function(t){return e.getFromRelativePath(t)})):e.initialStateNodes}var r=utils.nestedPath(e.path,"states")(t).current;return utils.isString(r)?[e.getStateNode(r)]:utils.flatten(utils.toStatePaths(r).map(function(t){return"deep"===i.history?e.getFromRelativePath(t):[e.states[t[0]]]}))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var t=this,i=utils.flatten(Object.keys(this.states).map(function(i){return t.states[i].stateIds}));return[this.id].concat(i)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var t,i,e,n;if(this.__cache.events)return this.__cache.events;var r=this.states,s=new Set(this.ownEvents);if(r)try{for(var a=_tslib.__values(Object.keys(r)),o=a.next();!o.done;o=a.next()){var c=r[o.value];if(c.states)try{for(var l=(e=void 0,_tslib.__values(c.events)),u=l.next();!u.done;u=l.next()){var h=u.value;s.add("".concat(h))}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}}}catch(i){t={error:i}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(s)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter(function(t){return!(!t.target&&!t.actions.length&&t.internal)}).map(function(t){return t.eventType}));return Array.from(t)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(t){var i=this;if(void 0!==t)return t.map(function(t){if(!utils.isString(t))return t;var e=t[0]===i.delimiter;if(e&&!i.parent)return i.getStateNodeByPath(t.slice(1));var n=e?i.key+t:t;if(!i.parent)return i.getStateNodeByPath(n);try{return i.parent.getStateNodeByPath(n)}catch(t){throw new Error("Invalid transition definition for state node '".concat(i.id,"':\n").concat(t.message))}})},t.prototype.formatTransition=function(t){var i=this,e=utils.normalizeTarget(t.target),n="internal"in t?t.internal:!e||e.some(function(t){return utils.isString(t)&&t[0]===i.delimiter}),r=this.machine.options.guards,s=this.resolveTarget(e),a=_tslib.__assign(_tslib.__assign({},t),{actions:actions.toActionObjects(utils.toArray(t.actions)),cond:utils.toGuard(t.cond,r),target:s,source:this,internal:n,eventType:t.event,toJSON:function(){return _tslib.__assign(_tslib.__assign({},a),{target:a.target?a.target.map(function(t){return"#".concat(t.id)}):void 0,source:"#".concat(i.id)})}});return a},t.prototype.formatTransitions=function(){var t,i,e,n=this;if(this.config.on)if(Array.isArray(this.config.on))e=this.config.on;else{var r=this.config.on,s=WILDCARD,a=r[s],o=void 0===a?[]:a,c=_tslib.__rest(r,["symbol"==typeof s?s:s+""]);e=utils.flatten(Object.keys(c).map(function(t){environment.IS_PRODUCTION||t!==NULL_EVENT||utils.warn(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(n.id,'".'));var i=utils.toTransitionConfigArray(t,c[t]);return environment.IS_PRODUCTION||validateArrayifiedTransitions(n,t,i),i}).concat(utils.toTransitionConfigArray(WILDCARD,o)))}else e=[];var l=this.config.always?utils.toTransitionConfigArray("",this.config.always):[],u=this.config.onDone?utils.toTransitionConfigArray(String(actions.done(this.id)),this.config.onDone):[];environment.IS_PRODUCTION||utils.warn(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var h=utils.flatten(this.invoke.map(function(t){var i=[];return t.onDone&&i.push.apply(i,_tslib.__spreadArray([],_tslib.__read(utils.toTransitionConfigArray(String(actions.doneInvoke(t.id)),t.onDone)),!1)),t.onError&&i.push.apply(i,_tslib.__spreadArray([],_tslib.__read(utils.toTransitionConfigArray(String(actions.error(t.id)),t.onError)),!1)),i})),f=this.after,d=utils.flatten(_tslib.__spreadArray(_tslib.__spreadArray(_tslib.__spreadArray(_tslib.__spreadArray([],_tslib.__read(u),!1),_tslib.__read(h),!1),_tslib.__read(e),!1),_tslib.__read(l),!1).map(function(t){return utils.toArray(t).map(function(t){return n.formatTransition(t)})}));try{for(var _=_tslib.__values(f),p=_.next();!p.done;p=_.next()){var v=p.value;d.push(v)}}catch(i){t={error:i}}finally{try{p&&!p.done&&(i=_.return)&&i.call(_)}finally{if(t)throw t.error}}return d},t}();exports.StateNode=StateNode;

},{"./Actor.js":2,"./State.js":4,"./_virtual/_tslib.js":6,"./actionTypes.js":7,"./actions.js":8,"./constants.js":10,"./environment.js":12,"./invokeUtils.js":15,"./stateUtils.js":22,"./utils.js":24}],6:[function(require,module,exports){
"use strict";function __rest(r,e){var t={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&e.indexOf(o)<0&&(t[o]=r[o]);if(null!=r&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(r);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(r,o[n])&&(t[o[n]]=r[o[n]])}return t}function __values(r){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&r[e],o=0;if(t)return t.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&o>=r.length&&(r=void 0),{value:r&&r[o++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(r,e){var t="function"==typeof Symbol&&r[Symbol.iterator];if(!t)return r;var o,n,a=t.call(r),l=[];try{for(;(void 0===e||e-- >0)&&!(o=a.next()).done;)l.push(o.value)}catch(r){n={error:r}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(n)throw n.error}}return l}function __spreadArray(r,e,t){if(t||2===arguments.length)for(var o,n=0,a=e.length;n<a;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.__assign=function(){return exports.__assign=Object.assign||function(r){for(var e,t=1,o=arguments.length;t<o;t++)for(var n in e=arguments[t])Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},exports.__assign.apply(this,arguments)},exports.__read=__read,exports.__rest=__rest,exports.__spreadArray=__spreadArray,exports.__values=__values;

},{}],7:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var types=require("./types.js"),start=types.ActionTypes.Start,stop=types.ActionTypes.Stop,raise=types.ActionTypes.Raise,send=types.ActionTypes.Send,cancel=types.ActionTypes.Cancel,nullEvent=types.ActionTypes.NullEvent,assign=types.ActionTypes.Assign,after=types.ActionTypes.After,doneState=types.ActionTypes.DoneState,log=types.ActionTypes.Log,init=types.ActionTypes.Init,invoke=types.ActionTypes.Invoke,errorExecution=types.ActionTypes.ErrorExecution,errorPlatform=types.ActionTypes.ErrorPlatform,error=types.ActionTypes.ErrorCustom,update=types.ActionTypes.Update,choose=types.ActionTypes.Choose,pure=types.ActionTypes.Pure;exports.after=after,exports.assign=assign,exports.cancel=cancel,exports.choose=choose,exports.doneState=doneState,exports.error=error,exports.errorExecution=errorExecution,exports.errorPlatform=errorPlatform,exports.init=init,exports.invoke=invoke,exports.log=log,exports.nullEvent=nullEvent,exports.pure=pure,exports.raise=raise,exports.send=send,exports.start=start,exports.stop=stop,exports.update=update;

},{"./types.js":23}],8:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _tslib=require("./_virtual/_tslib.js"),types=require("./types.js"),actionTypes=require("./actionTypes.js"),utils=require("./utils.js"),environment=require("./environment.js"),initEvent=utils.toSCXMLEvent({type:actionTypes.init});function getActionFunction(t,e){return e&&e[t]||void 0}function toActionObject(t,e){var n;if(utils.isString(t)||"number"==typeof t){var i=getActionFunction(t,e);n=utils.isFunction(i)?{type:t,exec:i}:i||{type:t,exec:void 0}}else if(utils.isFunction(t))n={type:t.name||t.toString(),exec:t};else{i=getActionFunction(t.type,e);if(utils.isFunction(i))n=_tslib.__assign(_tslib.__assign({},t),{exec:i});else if(i){var s=i.type||t.type;n=_tslib.__assign(_tslib.__assign(_tslib.__assign({},i),t),{type:s})}else n=t}return n}var toActionObjects=function(t,e){return t?(utils.isArray(t)?t:[t]).map(function(t){return toActionObject(t,e)}):[]};function toActivityDefinition(t){var e=toActionObject(t);return _tslib.__assign(_tslib.__assign({id:utils.isString(t)?t:e.id},e),{type:e.type})}function raise(t,e){return{type:actionTypes.raise,event:"function"==typeof t?t:utils.toEventObject(t),delay:e?e.delay:void 0,id:null==e?void 0:e.id}}function resolveRaise(t,e,n,i){var s,o={_event:n},r=utils.toSCXMLEvent(utils.isFunction(t.event)?t.event(e,n.data,o):t.event);if(utils.isString(t.delay)){var a=i&&i[t.delay];s=utils.isFunction(a)?a(e,n.data,o):a}else s=utils.isFunction(t.delay)?t.delay(e,n.data,o):t.delay;return _tslib.__assign(_tslib.__assign({},t),{type:actionTypes.raise,_event:r,delay:s})}function send(t,e){return{to:e?e.to:void 0,type:actionTypes.send,event:utils.isFunction(t)?t:utils.toEventObject(t),delay:e?e.delay:void 0,id:e&&void 0!==e.id?e.id:utils.isFunction(t)?t.name:utils.getEventType(t)}}function resolveSend(t,e,n,i){var s,o={_event:n},r=utils.toSCXMLEvent(utils.isFunction(t.event)?t.event(e,n.data,o):t.event);if(utils.isString(t.delay)){var a=i&&i[t.delay];s=utils.isFunction(a)?a(e,n.data,o):a}else s=utils.isFunction(t.delay)?t.delay(e,n.data,o):t.delay;var c=utils.isFunction(t.to)?t.to(e,n.data,o):t.to;return _tslib.__assign(_tslib.__assign({},t),{to:c,_event:r,event:r.data,delay:s})}function sendParent(t,e){return send(t,_tslib.__assign(_tslib.__assign({},e),{to:types.SpecialTargets.Parent}))}function sendTo(t,e,n){return send(e,_tslib.__assign(_tslib.__assign({},n),{to:t}))}function sendUpdate(){return sendParent(actionTypes.update)}function respond(t,e){return send(t,_tslib.__assign(_tslib.__assign({},e),{to:function(t,e,n){return n._event.origin}}))}var defaultLogExpr=function(t,e){return{context:t,event:e}};function log(t,e){return void 0===t&&(t=defaultLogExpr),{type:actionTypes.log,label:e,expr:t}}var resolveLog=function(t,e,n){return _tslib.__assign(_tslib.__assign({},t),{value:utils.isString(t.expr)?t.expr:t.expr(e,n.data,{_event:n})})},cancel=function(t){return{type:actionTypes.cancel,sendId:t}};function start(t){var e=toActivityDefinition(t);return{type:types.ActionTypes.Start,activity:e,exec:void 0}}function stop(t){var e=utils.isFunction(t)?t:toActivityDefinition(t);return{type:types.ActionTypes.Stop,activity:e,exec:void 0}}function resolveStop(t,e,n){var i=utils.isFunction(t.activity)?t.activity(e,n.data):t.activity,s="string"==typeof i?{id:i}:i;return{type:types.ActionTypes.Stop,activity:s}}var assign=function(t){return{type:actionTypes.assign,assignment:t}};function isActionObject(t){return"object"==typeof t&&"type"in t}function after(t,e){var n=e?"#".concat(e):"";return"".concat(types.ActionTypes.After,"(").concat(t,")").concat(n)}function done(t,e){var n="".concat(types.ActionTypes.DoneState,".").concat(t),i={type:n,data:e,toString:function(){return n}};return i}function doneInvoke(t,e){var n="".concat(types.ActionTypes.DoneInvoke,".").concat(t),i={type:n,data:e,toString:function(){return n}};return i}function error(t,e){var n="".concat(types.ActionTypes.ErrorPlatform,".").concat(t),i={type:n,data:e,toString:function(){return n}};return i}function pure(t){return{type:types.ActionTypes.Pure,get:t}}function forwardTo(t,e){if(!(environment.IS_PRODUCTION||t&&"function"!=typeof t)){var n=t;t=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i="function"==typeof n?n.apply(void 0,_tslib.__spreadArray([],_tslib.__read(t),!1)):n;if(!i)throw new Error("Attempted to forward event to undefined actor. This risks an infinite loop in the sender.");return i}}return send(function(t,e){return e},_tslib.__assign(_tslib.__assign({},e),{to:t}))}function escalate(t,e){return sendParent(function(e,n,i){return{type:actionTypes.error,data:utils.isFunction(t)?t(e,n,i):t}},_tslib.__assign(_tslib.__assign({},e),{to:types.SpecialTargets.Parent}))}function choose(t){return{type:types.ActionTypes.Choose,conds:t}}var pluckAssigns=function(t){var e,n,i=[];try{for(var s=_tslib.__values(t),o=s.next();!o.done;o=s.next())for(var r=o.value,a=0;a<r.actions.length;)r.actions[a].type!==actionTypes.assign?a++:(i.push(r.actions[a]),r.actions.splice(a,1))}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return i};function resolveActions(t,e,n,i,s,o,r){void 0===r&&(r=!1);var a=r?[]:pluckAssigns(s),c=a.length?utils.updateContext(n,i,a,e):n,u=r?[n]:void 0,l=[];function p(s,a){var p;switch(a.type){case actionTypes.raise:var d=resolveRaise(a,c,i,t.options.delays);return o&&"number"==typeof d.delay&&o(d,c,i),d;case actionTypes.send:var v=resolveSend(a,c,i,t.options.delays);if(!environment.IS_PRODUCTION){var y=a.delay;utils.warn(!utils.isString(y)||"number"==typeof v.delay,"No delay reference for delay expression '".concat(y,"' was found on machine '").concat(t.id,"'"))}return o&&v.to!==types.SpecialTargets.Internal&&("entry"===s?l.push(v):o(v,c,i)),v;case actionTypes.log:var _=resolveLog(a,c,i);return null==o||o(_,c,i),_;case actionTypes.choose:if(!(x=null===(p=a.conds.find(function(n){var s=utils.toGuard(n.cond,t.options.guards);return!s||utils.evaluateGuard(t,s,c,i,o?void 0:e)}))||void 0===p?void 0:p.actions))return[];var f=_tslib.__read(resolveActions(t,e,c,i,[{type:s,actions:toActionObjects(utils.toArray(x),t.options.actions)}],o,r),2),g=f[0],b=f[1];return c=b,null==u||u.push(c),g;case actionTypes.pure:var x;if(!(x=a.get(c,i.data)))return[];var A=_tslib.__read(resolveActions(t,e,c,i,[{type:s,actions:toActionObjects(utils.toArray(x),t.options.actions)}],o,r),2),T=A[0],S=A[1];return c=S,null==u||u.push(c),T;case actionTypes.stop:_=resolveStop(a,c,i);return null==o||o(_,n,i),_;case actionTypes.assign:c=utils.updateContext(c,i,[a],o?void 0:e),null==u||u.push(c);break;default:var h=toActionObject(a,t.options.actions),j=h.exec;if(o)o(h,c,i);else if(j&&u){var O=u.length-1;h=_tslib.__assign(_tslib.__assign({},h),{exec:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];j.apply(void 0,_tslib.__spreadArray([u[O]],_tslib.__read(e),!1))}})}return h}}return[utils.flatten(s.map(function(t){var e,n,s=[];try{for(var r=_tslib.__values(t.actions),a=r.next();!a.done;a=r.next()){var u=a.value,d=p(t.type,u);d&&(s=s.concat(d))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return l.forEach(function(t){o(t,c,i)}),l.length=0,s})),c]}exports.actionTypes=actionTypes,exports.after=after,exports.assign=assign,exports.cancel=cancel,exports.choose=choose,exports.done=done,exports.doneInvoke=doneInvoke,exports.error=error,exports.escalate=escalate,exports.forwardTo=forwardTo,exports.getActionFunction=getActionFunction,exports.initEvent=initEvent,exports.isActionObject=isActionObject,exports.log=log,exports.pure=pure,exports.raise=raise,exports.resolveActions=resolveActions,exports.resolveLog=resolveLog,exports.resolveRaise=resolveRaise,exports.resolveSend=resolveSend,exports.resolveStop=resolveStop,exports.respond=respond,exports.send=send,exports.sendParent=sendParent,exports.sendTo=sendTo,exports.sendUpdate=sendUpdate,exports.start=start,exports.stop=stop,exports.toActionObject=toActionObject,exports.toActionObjects=toActionObjects,exports.toActivityDefinition=toActivityDefinition;

},{"./_virtual/_tslib.js":6,"./actionTypes.js":7,"./environment.js":12,"./types.js":23,"./utils.js":24}],9:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var actions=require("./actions.js"),Actor=require("./Actor.js"),utils=require("./utils.js");function fromReducer(r,e){return{transition:r,initialState:e}}function fromPromise(r){var e={error:void 0,data:void 0,status:"pending"};return{transition:function(r,e,t){var n=t.parent,o=t.id,i=t.observers;switch(e.type){case"fulfill":return null==n||n.send(actions.doneInvoke(o,e.data)),{error:void 0,data:e.data,status:"fulfilled"};case"reject":return null==n||n.send(actions.error(o,e.error)),i.forEach(function(r){r.error(e.error)}),{error:e.error,data:void 0,status:"rejected"};default:return r}},initialState:e,start:function(t){var n=t.self;return r().then(function(r){n.send({type:"fulfill",data:r})},function(r){n.send({type:"reject",error:r})}),e}}}function spawnBehavior(r,e){void 0===e&&(e={});var t=r.initialState,n=new Set,o=[],i=!1,s=Actor.toActorRef({id:e.id,send:function(e){o.push(e),function(){if(!i){for(i=!0;o.length>0;){var e=o.shift();t=r.transition(t,e,a),n.forEach(function(r){return r.next(t)})}i=!1}}()},getSnapshot:function(){return t},subscribe:function(r,e,o){var i=utils.toObserver(r,e,o);return n.add(i),i.next(t),{unsubscribe:function(){n.delete(i)}}}}),a={parent:e.parent,self:s,id:e.id||"anonymous",observers:n};return t=r.start?r.start(a):t,s}exports.fromPromise=fromPromise,exports.fromReducer=fromReducer,exports.spawnBehavior=spawnBehavior;

},{"./Actor.js":2,"./actions.js":8,"./utils.js":24}],10:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var STATE_DELIMITER=".",EMPTY_ACTIVITY_MAP={},DEFAULT_GUARD_TYPE="xstate.guard",TARGETLESS_KEY="";exports.DEFAULT_GUARD_TYPE=DEFAULT_GUARD_TYPE,exports.EMPTY_ACTIVITY_MAP=EMPTY_ACTIVITY_MAP,exports.STATE_DELIMITER=STATE_DELIMITER,exports.TARGETLESS_KEY=TARGETLESS_KEY;

},{}],11:[function(require,module,exports){
(function (global){(function (){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment=require("./environment.js");function getGlobal(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void(environment.IS_PRODUCTION||console.warn("XState could not find a global object in this environment. Please let the maintainers know and raise an issue here: https://github.com/statelyai/xstate/issues"))}function getDevTools(){var e=getGlobal();if(e&&"__xstate__"in e)return e.__xstate__}function registerService(e){if(getGlobal()){var t=getDevTools();t&&t.register(e)}}exports.getGlobal=getGlobal,exports.registerService=registerService;

}).call(this)}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./environment.js":12}],12:[function(require,module,exports){
(function (process){(function (){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var IS_PRODUCTION="production"===process.env.NODE_ENV;exports.IS_PRODUCTION=IS_PRODUCTION;

}).call(this)}).call(this,require('_process'))
},{"_process":1}],13:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var actions=require("./actions.js"),Actor=require("./Actor.js"),interpreter=require("./interpreter.js"),Machine=require("./Machine.js"),mapState=require("./mapState.js"),match=require("./match.js"),schema=require("./schema.js"),State=require("./State.js"),StateNode=require("./StateNode.js"),behaviors=require("./behaviors.js"),types=require("./types.js"),utils=require("./utils.js"),assign=actions.assign,cancel=actions.cancel,send=actions.send,sendTo=actions.sendTo,sendParent=actions.sendParent,sendUpdate=actions.sendUpdate,forwardTo=actions.forwardTo,doneInvoke=actions.doneInvoke,raise=actions.raise,log=actions.log,pure=actions.pure,choose=actions.choose,stop=actions.stop;exports.actions=actions,exports.toActorRef=Actor.toActorRef,exports.Interpreter=interpreter.Interpreter,Object.defineProperty(exports,"InterpreterStatus",{enumerable:!0,get:function(){return interpreter.InterpreterStatus}}),exports.interpret=interpreter.interpret,exports.spawn=interpreter.spawn,exports.Machine=Machine.Machine,exports.createMachine=Machine.createMachine,exports.mapState=mapState.mapState,exports.matchState=match.matchState,exports.createSchema=schema.createSchema,exports.t=schema.t,exports.State=State.State,exports.StateNode=StateNode.StateNode,exports.spawnBehavior=behaviors.spawnBehavior,Object.defineProperty(exports,"ActionTypes",{enumerable:!0,get:function(){return types.ActionTypes}}),Object.defineProperty(exports,"SpecialTargets",{enumerable:!0,get:function(){return types.SpecialTargets}}),exports.matchesState=utils.matchesState,exports.toEventObject=utils.toEventObject,exports.toObserver=utils.toObserver,exports.toSCXMLEvent=utils.toSCXMLEvent,exports.assign=assign,exports.cancel=cancel,exports.choose=choose,exports.doneInvoke=doneInvoke,exports.forwardTo=forwardTo,exports.log=log,exports.pure=pure,exports.raise=raise,exports.send=send,exports.sendParent=sendParent,exports.sendTo=sendTo,exports.sendUpdate=sendUpdate,exports.stop=stop;

},{"./Actor.js":2,"./Machine.js":3,"./State.js":4,"./StateNode.js":5,"./actions.js":8,"./behaviors.js":9,"./interpreter.js":14,"./mapState.js":16,"./match.js":17,"./schema.js":20,"./types.js":23,"./utils.js":24}],14:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _tslib=require("./_virtual/_tslib.js"),types=require("./types.js"),State=require("./State.js"),actionTypes=require("./actionTypes.js"),actions=require("./actions.js"),environment=require("./environment.js"),utils=require("./utils.js"),scheduler=require("./scheduler.js"),Actor=require("./Actor.js"),registry=require("./registry.js"),devTools=require("./devTools.js"),serviceScope=require("./serviceScope.js"),behaviors=require("./behaviors.js"),DEFAULT_SPAWN_OPTIONS={sync:!1,autoForward:!1};exports.InterpreterStatus=void 0,function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"}(exports.InterpreterStatus||(exports.InterpreterStatus={}));var Interpreter=function(){function t(e,i){void 0===i&&(i=t.defaultOptions);var n=this;this.machine=e,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=exports.InterpreterStatus.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(t,e){if(utils.isArray(t))return n.batch(t),n.state;var i=utils.toSCXMLEvent(utils.toEventObject(t,e));if(n.status===exports.InterpreterStatus.Stopped)return environment.IS_PRODUCTION||utils.warn(!1,'Event "'.concat(i.name,'" was sent to stopped service "').concat(n.machine.id,'". This service has already reached its final state, and will not transition.\nEvent: ').concat(JSON.stringify(i.data))),n.state;if(n.status!==exports.InterpreterStatus.Running&&!n.options.deferEvents)throw new Error('Event "'.concat(i.name,'" was sent to uninitialized service "').concat(n.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\nEvent: ').concat(JSON.stringify(i.data)));return n.scheduler.schedule(function(){n.forward(i);var t=n._nextState(i);n.update(t,i)}),n._state},this.sendTo=function(t,e,i){var r=n.parent&&(e===types.SpecialTargets.Parent||n.parent.id===e),s=r?n.parent:utils.isString(e)?e===types.SpecialTargets.Internal?n:n.children.get(e)||registry.registry.get(e):utils.isActor(e)?e:void 0;if(s)if("machine"in s){if(n.status!==exports.InterpreterStatus.Stopped||n.parent!==s||n.state.done){var o=_tslib.__assign(_tslib.__assign({},t),{name:t.name===actionTypes.error?"".concat(actions.error(n.id)):t.name,origin:n.sessionId});!i&&n.machine.config.predictableActionArguments?n._outgoingQueue.push([s,o]):s.send(o)}}else!i&&n.machine.config.predictableActionArguments?n._outgoingQueue.push([s,t.data]):s.send(t.data);else{if(!r)throw new Error("Unable to send event to child '".concat(e,"' from service '").concat(n.id,"'."));environment.IS_PRODUCTION||utils.warn(!1,"Service '".concat(n.id,"' has no parent: unable to send event ").concat(t.type))}},this._exec=function(t,e,i,r){void 0===r&&(r=n.machine.options.actions);var s=t.exec||actions.getActionFunction(t.type,r),o=utils.isFunction(s)?s:s?s.exec:t.exec;if(o)try{return o(e,i.data,n.machine.config.predictableActionArguments?{action:t,_event:i}:{action:t,state:n.state,_event:i})}catch(t){throw n.parent&&n.parent.send({type:"xstate.error",data:t}),t}switch(t.type){case actionTypes.raise:var a=t;n.defer(a);break;case actionTypes.send:var c=t;if("number"==typeof c.delay)return void n.defer(c);c.to?n.sendTo(c._event,c.to,i===actions.initEvent):n.send(c._event);break;case actionTypes.cancel:n.cancel(t.sendId);break;case actionTypes.start:if(n.status!==exports.InterpreterStatus.Running)return;var u=t.activity;if(!n.machine.config.predictableActionArguments&&!n.state.activities[u.id||u.type])break;if(u.type===types.ActionTypes.Invoke){var l=utils.toInvokeSource(u.src),d=n.machine.options.services?n.machine.options.services[l.type]:void 0,h=u.id,p=u.data;environment.IS_PRODUCTION||utils.warn(!("forward"in u),"`forward` property is deprecated (found in invocation of '".concat(u.src,"' in in machine '").concat(n.machine.id,"'). ")+"Please use `autoForward` instead.");var v="autoForward"in u?u.autoForward:!!u.forward;if(!d)return void(environment.IS_PRODUCTION||utils.warn(!1,"No service found for invocation '".concat(u.src,"' in machine '").concat(n.machine.id,"'.")));var f=p?utils.mapContext(p,e,i):void 0;if("string"==typeof d)return;var _=utils.isFunction(d)?d(e,i.data,{data:f,src:l,meta:u.meta}):d;if(!_)return;var y=void 0;utils.isMachine(_)&&(_=f?_.withContext(f):_,y={autoForward:v}),n.spawn(_,h,y)}else n.spawnActivity(u);break;case actionTypes.stop:n.stopChild(t.activity.id);break;case actionTypes.log:var S=t,b=S.label,g=S.value;b?n.logger(b,g):n.logger(g);break;default:environment.IS_PRODUCTION||utils.warn(!1,"No implementation found for action type '".concat(t.type,"'"))}};var r=_tslib.__assign(_tslib.__assign({},t.defaultOptions),i),s=r.clock,o=r.logger,a=r.parent,c=r.id,u=void 0!==c?c:e.id;this.id=u,this.logger=o,this.clock=s,this.parent=a,this.options=r,this.scheduler=new scheduler.Scheduler({deferEvents:this.options.deferEvents}),this.sessionId=registry.registry.bookId()}return Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:serviceScope.provide(this,function(){return t._initialState=t.machine.initialState,t._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return environment.IS_PRODUCTION||utils.warn(this.status!==exports.InterpreterStatus.NotStarted,"Attempted to read state from uninitialized service '".concat(this.id,"'. Make sure the service is started first.")),this._state},enumerable:!1,configurable:!0}),t.prototype.execute=function(t,e){var i,n;try{for(var r=_tslib.__values(t.actions),s=r.next();!s.done;s=r.next()){var o=s.value;this.exec(o,t,e)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}},t.prototype.update=function(t,e){var i,n,r,s,o,a,c,u,l=this;if(t._sessionid=this.sessionId,this._state=t,this.machine.config.predictableActionArguments&&e!==actions.initEvent||!this.options.execute)for(var d=void 0;d=this._outgoingQueue.shift();)d[0].send(d[1]);else this.execute(this.state);if(this.children.forEach(function(t){l.state.children[t.id]=t}),this.devTools&&this.devTools.send(e.data,t),t.event)try{for(var h=_tslib.__values(this.eventListeners),p=h.next();!p.done;p=h.next()){(0,p.value)(t.event)}}catch(t){i={error:t}}finally{try{p&&!p.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}try{for(var v=_tslib.__values(this.listeners),f=v.next();!f.done;f=v.next()){(0,f.value)(t,t.event)}}catch(t){r={error:t}}finally{try{f&&!f.done&&(s=v.return)&&s.call(v)}finally{if(r)throw r.error}}try{for(var _=_tslib.__values(this.contextListeners),y=_.next();!y.done;y=_.next()){(0,y.value)(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(t){o={error:t}}finally{try{y&&!y.done&&(a=_.return)&&a.call(_)}finally{if(o)throw o.error}}if(this.state.done){var S=t.configuration.find(function(t){return"final"===t.type&&t.parent===l.machine}),b=S&&S.doneData?utils.mapContext(S.doneData,t.context,e):void 0;this._doneEvent=actions.doneInvoke(this.id,b);try{for(var g=_tslib.__values(this.doneListeners),m=g.next();!m.done;m=g.next()){(0,m.value)(this._doneEvent)}}catch(t){c={error:t}}finally{try{m&&!m.done&&(u=g.return)&&u.call(g)}finally{if(c)throw c.error}}this._stop(),this._stopChildren(),registry.registry.free(this.sessionId)}},t.prototype.onTransition=function(t){return this.listeners.add(t),this.status===exports.InterpreterStatus.Running&&t(this.state,this.state.event),this},t.prototype.subscribe=function(t,e,i){var n=this,r=utils.toObserver(t,e,i);this.listeners.add(r.next),this.status!==exports.InterpreterStatus.NotStarted&&r.next(this.state);var s=function(){n.doneListeners.delete(s),n.stopListeners.delete(s),r.complete()};return this.status===exports.InterpreterStatus.Stopped?r.complete():(this.onDone(s),this.onStop(s)),{unsubscribe:function(){n.listeners.delete(r.next),n.doneListeners.delete(s),n.stopListeners.delete(s)}}},t.prototype.onEvent=function(t){return this.eventListeners.add(t),this},t.prototype.onSend=function(t){return this.sendListeners.add(t),this},t.prototype.onChange=function(t){return this.contextListeners.add(t),this},t.prototype.onStop=function(t){return this.stopListeners.add(t),this},t.prototype.onDone=function(t){return this.status===exports.InterpreterStatus.Stopped&&this._doneEvent?t(this._doneEvent):this.doneListeners.add(t),this},t.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},t.prototype.start=function(t){var e=this;if(this.status===exports.InterpreterStatus.Running)return this;this.machine._init(),registry.registry.register(this.sessionId,this),this.initialized=!0,this.status=exports.InterpreterStatus.Running;var i=void 0===t?this.initialState:serviceScope.provide(this,function(){return State.isStateConfig(t)?e.machine.resolveState(t):e.machine.resolveState(State.State.from(t,e.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){e.update(i,actions.initEvent)}),this},t.prototype._stopChildren=function(){this.children.forEach(function(t){utils.isFunction(t.stop)&&t.stop()}),this.children.clear()},t.prototype._stop=function(){var t,e,i,n,r,s,o,a,c,u;try{for(var l=_tslib.__values(this.listeners),d=l.next();!d.done;d=l.next()){var h=d.value;this.listeners.delete(h)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}try{for(var p=_tslib.__values(this.stopListeners),v=p.next();!v.done;v=p.next()){(h=v.value)(),this.stopListeners.delete(h)}}catch(t){i={error:t}}finally{try{v&&!v.done&&(n=p.return)&&n.call(p)}finally{if(i)throw i.error}}try{for(var f=_tslib.__values(this.contextListeners),_=f.next();!_.done;_=f.next()){h=_.value;this.contextListeners.delete(h)}}catch(t){r={error:t}}finally{try{_&&!_.done&&(s=f.return)&&s.call(f)}finally{if(r)throw r.error}}try{for(var y=_tslib.__values(this.doneListeners),S=y.next();!S.done;S=y.next()){h=S.value;this.doneListeners.delete(h)}}catch(t){o={error:t}}finally{try{S&&!S.done&&(a=y.return)&&a.call(y)}finally{if(o)throw o.error}}if(!this.initialized)return this;this.initialized=!1,this.status=exports.InterpreterStatus.Stopped,this._initialState=void 0;try{for(var b=_tslib.__values(Object.keys(this.delayedEventsMap)),g=b.next();!g.done;g=b.next()){var m=g.value;this.clock.clearTimeout(this.delayedEventsMap[m])}}catch(t){c={error:t}}finally{try{g&&!g.done&&(u=b.return)&&u.call(b)}finally{if(c)throw c.error}}this.scheduler.clear(),this.scheduler=new scheduler.Scheduler({deferEvents:this.options.deferEvents})},t.prototype.stop=function(){var t=this,e=this.scheduler;return this._stop(),e.schedule(function(){var e;if(null===(e=t._state)||void 0===e||!e.done){var i=utils.toSCXMLEvent({type:"xstate.stop"}),n=serviceScope.provide(t,function(){var e=utils.flatten(_tslib.__spreadArray([],_tslib.__read(t.state.configuration),!1).sort(function(t,e){return e.order-t.order}).map(function(e){return actions.toActionObjects(e.onExit,t.machine.options.actions)})),n=_tslib.__read(actions.resolveActions(t.machine,t.state,t.state.context,i,[{type:"exit",actions:e}],t.machine.config.predictableActionArguments?t._exec:void 0,t.machine.config.predictableActionArguments||t.machine.config.preserveActionOrder),2),r=n[0],s=n[1],o=new State.State({value:t.state.value,context:s,_event:i,_sessionid:t.sessionId,historyValue:void 0,history:t.state,actions:r.filter(function(t){return!utils.isRaisableAction(t)}),activities:{},events:[],configuration:[],transitions:[],children:{},done:t.state.done,tags:t.state.tags,machine:t.machine});return o.changed=!0,o});t.update(n,i),t._stopChildren(),registry.registry.free(t.sessionId)}}),this},t.prototype.batch=function(t){var e=this;if(this.status===exports.InterpreterStatus.NotStarted&&this.options.deferEvents)environment.IS_PRODUCTION||utils.warn(!1,"".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'" and are deferred. Make sure .start() is called for this service.\nEvent: ').concat(JSON.stringify(event)));else if(this.status!==exports.InterpreterStatus.Running)throw new Error("".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'));if(t.length){var i=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(function(){var n,r,s=e.state,o=!1,a=[],c=function(t){var n=utils.toSCXMLEvent(t);e.forward(n),s=serviceScope.provide(e,function(){return e.machine.transition(s,n,void 0,i||void 0)}),a.push.apply(a,_tslib.__spreadArray([],_tslib.__read(e.machine.config.predictableActionArguments?s.actions:s.actions.map(function(t){return State.bindActionToState(t,s)})),!1)),o=o||!!s.changed};try{for(var u=_tslib.__values(t),l=u.next();!l.done;l=u.next()){c(l.value)}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}s.changed=o,s.actions=a,e.update(s,utils.toSCXMLEvent(t[t.length-1]))})}},t.prototype.sender=function(t){return this.send.bind(this,t)},t.prototype._nextState=function(t,e){var i=this;void 0===e&&(e=!!this.machine.config.predictableActionArguments&&this._exec);var n=utils.toSCXMLEvent(t);if(0===n.name.indexOf(actionTypes.errorPlatform)&&!this.state.nextEvents.some(function(t){return 0===t.indexOf(actionTypes.errorPlatform)}))throw n.data.data;return serviceScope.provide(this,function(){return i.machine.transition(i.state,n,void 0,e||void 0)})},t.prototype.nextState=function(t){return this._nextState(t,!1)},t.prototype.forward=function(t){var e,i;try{for(var n=_tslib.__values(this.forwardTo),r=n.next();!r.done;r=n.next()){var s=r.value,o=this.children.get(s);if(!o)throw new Error("Unable to forward event '".concat(t,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(s,"'."));o.send(t)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}},t.prototype.defer=function(t){var e=this,i=this.clock.setTimeout(function(){"to"in t&&t.to?e.sendTo(t._event,t.to,!0):e.send(t._event)},t.delay);t.id&&(this.delayedEventsMap[t.id]=i)},t.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},t.prototype.exec=function(t,e,i){void 0===i&&(i=this.machine.options.actions),this._exec(t,e.context,e._event,i)},t.prototype.removeChild=function(t){var e;this.children.delete(t),this.forwardTo.delete(t),null===(e=this.state)||void 0===e||delete e.children[t]},t.prototype.stopChild=function(t){var e=this.children.get(t);e&&(this.removeChild(t),utils.isFunction(e.stop)&&e.stop())},t.prototype.spawn=function(t,e,i){if(this.status!==exports.InterpreterStatus.Running)return Actor.createDeferredActor(t,e);if(utils.isPromiseLike(t))return this.spawnPromise(Promise.resolve(t),e);if(utils.isFunction(t))return this.spawnCallback(t,e);if(Actor.isSpawnedActor(t))return this.spawnActor(t,e);if(utils.isObservable(t))return this.spawnObservable(t,e);if(utils.isMachine(t))return this.spawnMachine(t,_tslib.__assign(_tslib.__assign({},i),{id:e}));if(utils.isBehavior(t))return this.spawnBehavior(t,e);throw new Error('Unable to spawn entity "'.concat(e,'" of type "').concat(typeof t,'".'))},t.prototype.spawnMachine=function(e,i){var n=this;void 0===i&&(i={});var r=new t(e,_tslib.__assign(_tslib.__assign({},this.options),{parent:this,id:i.id||e.id})),s=_tslib.__assign(_tslib.__assign({},DEFAULT_SPAWN_OPTIONS),i);s.sync&&r.onTransition(function(t){n.send(actionTypes.update,{state:t,id:r.id})});var o=r;return this.children.set(r.id,o),s.autoForward&&this.forwardTo.add(r.id),r.onDone(function(t){n.removeChild(r.id),n.send(utils.toSCXMLEvent(t,{origin:r.id}))}).start(),o},t.prototype.spawnBehavior=function(t,e){var i=behaviors.spawnBehavior(t,{id:e,parent:this});return this.children.set(e,i),i},t.prototype.spawnPromise=function(t,e){var i,n,r=this,s=!1;t.then(function(t){s||(n=t,r.removeChild(e),r.send(utils.toSCXMLEvent(actions.doneInvoke(e,t),{origin:e})))},function(t){if(!s){r.removeChild(e);var i=actions.error(e,t);try{r.send(utils.toSCXMLEvent(i,{origin:e}))}catch(n){utils.reportUnhandledExceptionOnInvocation(t,n,e),r.devTools&&r.devTools.send(i,r.state),r.machine.strict&&r.stop()}}});var o=((i={id:e,send:function(){},subscribe:function(e,i,n){var r=utils.toObserver(e,i,n),s=!1;return t.then(function(t){s||(r.next(t),s||r.complete())},function(t){s||r.error(t)}),{unsubscribe:function(){return s=!0}}},stop:function(){s=!0},toJSON:function(){return{id:e}},getSnapshot:function(){return n}})[utils.symbolObservable]=function(){return this},i);return this.children.set(e,o),o},t.prototype.spawnCallback=function(t,e){var i,n,r,s=this,o=!1,a=new Set,c=new Set;try{r=t(function(t){n=t,c.forEach(function(e){return e(t)}),o||s.send(utils.toSCXMLEvent(t,{origin:e}))},function(t){a.add(t)})}catch(t){this.send(actions.error(e,t))}if(utils.isPromiseLike(r))return this.spawnPromise(r,e);var u=((i={id:e,send:function(t){return a.forEach(function(e){return e(t)})},subscribe:function(t){var e=utils.toObserver(t);return c.add(e.next),{unsubscribe:function(){c.delete(e.next)}}},stop:function(){o=!0,utils.isFunction(r)&&r()},toJSON:function(){return{id:e}},getSnapshot:function(){return n}})[utils.symbolObservable]=function(){return this},i);return this.children.set(e,u),u},t.prototype.spawnObservable=function(t,e){var i,n,r=this,s=t.subscribe(function(t){n=t,r.send(utils.toSCXMLEvent(t,{origin:e}))},function(t){r.removeChild(e),r.send(utils.toSCXMLEvent(actions.error(e,t),{origin:e}))},function(){r.removeChild(e),r.send(utils.toSCXMLEvent(actions.doneInvoke(e),{origin:e}))}),o=((i={id:e,send:function(){},subscribe:function(e,i,n){return t.subscribe(e,i,n)},stop:function(){return s.unsubscribe()},getSnapshot:function(){return n},toJSON:function(){return{id:e}}})[utils.symbolObservable]=function(){return this},i);return this.children.set(e,o),o},t.prototype.spawnActor=function(t,e){return this.children.set(e,t),t},t.prototype.spawnActivity=function(t){var e=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(e){var i=e(this.state.context,t);this.spawnEffect(t.id,i)}else environment.IS_PRODUCTION||utils.warn(!1,"No implementation found for activity '".concat(t.type,"'"))},t.prototype.spawnEffect=function(t,e){var i;this.children.set(t,((i={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:e||void 0,getSnapshot:function(){},toJSON:function(){return{id:t}}})[utils.symbolObservable]=function(){return this},i))},t.prototype.attachDev=function(){var t=devTools.getGlobal();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){var e="object"==typeof this.options.devTools?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(_tslib.__assign(_tslib.__assign({name:this.id,autoPause:!0,stateSanitizer:function(t){return{value:t.value,context:t.context,actions:t.actions}}},e),{features:_tslib.__assign({jump:!1,skip:!1},e?e.features:void 0)}),this.machine),this.devTools.init(this.state)}devTools.registerService(this)}},t.prototype.toJSON=function(){return{id:this.id}},t.prototype[utils.symbolObservable]=function(){return this},t.prototype.getSnapshot=function(){return this.status===exports.InterpreterStatus.NotStarted?this.initialState:this._state},t.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(t,e){return setTimeout(t,e)},clearTimeout:function(t){return clearTimeout(t)}},logger:console.log.bind(console),devTools:!1},t.interpret=interpret,t}(),resolveSpawnOptions=function(t){return utils.isString(t)?_tslib.__assign(_tslib.__assign({},DEFAULT_SPAWN_OPTIONS),{name:t}):_tslib.__assign(_tslib.__assign(_tslib.__assign({},DEFAULT_SPAWN_OPTIONS),{name:utils.uniqueId()}),t)};function spawn(t,e){var i=resolveSpawnOptions(e);return serviceScope.consume(function(e){if(!environment.IS_PRODUCTION){var n=utils.isMachine(t)||utils.isFunction(t);utils.warn(!!e||n,'Attempted to spawn an Actor (ID: "'.concat(utils.isMachine(t)?t.id:"undefined",'") outside of a service. This will have no effect.'))}return e?e.spawn(t,i.name,i):Actor.createDeferredActor(t,i.name)})}function interpret(t,e){return new Interpreter(t,e)}exports.Interpreter=Interpreter,exports.interpret=interpret,exports.spawn=spawn;

},{"./Actor.js":2,"./State.js":4,"./_virtual/_tslib.js":6,"./actionTypes.js":7,"./actions.js":8,"./behaviors.js":9,"./devTools.js":11,"./environment.js":12,"./registry.js":18,"./scheduler.js":19,"./serviceScope.js":21,"./types.js":23,"./utils.js":24}],15:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _tslib=require("./_virtual/_tslib.js");require("./types.js");var actionTypes=require("./actionTypes.js");function toInvokeSource(e){if("string"==typeof e){var t={type:e,toString:function(){return e}};return t}return e}function toInvokeDefinition(e){return _tslib.__assign(_tslib.__assign({type:actionTypes.invoke},e),{toJSON:function(){e.onDone,e.onError;var t=_tslib.__rest(e,["onDone","onError"]);return _tslib.__assign(_tslib.__assign({},t),{type:actionTypes.invoke,src:toInvokeSource(e.src)})}})}require("./utils.js"),require("./environment.js"),exports.toInvokeDefinition=toInvokeDefinition,exports.toInvokeSource=toInvokeSource;

},{"./_virtual/_tslib.js":6,"./actionTypes.js":7,"./environment.js":12,"./types.js":23,"./utils.js":24}],16:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _tslib=require("./_virtual/_tslib.js"),utils=require("./utils.js");function mapState(t,e){var r,a,l;try{for(var s=_tslib.__values(Object.keys(t)),i=s.next();!i.done;i=s.next()){var u=i.value;utils.matchesState(u,e)&&(!l||e.length>l.length)&&(l=u)}}catch(t){r={error:t}}finally{try{i&&!i.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}return t[l]}exports.mapState=mapState;

},{"./_virtual/_tslib.js":6,"./utils.js":24}],17:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _tslib=require("./_virtual/_tslib.js"),State=require("./State.js");function matchState(t,e,r){var a,i,l=State.State.from(t,t instanceof State.State?t.context:void 0);try{for(var n=_tslib.__values(e),o=n.next();!o.done;o=n.next()){var s=_tslib.__read(o.value,2),c=s[0],u=s[1];if(l.matches(c))return u(l)}}catch(t){a={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return r(l)}exports.matchState=matchState;

},{"./State.js":4,"./_virtual/_tslib.js":6}],18:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var children=new Map,sessionIdIndex=0,registry={bookId:function(){return"x:".concat(sessionIdIndex++)},register:function(e,r){return children.set(e,r),e},get:function(e){return children.get(e)},free:function(e){children.delete(e)}};exports.registry=registry;

},{}],19:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _tslib=require("./_virtual/_tslib.js"),defaultOptions={deferEvents:!1},Scheduler=function(){function e(e){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=_tslib.__assign(_tslib.__assign({},defaultOptions),e)}return e.prototype.initialize=function(e){if(this.initialized=!0,e){if(!this.options.deferEvents)return void this.schedule(e);this.process(e)}this.flushEvents()},e.prototype.schedule=function(e){if(this.initialized&&!this.processingEvent){if(0!==this.queue.length)throw new Error("Event queue should be empty when it is not processing events");this.process(e),this.flushEvents()}else this.queue.push(e)},e.prototype.clear=function(){this.queue=[]},e.prototype.flushEvents=function(){for(var e=this.queue.shift();e;)this.process(e),e=this.queue.shift()},e.prototype.process=function(e){this.processingEvent=!0;try{e()}catch(e){throw this.clear(),e}finally{this.processingEvent=!1}},e}();exports.Scheduler=Scheduler;

},{"./_virtual/_tslib.js":6}],20:[function(require,module,exports){
"use strict";function createSchema(e){return e}Object.defineProperty(exports,"__esModule",{value:!0});var t=createSchema;exports.createSchema=createSchema,exports.t=t;

},{}],21:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var serviceStack=[],provide=function(e,r){serviceStack.push(e);var c=r(e);return serviceStack.pop(),c},consume=function(e){return e(serviceStack[serviceStack.length-1])};exports.consume=consume,exports.provide=provide;

},{}],22:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _tslib=require("./_virtual/_tslib.js"),utils=require("./utils.js"),isLeafNode=function(t){return"atomic"===t.type||"final"===t.type};function getAllChildren(t){return Object.keys(t.states).map(function(e){return t.states[e]})}function getChildren(t){return getAllChildren(t).filter(function(t){return"history"!==t.type})}function getAllStateNodes(t){var e=[t];return isLeafNode(t)?e:e.concat(utils.flatten(getChildren(t).map(getAllStateNodes)))}function getConfiguration(t,e){var r,n,a,i,o,l,u,s,f=getAdjList(new Set(t)),d=new Set(e);try{for(var c=_tslib.__values(d),g=c.next();!g.done;g=c.next())for(var p=(S=g.value).parent;p&&!d.has(p);)d.add(p),p=p.parent}catch(t){r={error:t}}finally{try{g&&!g.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}var h=getAdjList(d);try{for(var y=_tslib.__values(d),v=y.next();!v.done;v=y.next()){if("compound"!==(S=v.value).type||h.get(S)&&h.get(S).length){if("parallel"===S.type)try{for(var _=(o=void 0,_tslib.__values(getChildren(S))),x=_.next();!x.done;x=_.next()){var A=x.value;d.has(A)||(d.add(A),f.get(A)?f.get(A).forEach(function(t){return d.add(t)}):A.initialStateNodes.forEach(function(t){return d.add(t)}))}}catch(t){o={error:t}}finally{try{x&&!x.done&&(l=_.return)&&l.call(_)}finally{if(o)throw o.error}}}else f.get(S)?f.get(S).forEach(function(t){return d.add(t)}):S.initialStateNodes.forEach(function(t){return d.add(t)})}}catch(t){a={error:t}}finally{try{v&&!v.done&&(i=y.return)&&i.call(y)}finally{if(a)throw a.error}}try{for(var m=_tslib.__values(d),C=m.next();!C.done;C=m.next()){var S;for(p=(S=C.value).parent;p&&!d.has(p);)d.add(p),p=p.parent}}catch(t){u={error:t}}finally{try{C&&!C.done&&(s=m.return)&&s.call(m)}finally{if(u)throw u.error}}return d}function getValueFromAdj(t,e){var r=e.get(t);if(!r)return{};if("compound"===t.type){var n=r[0];if(!n)return{};if(isLeafNode(n))return n.key}var a={};return r.forEach(function(t){a[t.key]=getValueFromAdj(t,e)}),a}function getAdjList(t){var e,r,n=new Map;try{for(var a=_tslib.__values(t),i=a.next();!i.done;i=a.next()){var o=i.value;n.has(o)||n.set(o,[]),o.parent&&(n.has(o.parent)||n.set(o.parent,[]),n.get(o.parent).push(o))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return n}function getValue(t,e){return getValueFromAdj(t,getAdjList(getConfiguration([t],e)))}function has(t,e){return Array.isArray(t)?t.some(function(t){return t===e}):t instanceof Set&&t.has(e)}function nextEvents(t){return _tslib.__spreadArray([],_tslib.__read(new Set(utils.flatten(_tslib.__spreadArray([],_tslib.__read(t.map(function(t){return t.ownEvents})),!1)))),!1)}function isInFinalState(t,e){return"compound"===e.type?getChildren(e).some(function(e){return"final"===e.type&&has(t,e)}):"parallel"===e.type&&getChildren(e).every(function(e){return isInFinalState(t,e)})}function getMeta(t){return void 0===t&&(t=[]),t.reduce(function(t,e){return void 0!==e.meta&&(t[e.id]=e.meta),t},{})}function getTagsFromConfiguration(t){return new Set(utils.flatten(t.map(function(t){return t.tags})))}exports.getAdjList=getAdjList,exports.getAllChildren=getAllChildren,exports.getAllStateNodes=getAllStateNodes,exports.getChildren=getChildren,exports.getConfiguration=getConfiguration,exports.getMeta=getMeta,exports.getTagsFromConfiguration=getTagsFromConfiguration,exports.getValue=getValue,exports.has=has,exports.isInFinalState=isInFinalState,exports.isLeafNode=isLeafNode,exports.nextEvents=nextEvents;

},{"./_virtual/_tslib.js":6,"./utils.js":24}],23:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ActionTypes=void 0,function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"}(exports.ActionTypes||(exports.ActionTypes={})),exports.SpecialTargets=void 0,function(t){t.Parent="#_parent",t.Internal="#_internal"}(exports.SpecialTargets||(exports.SpecialTargets={}));

},{}],24:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _a,_tslib=require("./_virtual/_tslib.js"),types=require("./types.js"),actionTypes=require("./actionTypes.js"),constants=require("./constants.js"),environment=require("./environment.js");function keys(t){return Object.keys(t)}function matchesState(t,e,r){void 0===r&&(r=constants.STATE_DELIMITER);var n=toStateValue(t,r),o=toStateValue(e,r);return isString(o)?!!isString(n)&&o===n:isString(n)?n in o:Object.keys(n).every(function(t){return t in o&&matchesState(n[t],o[t])})}function getEventType(t){try{return isString(t)||"number"==typeof t?"".concat(t):t.type}catch(t){throw new Error("Events must be strings or objects with a string event.type property.")}}function getActionType(t){try{return isString(t)||"number"==typeof t?"".concat(t):isFunction(t)?t.name:t.type}catch(t){throw new Error("Actions must be strings or objects with a string action.type property.")}}function toStatePath(t,e){try{return isArray(t)?t:t.toString().split(e)}catch(e){throw new Error("'".concat(t,"' is not a valid state path."))}}function isStateLike(t){return"object"==typeof t&&"value"in t&&"context"in t&&"event"in t&&"_event"in t}function toStateValue(t,e){return isStateLike(t)?t.value:isArray(t)?pathToStateValue(t):"string"!=typeof t?t:pathToStateValue(toStatePath(t,e))}function pathToStateValue(t){if(1===t.length)return t[0];for(var e={},r=e,n=0;n<t.length-1;n++)n===t.length-2?r[t[n]]=t[n+1]:(r[t[n]]={},r=r[t[n]]);return e}function mapValues(t,e){for(var r={},n=Object.keys(t),o=0;o<n.length;o++){var a=n[o];r[a]=e(t[a],a,t,o)}return r}function mapFilterValues(t,e,r){var n,o,a={};try{for(var i=_tslib.__values(Object.keys(t)),s=i.next();!s.done;s=i.next()){var c=s.value,u=t[c];r(u)&&(a[c]=e(u,c,t))}}catch(t){n={error:t}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return a}var path=function(t){return function(e){var r,n,o=e;try{for(var a=_tslib.__values(t),i=a.next();!i.done;i=a.next()){o=o[i.value]}}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o}};function nestedPath(t,e){return function(r){var n,o,a=r;try{for(var i=_tslib.__values(t),s=i.next();!s.done;s=i.next()){var c=s.value;a=a[e][c]}}catch(t){n={error:t}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return a}}function toStatePaths(t){return t?isString(t)?[[t]]:flatten(Object.keys(t).map(function(e){var r=t[e];return"string"==typeof r||r&&Object.keys(r).length?toStatePaths(t[e]).map(function(t){return[e].concat(t)}):[[e]]})):[[]]}function pathsToStateValue(t){var e,r,n={};if(t&&1===t.length&&1===t[0].length)return t[0][0];try{for(var o=_tslib.__values(t),a=o.next();!a.done;a=o.next())for(var i=a.value,s=n,c=0;c<i.length;c++){var u=i[c];if(c===i.length-2){s[u]=i[c+1];break}s[u]=s[u]||{},s=s[u]}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return n}function flatten(t){var e;return(e=[]).concat.apply(e,_tslib.__spreadArray([],_tslib.__read(t),!1))}function toArrayStrict(t){return isArray(t)?t:[t]}function toArray(t){return void 0===t?[]:toArrayStrict(t)}function mapContext(t,e,r){var n,o;if(isFunction(t))return t(e,r.data);var a={};try{for(var i=_tslib.__values(Object.keys(t)),s=i.next();!s.done;s=i.next()){var c=s.value,u=t[c];isFunction(u)?a[c]=u(e,r.data):a[c]=u}}catch(t){n={error:t}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return a}function isBuiltInEvent(t){return/^(done|error)\./.test(t)}function isPromiseLike(t){return t instanceof Promise||!(null===t||!isFunction(t)&&"object"!=typeof t||!isFunction(t.then))}function isBehavior(t){return null!==t&&"object"==typeof t&&"transition"in t&&"function"==typeof t.transition}function partition(t,e){var r,n,o=_tslib.__read([[],[]],2),a=o[0],i=o[1];try{for(var s=_tslib.__values(t),c=s.next();!c.done;c=s.next()){var u=c.value;e(u)?a.push(u):i.push(u)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return[a,i]}function updateHistoryStates(t,e){return mapValues(t.states,function(t,r){if(t){var n=(isString(e)?void 0:e[r])||(t?t.current:void 0);if(n)return{current:n,states:updateHistoryStates(t,n)}}})}function updateHistoryValue(t,e){return{current:e,states:updateHistoryStates(t,e)}}function updateContext(t,e,r,n){return environment.IS_PRODUCTION||exports.warn(!!t,"Attempting to update undefined context"),t?r.reduce(function(t,r){var o,a,i=r.assignment,s={state:n,action:r,_event:e},c={};if(isFunction(i))c=i(t,e.data,s);else try{for(var u=_tslib.__values(Object.keys(i)),l=u.next();!l.done;l=u.next()){var p=l.value,f=i[p];c[p]=isFunction(f)?f(t,e.data,s):f}}catch(t){o={error:t}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}return Object.assign({},t,c)},t):t}function isArray(t){return Array.isArray(t)}function isFunction(t){return"function"==typeof t}function isString(t){return"string"==typeof t}function toGuard(t,e){if(t)return isString(t)?{type:constants.DEFAULT_GUARD_TYPE,name:t,predicate:e?e[t]:void 0}:isFunction(t)?{type:constants.DEFAULT_GUARD_TYPE,name:t.name,predicate:t}:t}function isObservable(t){try{return"subscribe"in t&&isFunction(t.subscribe)}catch(t){return!1}}exports.warn=function(){},environment.IS_PRODUCTION||(exports.warn=function(t,e){var r=t instanceof Error?t:void 0;if((r||!t)&&void 0!==console){var n=["Warning: ".concat(e)];r&&n.push(r),console.warn.apply(console,n)}});var symbolObservable=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}(),interopSymbols=((_a={})[symbolObservable]=function(){return this},_a[Symbol.observable]=function(){return this},_a);function isMachine(t){return!!t&&"__xstatenode"in t}function isActor(t){return!!t&&"function"==typeof t.send}var uniqueId=function(){var t=0;return function(){return(++t).toString(16)}}();function toEventObject(t,e){return isString(t)||"number"==typeof t?_tslib.__assign({type:t},e):t}function toSCXMLEvent(t,e){if(!isString(t)&&"$$type"in t&&"scxml"===t.$$type)return t;var r=toEventObject(t);return _tslib.__assign({name:r.type,data:r,$$type:"scxml",type:"external"},e)}function toTransitionConfigArray(t,e){return toArrayStrict(e).map(function(e){return void 0===e||"string"==typeof e||isMachine(e)?{target:e,event:t}:_tslib.__assign(_tslib.__assign({},e),{event:t})})}function normalizeTarget(t){if(void 0!==t&&t!==constants.TARGETLESS_KEY)return toArray(t)}function reportUnhandledExceptionOnInvocation(t,e,r){if(!environment.IS_PRODUCTION){var n=t.stack?" Stacktrace was '".concat(t.stack,"'"):"";if(t===e)console.error("Missing onError handler for invocation '".concat(r,"', error was '").concat(t,"'.").concat(n));else{var o=e.stack?" Stacktrace was '".concat(e.stack,"'"):"";console.error("Missing onError handler and/or unhandled exception/promise rejection for invocation '".concat(r,"'. ")+"Original error: '".concat(t,"'. ").concat(n," Current error is '").concat(e,"'.").concat(o))}}}function evaluateGuard(t,e,r,n,o){var a=t.options.guards,i={state:o,cond:e,_event:n};if(e.type===constants.DEFAULT_GUARD_TYPE)return((null==a?void 0:a[e.name])||e.predicate)(r,n.data,i);var s=null==a?void 0:a[e.type];if(!s)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return s(r,n.data,i)}function toInvokeSource(t){return"string"==typeof t?{type:t}:t}function toObserver(t,e,r){var n=function(){},o="object"==typeof t,a=o?t:null;return{next:((o?t.next:t)||n).bind(a),error:((o?t.error:e)||n).bind(a),complete:((o?t.complete:r)||n).bind(a)}}function createInvokeId(t,e){return"".concat(t,":invocation[").concat(e,"]")}function isRaisableAction(t){return(t.type===actionTypes.raise||t.type===actionTypes.send&&t.to===types.SpecialTargets.Internal)&&"number"!=typeof t.delay}exports.createInvokeId=createInvokeId,exports.evaluateGuard=evaluateGuard,exports.flatten=flatten,exports.getActionType=getActionType,exports.getEventType=getEventType,exports.interopSymbols=interopSymbols,exports.isActor=isActor,exports.isArray=isArray,exports.isBehavior=isBehavior,exports.isBuiltInEvent=isBuiltInEvent,exports.isFunction=isFunction,exports.isMachine=isMachine,exports.isObservable=isObservable,exports.isPromiseLike=isPromiseLike,exports.isRaisableAction=isRaisableAction,exports.isStateLike=isStateLike,exports.isString=isString,exports.keys=keys,exports.mapContext=mapContext,exports.mapFilterValues=mapFilterValues,exports.mapValues=mapValues,exports.matchesState=matchesState,exports.nestedPath=nestedPath,exports.normalizeTarget=normalizeTarget,exports.partition=partition,exports.path=path,exports.pathToStateValue=pathToStateValue,exports.pathsToStateValue=pathsToStateValue,exports.reportUnhandledExceptionOnInvocation=reportUnhandledExceptionOnInvocation,exports.symbolObservable=symbolObservable,exports.toArray=toArray,exports.toArrayStrict=toArrayStrict,exports.toEventObject=toEventObject,exports.toGuard=toGuard,exports.toInvokeSource=toInvokeSource,exports.toObserver=toObserver,exports.toSCXMLEvent=toSCXMLEvent,exports.toStatePath=toStatePath,exports.toStatePaths=toStatePaths,exports.toStateValue=toStateValue,exports.toTransitionConfigArray=toTransitionConfigArray,exports.uniqueId=uniqueId,exports.updateContext=updateContext,exports.updateHistoryStates=updateHistoryStates,exports.updateHistoryValue=updateHistoryValue;

},{"./_virtual/_tslib.js":6,"./actionTypes.js":7,"./constants.js":10,"./environment.js":12,"./types.js":23}],25:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xstate=require("xstate");function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var XState=function(){function e(t){var r=t.world;_classCallCheck(this,e),this.id=e.id,this.world=r,this.debug=!0}return _createClass(e,[{key:"init",value:function(e){this.game=e,this.world&&this.createMachine(),e.systemsManager.addSystem("xstate",this)}},{key:"createMachine",value:function(){var e=this,t=this,r=this.game,i=this.world;i.stateMachine.predictableActionArguments=!0;var n=(0,_xstate.createMachine)(i.stateMachine,{guards:i.guards,actions:i.actions});r.machine=n,r.service=(0,_xstate.interpret)(r.machine).onTransition(function(n){t.debug&&console.log("State changed to:",n.value,n.changes,n.context),n.matches("EndRound")?e.reloadEntities():"UpdateEntity"===n.value&&(!function(e){console.log("applyStateChange",e);var t=r.findEntity(e.name);t&&(["health","color"].forEach(function(n){e[n]&&(t[n]=e[n],i.entities[e.name][n]=e[n],r.components[n].data[t.id]=e[n])}),r.inflateEntity(t))}(n.context),e.sendEvent("COMPLETE_UPDATE"))}),r.service.start()}},{key:"loadEntities",value:function(){var e=this.game,t=this.world;for(var r in t.entities){var i=t.entities[r];i.name=r,"BORDER"===i.type&&(e.systems.border||e.use(new e.plugins.Border({})),e.systems.border.createBorder({height:i.size.height,width:i.size.width})),e.createEntity(i)}}},{key:"reloadEntities",value:function(){this.loadEntities()}},{key:"sendEvent",value:function(e,t){this.game.service.send(e,t)}},{key:"getCurrentState",value:function(){return this.game.service.state.value}},{key:"unload",value:function(){this.game.service.stop()}}]),e}();_defineProperty(XState,"id","xstate"),_defineProperty(XState,"removable",!1);var _default=exports.default=XState;

},{"xstate":13}]},{},[25])(25)
});

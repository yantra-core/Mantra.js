(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}(g.PLUGINS || (g.PLUGINS = {})).UnitSpawner = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var UnitSpawner=exports.default=function(){function e(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];_classCallCheck(this,e),this.id=e.id,this.meta={sprayAngle:Math.PI/8}}return _createClass(e,[{key:"init",value:function(e){this.game=e,this.bindEvents(),this.game.systemsManager.addSystem("unit-spawner",this)}},{key:"build",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.game;e.position=e.position||{x:0,y:0};var n=_objectSpread(_objectSpread({},{position:{x:0,y:0},size:{width:4,height:4},friction:.05,frictionAir:.005,frictionStatic:.25,meta:{randomColor:!0}}),e.unitConfig);n.afterRemoveEntity=function(e){var n=t.data.ents._[e.owner];n&&(n.meta.unitsSpawned-=1,t.updateEntity(e.owner,{meta:{unitConfig:n.meta.unitConfig}}))},void 0===e.meta&&(e.meta={});var r={unitConfig:n,unitsSpawned:0,maxUnits:10,sprayAngle:0};return"number"==typeof e.sprayAngle&&(r.sprayAngle=e.sprayAngle),"number"==typeof e.maxUnits&&(r.maxUnits=e.maxUnits),"number"==typeof e.unitsSpawned&&(r.unitsSpawned=e.unitsSpawned),e.meta=_objectSpread(_objectSpread({},r),e.meta),console.log("using data",e),_objectSpread({type:"UNIT_SPAWNER",texture:e.texture||"none",meta:e.meta,update:this.unitSpawnerUpdate.bind(this),size:{width:16,height:16,depth:16},position:e.position},e)}},{key:"unitSpawnerUpdate",value:function(e){var t=e.meta.unitConfig;if(this.game.tick%10==0&&e.meta.unitsSpawned<e.meta.maxUnits){var n=e.position;t.position=n,t.owner=e.id,delete t.id,t.color=e.color,t.meta.randomColor&&(t.color=this.game.randomColor());var r=this.createEntity(t);r&&(e.meta.unitsSpawned+=1,this.applySprayForce(r,e.meta.sprayAngle),this.game.updateEntity(e.id,{color:t.color,meta:{unitConfig:t}}))}}},{key:"createEntity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return void 0===e.position&&(e.position={x:0,y:0}),this.game.createEntity(this.build(e))}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.createEntity(e)}},{key:"applySprayForce",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.PI/4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=this.game,o=t+(Math.random()-.5)*n,a={x:r*Math.cos(o),y:r*Math.sin(o)};i.applyForce(e.id,a)}},{key:"bindEvents",value:function(){}}]),e}();_defineProperty(UnitSpawner,"id","unit-spawner");

},{}]},{},[1])(1)
});

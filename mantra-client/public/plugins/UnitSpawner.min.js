(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}(g.PLUGINS || (g.PLUGINS = {})).UnitSpawner = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var UnitSpawner=exports.default=function(){function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];_classCallCheck(this,t),this.id=t.id}return _createClass(t,[{key:"init",value:function(t){this.game=t,this.bindEvents(),this.game.systemsManager.addSystem("unit-spawner",this)}},{key:"build",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.game;t.position=t.position||{x:0,y:0};var n=_objectSpread(_objectSpread({},{position:{x:0,y:0},size:{width:4,height:4},friction:.05,frictionAir:.005,frictionStatic:.25,sprayAngle:Math.PI/8,maxUnits:10,meta:{randomColor:!0,unitsSpawned:0}}),t.unitConfig);return"number"!=typeof n.meta.unitsSpawned&&(n.meta.unitsSpawned=0),n.afterRemoveEntity=function(t){var n=e.data.ents._[t.owner];n&&(n.meta.unitsSpawned-=1,e.updateEntity(t.owner,{meta:{unitConfig:n.meta.unitConfig}}))},{type:"UNIT_SPAWNER",texture:t.texture||"none",meta:{unitConfig:n},update:this.unitSpawnerUpdate.bind(this),size:{width:16,height:16,depth:16},position:t.position}}},{key:"unitSpawnerUpdate",value:function(t){var e=t.meta.unitConfig;if(this.game.tick%10==0&&e.meta.unitsSpawned<e.maxUnits){var n=t.position;e.position=n,e.owner=t.id,delete e.id,e.color=t.color,e.meta.randomColor&&(e.color=this.game.randomColor());var i=this.createEntity(e);i&&(e.meta.unitsSpawned+=1,this.applySprayForce(i),this.game.updateEntity(t.id,{color:e.color,meta:{unitConfig:e}}))}}},{key:"createEntity",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0===t.position&&(t.position={x:0,y:0});this.game.createEntity(this.build(t))}},{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.game.createEntity(this.build(t))}},{key:"applySprayForce",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI;var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.PI/4,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=this.game,r=(Math.random()-.5)*e,o=t.sprayAngle+r,a={x:n*Math.cos(o),y:n*Math.sin(o)};i.applyForce(t.id,a)}},{key:"bindEvents",value:function(){}}]),t}();_defineProperty(UnitSpawner,"id","unit-spawner");

},{}]},{},[1])(1)
});

(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}(g.PLUGINS || (g.PLUGINS = {})).SutraGUI = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var gui={elementList:["gui-container","gui-content","gui-header","gui-header-title","traffic-light","close","minimize","maximize","resizeHandle","gui-window-footer"],window:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Window",n=arguments.length>2?arguments[2]:void 0,i=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],this);void 0===n&&(n=function(){console.log("WARNING: No close function provided for window with id: "+e+", defaulting to remove()"),document.getElementById(e).remove()});var o="gui-container",l="gui-content",a="gui-header";is_touch_enabled();var s=document.createElement("div");s.id=e,s.className=o;var c=document.createElement("div");c.className=l;var d=document.createElement("div");d.className=a;var u=document.createElement("div");u.className="traffic-light-container";var r=document.createElement("div"),m=document.createElement("div"),f=document.createElement("div");r.className="traffic-light close",m.className="traffic-light minimize",f.className="traffic-light maximize",m.onclick=function(){return n()},r.onclick=function(){return n()},f.onclick=function(){i.maxWindow(s)},u.appendChild(r),u.appendChild(m),u.appendChild(f),d.appendChild(u);var p=document.createElement("h3");p.textContent=t,p.ondblclick=function(){i.maxWindow(s)},d.appendChild(p),s.appendChild(d),s.appendChild(c);var v=document.createElement("div");return v.className="resizeHandle",s.appendChild(v),document.body.appendChild(s),this.initializeDrag(d,s),this.initializeResize(v,s),s.addEventListener("click",function(){gui.bringToFront(s)}),s},maxWindow:function(e){"100vw"===e.style.width?(e.style.width="50%",e.style.height="50%",void 0!==e.lastTop?(e.style.top=e.lastTop,e.style.left=e.lastLeft):(e.style.top="20%",e.style.left="20%")):(e.lastTop=e.style.top,e.lastLeft=e.style.left,e.style.width="100vw",e.style.height="90%",e.style.top="50px",e.style.left="0px")},initializeResize:function(e,t){var n=this;e.addEventListener("mousedown",function(e){e.preventDefault(),gui.bringToFront(t),window.addEventListener("mousemove",i),window.addEventListener("mouseup",o)});var i=function(e){n.container.style.width=e.clientX-n.container.offsetLeft+"px",n.container.style.height=e.clientY-n.container.offsetTop+"px"},o=function(){window.removeEventListener("mousemove",i)}},initializeDrag:function(e,t){var n=0,i=0,o=0,l=0;function a(t){(t=t||window.event).preventDefault(),n=o-t.clientX,i=l-t.clientY,o=t.clientX,l=t.clientY,e.parentElement.style.top=e.parentElement.offsetTop-i+"px",e.parentElement.style.left=e.parentElement.offsetLeft-n+"px"}function s(){document.onmouseup=null,document.onmousemove=null}e.onmousedown=function(e){(e=e||window.event).preventDefault(),gui.bringToFront(t),o=e.clientX,l=e.clientY,document.onmouseup=s,document.onmousemove=a}},bringToFront:function(e){document.querySelectorAll(".gui-container").forEach(function(e){e.style.zIndex="1000"}),e.style.zIndex="1010"},init:function(e){"undefined"!=typeof document?(document.addEventListener("click",function(t){var n=t.target.closest(".gui-container");e&&e.systems&&e.systems["entity-input"]&&e.systems.keyboard&&(n?(e.systems["entity-input"].disableInputs(),e.systems.keyboard.unbindAllEvents()):(e.systems["entity-input"].setInputsActive(),e.systems.keyboard.bindInputControls()))}),document.addEventListener("keydown",function(e){if("Escape"===e.key){var t=document.querySelectorAll(".gui-container"),n=t[t.length-1];n&&n.remove()}})):console.log("gui-plugin: document not found, skipping initialization")}},_default=exports.default=gui;function is_touch_enabled(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}

},{}],2:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gui=_interopRequireDefault(require("../gui-editor/gui.js")),_drawTable=_interopRequireDefault(require("./lib/drawTable.js")),_dataView=_interopRequireDefault(require("./lib/editor/dataView.js")),_dataForm=_interopRequireDefault(require("./lib/editor/dataForm.js")),_actionForm=_interopRequireDefault(require("./lib/editor/actionForm.js")),_conditionalsForm=_interopRequireDefault(require("./lib/editor/conditionalsForm.js")),_conditionalForm=_interopRequireDefault(require("./lib/editor/conditionalForm.js")),_createLabel=_interopRequireDefault(require("./lib/editor/createLabel.js")),_editor=_interopRequireDefault(require("./lib/editor.js")),_serializeFormToJSON=_interopRequireDefault(require("./util/serializeFormToJSON.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,a){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var SutraGUI=function(){function e(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];_classCallCheck(this,e),this.id=e.id,this.highlightedKeys={},this.bossHealth=100,this.drawTable=_drawTable.default.bind(this),this.showFunctionEditor=_editor.default.showFunctionEditor.bind(this),this.showObjectEditor=_editor.default.showObjectEditor.bind(this),this.showConditionalsForm=_conditionalsForm.default.bind(this),this.createConditional=_editor.default.createConditional.bind(this),this.createConditionalForm=_conditionalForm.default.bind(this),this.createLabel=_createLabel.default.bind(this),this.dataView=_dataView.default.bind(this),this.dataForm=_dataForm.default.bind(this),this.showActionForm=_actionForm.default.bind(this),this.onConditionalTypeChange=_editor.default.onConditionalTypeChange.bind(this),this.serializeFormToJSON=_serializeFormToJSON.default.bind(this)}return _createClass(e,[{key:"init",value:function(e){var t=this;if(this.game=e,this.game.systemsManager&&this.game.systemsManager.addSystem(this.id,this),this.game&&this.game.systems&&this.game.systems["entity-input"]&&(this.game.systems["entity-input"].disableInputs(),this.game.systems.keyboard.unbindAllEvents()),document.addEventListener("click",function(e){var a=e.target.closest(".gui-container");if(t.game&&t.game.systems&&t.game.systems["entity-input"]&&t.game.systems.keyboard&&(a?(t.game.systems["entity-input"].disableInputs(),t.game.systems.keyboard.unbindAllEvents()):(t.game.systems["entity-input"].setInputsActive(),t.game.systems.keyboard.bindInputControls()),e.target.classList.contains("sutra-link"))){var n=e.target.getAttribute("data-path");t.behavior.findNode(n)}}),e.loadCSS("/plugins/SutraGUI/Sutra.css"),this.drawTable(),this.game.rules)this.setRules(this.game.rules),this.showSutra();else{var a=document.getElementById("sutraTable"),n=document.createElement("div");n.className="sutra-message",n.textContent="No Sutra Rules have been defined yet.";var i=document.createElement("div"),r=document.createElement("a");r.href="#",r.textContent="Warp to Sutra Tree World for Tutorial",r.onclick=function(e){e.preventDefault(),t.game.switchWorld("SutraWorld")},i.appendChild(r),i.appendChild(r),a.appendChild(n)}}},{key:"setRules",value:function(e){console.log("setting rules",e),e.onAny(function(t,a,n){if(void 0!==n){var i=n.sutraPath;e.getReadableSutraPath(i);document.querySelectorAll("[data-path='".concat(i,"']")).forEach(function(e){e.classList.add("highlighted-sutra-node")});var r=i.split(".");r.forEach(function(e,t){var a=r.slice(0,t+1).join(".");document.querySelectorAll("[data-path='".concat(a,"']")).forEach(function(e){e.classList.add("highlighted-sutra-node")})})}}),this.behavior=e;var t=e.serializeToJson();this.drawBehaviorTree(JSON.parse(t))}},{key:"addNewRule",value:function(){this.showConditionalsForm()}},{key:"showSutra",value:function(){this.behavior.toJSON();this.drawBehaviorTree(this.behavior)}},{key:"viewMarkup",value:function(){this.behavior.serializeToJson();var e=this.game.systems.markup.toHTML(),t=document.getElementById("sutraTable");t.innerHTML="";var a=document.createElement("pre");a.style.width="95%",a.style.height="800px",a.textContent=e,t.appendChild(a)}},{key:"viewJson",value:function(){var e=this.behavior.serializeToJson({includeSutraPath:!1}),t=document.getElementById("sutraTable");t.innerHTML="";var a=document.createElement("textarea");a.style.width="95%",a.style.height="800px",a.value=e,t.appendChild(a),this.adjustTextareaHeight(a)}},{key:"viewSutraEnglish",value:function(){var e=this.behavior.exportToEnglish(),t=document.getElementById("sutraTable");t.innerHTML="";var a=document.createElement("pre"),n=document.createElement("code");n.style.width="95%",n.style.height="800px",n.innerHTML=e,a.appendChild(n),t.appendChild(a)}},{key:"getEmitters",value:function(){return this.game.emitters}},{key:"drawBehaviorTree",value:function(e){var t=this;if(document.getElementById("sutraView")){var a=document.getElementById("sutraTable");if(a){a.innerHTML="";var n=function e(a,n){var i=t.createNodeElement(a,1);n.appendChild(i),a.tree&&a.tree.length>0&&a.tree.forEach(function(t){return e(t,n)})};if(e.tree.forEach(function(e){n(e,a)}),e.subtrees){var i=Object.keys(e.subtrees);i.length>0&&i.forEach(function(t){e.subtrees[t].tree.forEach(function(e){console.log("subtree node",e),n(e,a)})})}}else console.error("Table element #sutraTable not found.")}else console.error("Container element #sutraView not found.")}},{key:"getAvailableActions",value:function(){var e=this.getEmitters();return e?Object.keys(e):[]}},{key:"createNodeElement",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"IF",r=document.createElement("form");r.className="node-element-form";var o=n?"".concat(n,"-").concat(e.action||e.if):e.action||e.if;"string"==typeof e.subtree&&this.game.rules.getSubtree(e.subtree).tree.forEach(function(e){var n=a.createNodeElement(e,t+1,o);r.appendChild(n)});var l=document.createElement("div");return l.className="node-element",r.appendChild(l),e.action?(r.classList.add("action-node-form"),r.onclick=function(){a.showActionForm(e)},this.appendActionElement(l,e,t,i)):e.if&&this.appendConditionalElement(l,e,t),r}},{key:"saveSutra",value:function(){document.getElementById("sutraTable")}},{key:"appendActionElement",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"THEN",i=document.createElement("div");i.className="action-select-container";var r=document.createElement("label");r.className="then-label",r.innerHTML='<span class="sutra-keyword">'.concat(n,"</span>"),i.setAttribute("data-path",t.sutraPath);var o=this.createActionSelect(t);if(r.appendChild(o),i.appendChild(r),i.onclick=function(){document.querySelectorAll("[data-path='".concat(t.sutraPath,"']")).forEach(function(e){})},e.appendChild(i),t.data){var l=document.createElement("div");l.className="data-container",l.classList.add("with-container"),l.setAttribute("data-path",t.sutraPath);var s=document.createElement("label");s.className="with-label",s.innerHTML='<a href="#" class="sutra-keyword">WITH</a>'}}},{key:"createActionSelect",value:function(e){var t=document.createElement("select");t.className="action-select";var a=this.getAvailableActions();return e.action&&!a.includes(e.action)&&a.push(e.action),a.forEach(function(a){var n=document.createElement("option");n.value=a,n.text=a,e.action===a&&(n.selected=!0),t.appendChild(n)}),t}},{key:"createInputGroup",value:function(e,t,a,n){var i=document.createElement("div");i.className="input-group";var r=this.createLabel(t,a),o=this.createInput(e,t,n);return i.appendChild(r),i.appendChild(o),i}},{key:"createInput",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=document.createElement("input");return n.className="param-input",a.length?n.name=a:n.name=t,n.setAttribute("data-action",e.action),n.setAttribute("data-key",t),n.setAttribute("data-id",e.data.id),n.value=e.data[t],n.onchange=function(a){e.data[t]=a.target.value},n}},{key:"appendConditionalElement",value:function(e,t,a){var n=this,i=this.createConditionElement(t);if(e.appendChild(i),t.then&&t.then.forEach(function(t){e.appendChild(n.createNodeElement(t,a+1,"","THEN"))}),t.else){var r=this.createElseElement(t,a);e.appendChild(r)}}},{key:"createConditionElement",value:function(e){var t="IF",a=document.createElement("div");a.className="condition-container";var n=!1;if(2===e.sutraPath.split("[").length&&(n=!0),n||(t="AND"),Array.isArray(e.if))e.if.forEach(function(n,i){var r=document.createElement("div");r.className="condition",r.innerHTML='<span class="sutra-keyword">'.concat(t,"</span> ").concat(n),r.setAttribute("data-path",e.sutraPath),r.onclick=function(){},a.appendChild(r)});else{var i=document.createElement("div");i.className="condition",i.innerHTML='<span class="sutra-keyword">'.concat(t,"</span> ").concat(e.if),i.setAttribute("data-path",e.sutraPath),i.onclick=function(){i.parentElement.parentElement.querySelector(".node-element-form")},a.appendChild(i)}return a.onclick=function(e){e.target.parentElement;a.parentElement.querySelectorAll(".node-element-form").forEach(function(e){e.classList.toggle("collapsible-content")})},a}},{key:"createElseElement",value:function(e,t){var a=this,n=document.createElement("div");return n.className="else-branch",e.else.forEach(function(e){return n.appendChild(a.createNodeElement(e,t+1,"","ELSE"))}),n}},{key:"saveConditional",value:function(e,t){var a=this.serializeFormToJSON(t);console.log("SutraGui.saveConditional() called",e,a),this.behavior.updateCondition(e,a),this.drawBehaviorTree()}},{key:"handleAddRuleClick",value:function(e){console.log("handleAddRuleClick",e);var t=this.behavior.findNode(e);console.log("node",t),t.action?this.showConditionalsForm(t):t.if&&this.showConditionalsForm(t)}},{key:"handleRemoveRuleClick",value:function(e){console.log("handleRemoveRuleClick",e);try{this.behavior.removeNode(e)}catch(e){console.log(e)}this.behavior.serializeToJson();this.drawBehaviorTree()}},{key:"createAddRuleButton",value:function(e){var t=this,a=document.createElement("button");return a.textContent="+",a.className="rule-button rule-button-add",a.title="Add a new rule",a.setAttribute("data-id",e),a.onclick=function(e){return t.handleAddRuleClick(e.target.getAttribute("data-id")),!1},a}},{key:"createRemoveRuleButton",value:function(e){var t=this,a=document.createElement("button");return a.textContent="-",a.className="rule-button rule-button-remove",a.title="Remove this rule",a.setAttribute("data-id",e),a.onclick=function(e){e.stopPropagation(),t.handleRemoveRuleClick(e.target.getAttribute("data-id"))},a}},{key:"update",value:function(){this.game.tick%60==0&&document.querySelectorAll(".highlighted-sutra-node").forEach(function(e){e.classList.remove("highlighted-sutra-node")})}},{key:"unload",value:function(){this.sutraView.remove()}},{key:"adjustTextareaHeight",value:function(e){e.style.height="auto",e.style.height=e.scrollHeight+"px"}}]),e}();_defineProperty(SutraGUI,"id","gui-sutra");var _default=exports.default=SutraGUI;

},{"../gui-editor/gui.js":1,"./lib/drawTable.js":3,"./lib/editor.js":4,"./lib/editor/actionForm.js":5,"./lib/editor/conditionalForm.js":7,"./lib/editor/conditionalsForm.js":8,"./lib/editor/createLabel.js":9,"./lib/editor/dataForm.js":10,"./lib/editor/dataView.js":11,"./util/serializeFormToJSON.js":12}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=drawTable;var _gui=_interopRequireDefault(require("../../gui-editor/gui.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function drawTable(){var e=this,t=this.game,n=this,r=document.createElement("div");r.id="sutraTable",this.sutraView=_gui.default.window("sutraView","Sutra Editor",function(){t.systemsManager&&t.systemsManager.removeSystem(n.id)});var a=document.createElement("button");a.textContent="Show Sutra",a.onclick=function(){return e.showSutra()};var i=document.createElement("button");i.textContent="Add Rule",i.onclick=function(){return e.addNewRule()};var u=document.createElement("button");u.textContent="JSON",u.onclick=function(){return e.viewJson()};var o=document.createElement("button");o.textContent="Read Sutra",o.onclick=function(){return e.viewSutraEnglish()};var c=document.createElement("button");c.textContent="View Markup",c.onclick=function(){return e.viewMarkup()};var l=this.sutraView.querySelector(".gui-content");this.sutraView.style.backgroundColor="transparent";var s=createOpacitySlider(this.sutraView);s.style.display="none";var d=document.createElement("div");d.className="gui-window-footer",l.appendChild(a),l.appendChild(o),l.appendChild(c),l.appendChild(s),l.appendChild(r),l.appendChild(document.createElement("br"));var p=document.createElement("button");p.textContent="Save",p.onclick=function(){return e.saveSutra()},this.sutraView.appendChild(d),s.querySelector("input").dispatchEvent(new Event("input"))}function createOpacitySlider(e){var t=document.createElement("div");t.style.position="absolute",t.style.right="40px",t.style.top="5px",t.style.zIndex="10";var n=document.createElement("input");return n.setAttribute("type","range"),n.setAttribute("min","0"),n.setAttribute("max","1"),n.setAttribute("step","0.01"),n.setAttribute("value","1"),n.style.width="110px",n.style.transform="scale(1.5)",n.style.cursor="pointer",t.appendChild(n),e.style.backgroundColor="rgba(0, 0, 0, 0)",n.addEventListener("input",function(){var t=this.value;e.style.backgroundColor="rgba(10, 15, 27, ".concat(t,")")}),t}

},{"../../gui-editor/gui.js":1}],4:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gui=_interopRequireDefault(require("../../gui-editor/gui.js")),_componentsSelect=_interopRequireDefault(require("./editor/componentsSelect.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var editor={showFunctionEditor:function(e,t){var n=this,a=this.sutraFormView.querySelector(".gui-content"),o=document.createElement("h3");o.textContent="Edit Function: ".concat(e),a.appendChild(o);var r=document.createElement("textarea");r.value=t.toString(),a.appendChild(r);var i=document.createElement("button");i.textContent="Save",i.classList.add("save-button"),i.onclick=function(){var t=new Function("return "+r.value)();n.behavior.updateCondition(e,t),n.redrawBehaviorTree()},a.appendChild(i)},showObjectEditor:function(e,t,n){var a=this,o=this,r=this.sutraFormView.querySelector(".gui-content"),i=document.createElement("div");i.className="conditional-editor-container",r.appendChild(i);var c=document.createElement("form");c.className="conditional-form",i.appendChild(c);var d=document.createElement("div");d.innerHTML='<span class="sutra-keyword">property</span> refers to current context values <br/><span class="sutra-keyword">gamePropertyPath</span>  refers to global \'game.data\'',c.appendChild(d);var l=u("propertyType","property","Local Property"),p=u("propertyType","gamePropertyPath","Global Game Property");function u(e,t,n){var a=document.createElement("div"),o=document.createElement("input");o.type="radio",o.name=e,o.value=t,o.id=t;var r=document.createElement("label");return r.textContent=n,r.setAttribute("for",t),a.appendChild(o),a.appendChild(r),{container:a,input:o}}function s(){v.style.display=l.input.checked?"block":"none",h.style.display=p.input.checked?"block":"none"}c.appendChild(l.container),c.appendChild(p.container),l.input.addEventListener("change",s),p.input.addEventListener("change",s);y("property",t.property||"");var m=[];"undefined"!=typeof game&&game.components&&(m=Object.keys(game.components));var v=(0,_componentsSelect.default)("property",m),h=y("gamePropertyPath",t.gamePropertyPath||"");function y(e,t){var n=document.createElement("div");n.className="field-container";var a=document.createElement("label");a.textContent=e,a.className="field-label",a.classList.add("sutra-keyword"),n.appendChild(a);var o=document.createElement("input");return o.type="text",o.name=e,o.value=t,o.className="field-input",n.appendChild(o),n}for(var f in c.appendChild(v),c.appendChild(h),t)if("op"!==f&&"property"!==f&&"gamePropertyPath"!==f){var C=document.createElement("div");C.className="field-container",c.appendChild(C);var g=document.createElement("label");g.textContent=f,g.className="field-label",C.appendChild(g);var E=document.createElement("input");E.type="text",E.name=f,E.value=t[f],E.className="field-input",C.appendChild(E)}var b=document.createElement("div");b.className="operator-container",c.appendChild(b);var P=document.createElement("label");P.textContent="OP",P.classList.add("sutra-keyword"),b.appendChild(P);var x=document.createElement("select");x.name="op",x.className="operator-select",b.appendChild(x),n.forEach(function(e){var n=document.createElement("option");n.value=e,n.text=e,x.appendChild(n),t.op===e&&(n.selected=!0)});var k=document.createElement("button");k.type="submit",k.textContent="Save",k.className="save-button",c.appendChild(k),k.onclick=function(t){t.preventDefault();var n=c.querySelector('input[name="propertyType"]:checked').value,r=a.behavior.getCondition(e),i=[];Array.isArray(r)?r.forEach(function(e,t){i.push(e)}):i.push(r);var d=o.serializeFormToJSON(c);"property"===n&&delete d.gamePropertyPath,"gamePropertyPath"===n&&delete d.property,i.push(d),console.log("updating",e,i),o.behavior.updateCondition(e,i,!0);var l=a.behavior.getCondition(e);console.log("updatedCondition",l)},void 0!==t.property?l.input.checked=!0:void 0!==t.gamePropertyPath&&(p.input.checked=!0),s()},createConditional:function(e,t){e.preventDefault();var n=new FormData(e.target),a=n.get("conditionalType"),o=t?t.action:"newConditional";if("function"===a){var r=new Function("return "+n.get("conditionalFunction"))();this.behavior.updateCondition(o,r)}else{var i={op:n.get("dslOperator"),property:n.get("dslProperty"),value:n.get("dslValue")};this.behavior.updateCondition(o,i)}this.redrawBehaviorTree()},onConditionalTypeChange:function(e,t){var n=document.getElementById("conditionalInputContainer");if("function"===e){var a=t&&"function"==typeof t.condition?t.condition.toString():"";n.innerHTML='<textarea name="conditionalFunction">'.concat(a,"</textarea>")}else{var o=t&&t.condition&&t.condition.property?t.condition.property:"",r=t&&t.condition&&t.condition.value?t.condition.value:"",i=t&&t.condition&&t.condition.op?t.condition.op:"";n.innerHTML='\n      <input name="dslProperty" placeholder="Property" value="'.concat(o,'">\n      <input name="dslValue" placeholder="Value" value="').concat(r,'">\n      <select name="dslOperator">\n        ').concat(this.behavior.getOperators().map(function(e){return'<option value="'.concat(e,'" ').concat(e===i?"selected":"",">").concat(e,"</option>")}).join(""),"\n      </select>\n    ")}}},_default=exports.default=editor;

},{"../../gui-editor/gui.js":1,"./editor/componentsSelect.js":6}],5:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=showActionForm;var _gui=_interopRequireDefault(require("../../../gui-editor/gui.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function showActionForm(e){}

},{"../../../gui-editor/gui.js":1}],6:[function(require,module,exports){
"use strict";function componentsSelect(e,t){var n=document.createElement("div");n.className="field-container";var a=document.createElement("label");a.textContent=e,a.className="field-label",a.classList.add("sutra-keyword"),n.appendChild(a);var l=document.createElement("select");return l.id=e,l.name=e,t.forEach(function(e){var t=document.createElement("option");t.value=e,t.text=e,l.appendChild(t)}),n.appendChild(l),n}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=componentsSelect;

},{}],7:[function(require,module,exports){
"use strict";function _typeof(o){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}function createConditionalForm(o,t){var n=this;console.log("creating conditional form",o,t);var e=this.behavior.getCondition(o);console.log("conditional",e),e||(console.log("condition not found",o),e={op:"==",property:"type",value:"block"}),Array.isArray(e)?e.forEach(function(t,e){var i=document.createElement("div");i.id="conditional-".concat(o,"-").concat(e),i.className="conditional-array-item","function"==typeof t?n.showFunctionEditor("".concat(o,"-").concat(e),t,i):"object"===_typeof(t)?n.showObjectEditor("".concat(o,"-").concat(e),t,n.behavior.operators,i):console.log("Unknown conditional type in array"),n.sutraFormView.querySelector(".gui-content").appendChild(i)}):"function"==typeof e?this.showFunctionEditor(o,e):"object"===_typeof(e)?this.showObjectEditor(o,e,this.behavior.operators):console.log("Unknown conditional type");var i=this.sutraFormView.querySelector(".gui-content"),r=document.createElement("div");r.className="footer",r.innerHTML="<h3>Individual Condition Footer</h3>",i.appendChild(r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=createConditionalForm;

},{}],8:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=showConditionalsForm;var _gui=_interopRequireDefault(require("../../../gui-editor/gui.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function showConditionalsForm(t){var n=this;void 0===t&&(t={sutraPath:"tree",action:"newConditional",if:"newConditional",then:[{action:"newAction"}]}),document.getElementById("sutraFormView")||(this.sutraFormView=_gui.default.window("sutraFormView","Sutra Condition Editor",function(){var t=document.getElementById("sutraFormView");t&&t.remove()})),_gui.default.bringToFront(this.sutraFormView);var o=this.sutraFormView.querySelector(".gui-content");o.innerHTML="";var a=document.createElement("div");a.className="node-info";var e="";Array.isArray(t.if)?t.if.forEach(function(n,o){e+=o>0?'<strong class="sutra-keyword">AND</strong> <span="openCondition" class="sutra-link" data-path="'.concat(t.sutraPath,'">').concat(n,"</span>"):'<span="openCondition" class="sutra-link" data-path="'.concat(t.sutraPath,'">').concat(n,"</span>")}):e=t.if;var r=this.behavior.getReadableSutraPath(t.sutraPath)||"root";console.log("humanPath",r),r=(r=r.replace("and","")).split(" ");var i="";r.forEach(function(n,o){i+=o>0?' <strong class="sutra-keyword">..</strong> <span="openCondition" class="sutra-link" data-path="'.concat(t.sutraPath,'">').concat(n,"</span>"):'<span="openCondition" class="sutra-link" data-path="'.concat(t.sutraPath,'">').concat(n,"</span>")});var s=document.createElement("div");s.innerHTML='<strong class="sutra-keyword">ROOT</strong> '.concat(r),a.appendChild(s);var c=document.createElement("div");if(c.innerHTML='<strong class="sutra-keyword">IF</strong> '.concat(e),a.appendChild(c),t.then&&Array.isArray(t.then)&&void 0!==t.then[0].action){var d=document.createElement("div");d.innerHTML='<strong class="sutra-keyword">THEN</strong> '.concat(t.then[0].action),d.addEventListener("click",function(o){o.preventDefault(),n.showActionForm(t.then[0])}),a.appendChild(d)}if(o.appendChild(a),Array.isArray(t.if))t.if.forEach(function(o){n.createConditionalForm(o,t)});else{var u=this.behavior.getCondition(t.if);u||(console.log("condition not found",t.if),u={op:"==",property:"type",value:"block"}),Array.isArray(u.conditions)?u.conditions.forEach(function(o,a){n.behavior.getCondition(o);n.createConditionalForm(o,t)}):this.createConditionalForm(t.if,t)}var l=document.createElement("div");l.className="footer",l.innerHTML="<h3>Entire Condition Footer</h3>",o.appendChild(l),_gui.default.bringToFront(this.sutraFormView)}

},{"../../../gui-editor/gui.js":1}],9:[function(require,module,exports){
"use strict";function createLabel(e,t){var a=document.createElement("label");return a.textContent=e,a.className="param-label",a.style.marginLeft="10px",a.style.fontWeight="bold",a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=createLabel;

},{}],10:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=dataForm;var _actionForm=_interopRequireDefault(require("./actionForm.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dataForm(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.createDataContainer=createDataContainer.bind(this),this.createNestedDataContainer=createNestedDataContainer.bind(this),this.redrawComponent=redrawComponent.bind(this),this.showAddPropertyForm=showAddPropertyForm.bind(this),this.addPropertyToNestedNode=addPropertyToNestedNode.bind(this),this.createObjectInput=createObjectInput.bind(this),this.createValueInput=createValueInput.bind(this),this.actionForm=_actionForm.default.bind(this);var a=document.createElement("div");a.className="data-container",a.classList.add("with-container"),a.setAttribute("data-path",e.sutraPath);var r=document.createElement("label");r.className="with-label",r.innerHTML='<span class="sutra-keyword">WITH</span>',a.setAttribute("data-path",e.sutraPath),a.appendChild(r);var o=this.createDataContainer(e,n);a.appendChild(o);var c=document.createElement("button");return c.innerText="Add Property",c.onclick=function(){return t.showAddPropertyForm(e,n,a)},a.appendChild(c),a}function createDataContainer(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;console.log("creating a data container",e,n);var a=document.createElement("div");return a.className="action-form",Object.keys(e.data).forEach(function(r){var o=r;if("object"===_typeof(e.data[r])&&null!==e.data[r]){var c=t.createLabel(r,n);a.appendChild(c);var d=t.createNestedDataContainer(e.data[r],n+1,o);d.dataset.key=r,a.appendChild(d);var i=document.createElement("button");i.innerText="Add Property",i.onclick=function(){return t.showAddPropertyForm(e,n,a)},i.style.marginLeft="".concat(n+20,"px"),a.appendChild(i)}else{var u=t.createInputGroup(e,r,n,o);a.appendChild(u)}}),a}function showAddPropertyForm(e,t,n){var a=this,r=document.createElement("form"),o=createTypeSelect(),c=this.createValueInput("string");o.onchange=function(){var e=this.value;r.replaceChild(a.createValueInput(e,t),c),c=r.elements.value},r.appendChild(createLabelInputPair("Key","text","key")),r.appendChild(o),r.appendChild(c),r.appendChild(createButton("Save","submit")),r.appendChild(createButton("Cancel")),r.lastChild.onclick=function(e){e.preventDefault(),n.removeChild(r)},r.onsubmit=function(r){r.preventDefault();var d=r.target.elements.key.value,i=parseValueFromInput(c,o.value);t>0?a.addPropertyToNestedNode(e,d,i,n,t):(addPropertyToNode(e,d,i),a.redrawComponent(e,t,n))},n.appendChild(r)}function addPropertyToNestedNode(e,t,n,a,r){var o=this;for(e[t]=n;a.firstChild;)a.removeChild(a.firstChild);var c=this.createDataContainer({data:e},r);a.appendChild(c),a.appendChild(createButton("Add Nested Property","button",function(){return o.showAddPropertyForm(e,r,a)}))}function createLabelInputPair(e,t,n){var a=document.createElement("label");a.textContent="".concat(e,": "),a.classList.add("data-label");var r=document.createElement("input");return r.type=t,r.name=n,a.appendChild(r),a}function createTypeSelect(){var e=document.createElement("select");return["string","number","boolean","object","array","function","null"].forEach(function(t){var n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)}),e}function createValueInput(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(e){case"boolean":var n=document.createElement("input");return n.type="checkbox",n.name="value",n;case"object":return this.createObjectInput(t+1);case"array":return createArrayInput();case"function":return createFunctionInput();case"null":var a=document.createElement("input");return a.disabled=!0,a.name="value",a;default:var r=document.createElement("input");return r.type=e,r.name="value",r.placeholder="Value",r}}function createObjectInput(e){var t=this,n={},a=document.createElement("div");a.className="nested-data-container nested-level-".concat(e);var r=document.createElement("button");return r.textContent="Add Nested Property",r.onclick=function(){t.showAddPropertyForm(n,e+1,a)},a.appendChild(r),a}function createArrayInput(){var e=document.createElement("div"),t=document.createElement("button");return t.textContent="Add Item",t.onclick=function(){e.appendChild(createArrayItemInput())},e.appendChild(t),e}function createFunctionInput(){var e=document.createElement("textarea");return e.placeholder="Enter function body here...",e}function createKeyValuePairInput(){var e=document.createElement("div"),t=document.createElement("input");t.placeholder="Key";var n=this.createValueInput("string");return e.appendChild(t),e.appendChild(n),e}function createArrayItemInput(){var e=document.createElement("div"),t=this.createValueInput("string"),n=document.createElement("button");return n.textContent="Delete",n.onclick=function(){e.remove()},e.appendChild(t),e.appendChild(n),e}function parseValueFromInput(e,t){switch(console.log("parseValueFromInput",e,t),t){case"number":return parseFloat(e.value)||0;case"boolean":return e.checked;case"null":return null;default:return e.value}}function createButton(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"button",n=document.createElement("button");return n.type=t,n.textContent=e,n}function addPropertyToNode(e,t,n){e.data[t]=n}function redrawComponent(e,t,n){var a=this.sutraActionEditor.querySelector(".gui-content");a.innerHTML="";var r=this.actionForm(e);a.appendChild(r)}function createNestedDataContainer(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=document.createElement("div");return r.className="nested-data-container nested-level-"+t,Object.keys(e).forEach(function(o){var c=a?"".concat(a,".").concat(o):o;if("object"===_typeof(e[o])&&null!==e[o]){var d=n.createLabel(o,t);r.appendChild(d);var i=n.createNestedDataContainer(e[o],t+1,c);i.dataset.key=o,r.appendChild(i)}else{var u=n.createInputGroup({data:e},o,t,c);r.appendChild(u)}}),r}

},{"./actionForm.js":5}],11:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dataView(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.createDataContainer=createDataContainer.bind(this),this.createNestedDataContainer=createNestedDataContainer.bind(this),this.createLabel=createLabel.bind(this),this.createValueDisplay=createValueDisplay.bind(this);var t=document.createElement("div");t.className="data-container",t.classList.add("with-container"),t.setAttribute("data-path",e.sutraPath);var n=document.createElement("label");n.className="with-label",n.innerHTML='<span class="sutra-keyword">WITH</span>',t.appendChild(n);var r=this.createDataContainer(e,a);return t.appendChild(r),t}function createDataContainer(e,a){var t=this,n=document.createElement("div");return n.className="",Object.keys(e.data).forEach(function(r){var c=r;if("object"===_typeof(e.data[r])&&null!==e.data[r]){var i=t.createLabel(r,a);n.appendChild(i);var l=t.createNestedDataContainer(e.data[r],a+1,c);n.appendChild(l)}else{var d=t.createValueDisplay(r,e.data[r],a,c);n.appendChild(d)}}),n}function createNestedDataContainer(e,a){var t=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=document.createElement("div");return r.className="nested-data-container nested-level-"+a,Object.keys(e).forEach(function(c){var i=n?"".concat(n,".").concat(c):c;if("object"===_typeof(e[c])&&null!==e[c]){var l=t.createLabel(c,a);r.appendChild(l);var d=t.createNestedDataContainer(e[c],a+1,i);r.appendChild(d)}else{var o=t.createValueDisplay(c,e[c],a,i);r.appendChild(o)}}),r}function createLabel(e,a){var t=document.createElement("label");return t.className="data-label",t.innerText=e,console.log("CRETING LABEL",e,a),t.style.paddingLeft="".concat(20*a,"px"),t}function createValueDisplay(e,a,t,n){var r=document.createElement("div");r.className="data-value-wrapper",r.style.paddingLeft="".concat(20*t,"px");var c=document.createElement("label");c.className="data-key",c.innerText=e+":",r.appendChild(c);var i=document.createElement("div");return i.className="data-value",i.innerText=a,r.appendChild(i),r.setAttribute("data-path",n),r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=dataView;

},{}],12:[function(require,module,exports){
"use strict";function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(r,e){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var n,o,a,i,l=[],u=!0,f=!1;try{if(a=(t=t.call(r)).next,0===e){if(Object(t)!==t)return;u=!1}else for(;!(u=(n=a.call(t)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(r){f=!0,o=r}finally{try{if(!u&&null!=t.return&&(i=t.return(),Object(i)!==i))return}finally{if(f)throw o}}return l}}function _arrayWithHoles(r){if(Array.isArray(r))return r}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,o=function(){};return{s:o,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){t=t.call(r)},n:function(){var r=t.next();return i=r.done,r},e:function(r){l=!0,a=r},f:function(){try{i||null==t.return||t.return()}finally{if(l)throw a}}}}function _unsupportedIterableToArray(r,e){if(r){if("string"==typeof r)return _arrayLikeToArray(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function serializeFormsInDOMElement(r){var e={};function t(r){var t,n=_createForOfIteratorHelper(new FormData(r));try{var o=function(){var r=_slicedToArray(t.value,2),n=r[0],o=r[1],a=n.split(".");a.reduce(function(r,e,t){return t===a.length-1?r[e]=coerceType(o):r[e]=r[e]||{},r[e]},e)};for(n.s();!(t=n.n()).done;)o()}catch(r){n.e(r)}finally{n.f()}}return"FORM"===r.tagName?(t(r),e):(r.querySelectorAll("form").forEach(function(r){return t(r)}),e)}function coerceType(r){if("true"===r.toLowerCase())return!0;if("false"===r.toLowerCase())return!1;var e=Number(r);return isNaN(e)||e.toString()!==r?r:e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=serializeFormsInDOMElement;

},{}]},{},[2])(2)
});

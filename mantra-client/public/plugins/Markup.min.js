(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}(g.PLUGINS || (g.PLUGINS = {})).Markup = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(t);if(e){var o=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(t,e){if(e&&("object"===_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _wrapNativeSuper(t){var e="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,t)})(t)}function _construct(t,e,r){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&_setPrototypeOf(o,r.prototype),o}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function _isNativeFunction(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,r){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Markup=exports.default=function(){function Markup(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).displayOriginalHTML,e=void 0!==t&&t;_classCallCheck(this,Markup),this.id=Markup.id,this.originalHTML="",this.displayOriginalHTML=e}return _createClass(Markup,[{key:"init",value:function(t){this.game=t,this.saveOriginalHTML(),this.game.systemsManager.addSystem(Markup.id,this)}},{key:"removeAllCustomElements",value:function(t){var e=Array.from(Object.keys(t.systems)).map(function(t){return"m-".concat(t.toLowerCase())});document.querySelectorAll(e.join(",")).forEach(function(t){return t.remove()})}},{key:"defineCustomElements",value:function(t){t.plugins.forEach(function(t){var e="m-".concat(t.toLowerCase());if(!customElements.get(e)){var r=function(t){_inherits(r,_wrapNativeSuper(HTMLElement));var e=_createSuper(r);function r(){return _classCallCheck(this,r),e.call(this)}return _createClass(r)}();customElements.define(e,r)}})}},{key:"parseCustomDomElements",value:function(t){console.log("Parsing custom DOM elements...",t);var e=t.systemsManager.systems,r=this;function n(e){var n="m-".concat(e.id.toLowerCase());document.querySelectorAll(n).forEach(function(n){var o,i=new Set(["color","background","fontSize","border","border-top","border-right","border-bottom","border-left","border-width","border-top-width","border-right-width","border-bottom-width","border-left-width","border-style","border-top-style","border-right-style","border-bottom-style","border-left-style","border-color","border-top-color","border-right-color","border-bottom-color","border-left-color","background-color","background-image","background-repeat","background-position","background-size","margin","margin-top","margin-right","margin-bottom","margin-left","padding","padding-top","padding-right","padding-bottom","padding-left","font","font-family","font-size","font-weight","font-style","text-decoration","text-align","text-transform","text-shadow","line-height","letter-spacing","word-spacing","white-space","vertical-align","list-style","list-style-type","list-style-position","list-style-image","cursor","z-index","opacity","visibility","display"]),a=window.getComputedStyle(n),c={},u=_createForOfIteratorHelper(a);try{for(u.s();!(o=u.n()).done;){var l=o.value;i.has(l)&&(c[l]=a[l])}}catch(t){u.e(t)}finally{u.f()}var s=e.constructor.name,f=t.make();"function"!=typeof f[s]?console.warn("Markup parsed an unknown tag type, using default instead. tag type:",s):(f[s](f.config),console.log("ENT IS NOW",f.config.type,f.config)),f.style(c),r.buildEntity(f,n)})}n(t.systems.container);var o,i=_createForOfIteratorHelper(e.values());try{for(i.s();!(o=i.n()).done;){var a=o.value;"container"!==a.id&&n(a)}}catch(t){i.e(t)}finally{i.f()}console.log("All entities created.")}},{key:"parseDl",value:function(t,e){var r=this,n=t.querySelectorAll("dt"),o=t.querySelectorAll("dd");n.forEach(function(t,n){var i=t.textContent.trim(),a=o[n],c=a.querySelector("dl");if(c){var u={};r.parseDl(c,u),e[i]=u}else e[i]=a.textContent.trim()})}},{key:"buildEntity",value:function buildEntity(ent,entity){var _this2=this,width=parseInt(entity.getAttribute("width"),10)||16,height=parseInt(entity.getAttribute("height"),10)||16,x=parseInt(entity.getAttribute("data-x"),10)||0,y=parseInt(entity.getAttribute("data-y"),10)||0,repeat=parseInt(entity.getAttribute("data-repeat"),10)||1,texture=entity.getAttribute("data-texture")||null,color=entity.getAttribute("data-color")||null,layout=entity.getAttribute("data-layout")||null,origin=entity.getAttribute("data-origin")||null,isStatic="true"===entity.getAttribute("data-is-static");isStatic&&ent.isStatic(!0);var pointerdown=entity.getAttribute("onpointerdown")||null;"m-text"===entity.tagName.toLowerCase()&&ent.text(entity.innerHTML);var collisionStart=entity.getAttribute("data-collision-start")||null;ent.x(x).y(y).z(10).width(width).height(height),texture&&ent.texture(texture),color&&ent.color(color),layout&&ent.layout(layout),origin&&ent.origin(origin),ent.pointerdown(function(){pointerdown&&eval(pointerdown)}),ent.collisionStart(function(t,e,r,n){window[collisionStart]&&window[collisionStart](t,e,r,n)});var dls=entity.querySelectorAll("dl");if(dls.length>0){var meta={};dls.forEach(function(t){return _this2.parseDl(t,meta)}),console.log("Assigning meta:",meta),ent.meta(meta)}var containerName=entity.getAttribute("data-name");containerName&&ent.name(containerName);var parentContainer=entity.closest("m-container");if(parentContainer){var parentContainerName=parentContainer.getAttribute("data-name");parentContainerName&&ent.container(parentContainerName)}repeat>1&&ent.repeat(repeat),ent.createEntity()}},{key:"preview",value:function(){var t=this.game;Object.keys(t.systems).forEach(function(t){var e="m-".concat(t.toLowerCase());document.querySelectorAll(e).forEach(function(t){var e=parseInt(t.getAttribute("data-x")||0,10)+window.innerWidth/2,r=parseInt(t.getAttribute("data-y")||0,10)+window.innerHeight/2;t.style.position="absolute",t.style.left="".concat(e,"px"),t.style.top="".concat(r,"px")})}),this.displayOrignalHTMLInPreTag()}},{key:"saveOriginalHTML",value:function(){this.originalHTML=document.body.innerHTML}},{key:"displayOrignalHTMLInPreTag",value:function(){var t=document.createElement("pre");t.textContent=this.originalHTML,document.body.appendChild(t),document.querySelector("#gameHolder").appendChild(t)}},{key:"generateMarkup",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){var t="",e=this.game.data.ents._;return Object.keys(e).forEach(function(r){var n=e[r];t+="<m-".concat(n.type.toLowerCase().replace("_","-")),t+=' data-x="'.concat(n.position.x,'" data-y="').concat(n.position.y,'"'),void 0!==n.position.z&&(t+=' data-z="'.concat(n.position.z,'"')),void 0!==n.isStatic&&(t+=' data-is-static="'.concat(n.isStatic,'"')),void 0!==n.x&&(t+=' data-x="'.concat(n.x,'"')),void 0!==n.y&&(t+=' data-y="'.concat(n.y,'"')),void 0!==n.width&&(t+=' data-width="'.concat(n.width,'"')),void 0!==n.height&&(t+=' data-height="'.concat(n.height,'"')),void 0!==n.texture&&(t+=' data-texture="'.concat(JSON.stringify(n.texture),'"')),void 0!==n.name&&(t+=' data-name="'.concat(n.name,'"')),void 0!==n.layout&&(t+=' data-layout="'.concat(n.layout,'"')),void 0!==n.origin&&(t+=' data-origin="'.concat(n.origin,'"')),void 0!==n.repeat&&(t+=' data-repeat="'.concat(n.repeat,'"')),t+=">",n.children&&n.children.length>0&&(t+=generateMarkup(n.children)),t+="</m-".concat(n.type.toLowerCase().replace("_","-"),">\n")}),t})},{key:"parseHTML",value:function(t){var e=this.game;this.defineCustomElements(e),this.parseCustomDomElements(e),this.removeAllCustomElements(e),(t||this.displayOriginalHTML)&&this.displayOrignalHTMLInPreTag()}}]),Markup}();_defineProperty(Markup,"id","markup");

},{}]},{},[1])(1)
});

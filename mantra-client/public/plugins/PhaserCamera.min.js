(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}(g.PLUGINS || (g.PLUGINS = {})).PhaserCamera = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function _typeof(o){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}function _classCallCheck(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(o,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,_toPropertyKey(i.key),i)}}function _createClass(o,e,t){return e&&_defineProperties(o.prototype,e),t&&_defineProperties(o,t),Object.defineProperty(o,"prototype",{writable:!1}),o}function _defineProperty(o,e,t){return(e=_toPropertyKey(e))in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}function _toPropertyKey(o){var e=_toPrimitive(o,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(o,e){if("object"!==_typeof(o)||null===o)return o;var t=o[Symbol.toPrimitive];if(void 0!==t){var i=t.call(o,e||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(o)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var PhaserCamera=function(){function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,o),this.id=o.id,this.scene=e,this.camera=e.cameras.main,this.config=t,this.follow=!0,this.isDragging=!1,this.dragInertia={x:0,y:0},this.isThrowing=!1,this.initZoomControls()}return _createClass(o,[{key:"init",value:function(o){this.game=o,this.game.setZoom=this.setZoom.bind(this),this.game.systemsManager.addSystem("graphics-phaser-camera",this),this.scene.input.on("pointerdown",this.onPointerDown.bind(this)),this.scene.input.on("pointermove",this.onPointerMove.bind(this)),this.scene.input.on("pointerup",this.onPointerUp.bind(this))}},{key:"update",value:function(){var o=this.scene.cameras.main,e=this.game.getEntity(this.game.currentPlayerId);o&&e&&e.graphics&&e.graphics["graphics-phaser"]&&(!this.follow||this.isDragging||this.isThrowing||o.centerOn(e.position.x,e.position.y),this.followingPlayer=!0)}},{key:"onPointerDown",value:function(o){o.rightButtonDown()&&(this.isDragging=!0,this.follow=!1,this.lastPointerPosition={x:o.x,y:o.y})}},{key:"onPointerMove",value:function(o){if(this.isDragging){var e=o.x-this.lastPointerPosition.x,t=o.y-this.lastPointerPosition.y;this.camera.scrollX-=e/this.camera.zoom,this.camera.scrollY-=t/this.camera.zoom,this.lastPointerPosition={x:o.x,y:o.y}}}},{key:"onPointerUp",value:function(o){this.isDragging&&(this.isDragging=!1)}},{key:"initZoomControls",value:function(){var o=this;this.scene.input.on("wheel",function(e,t,i,n,r){var a=zoom.current;a*=n<0?1.5:.6,a=Math.min(Math.max(a,zoom.minZoom),zoom.maxZoom),zoom.tweenTo(o.scene,a,666)})}},{key:"applyThrow",value:function(){if(this.isThrowing){this.camera.scrollX-=this.dragInertia.x/this.camera.zoom,this.camera.scrollY-=this.dragInertia.y/this.camera.zoom,this.dragInertia.x*=.95,this.dragInertia.y*=.95,Math.abs(this.dragInertia.x)<.1&&Math.abs(this.dragInertia.y)<.1&&(this.isThrowing=!1,this.scene.time.removeAllEvents())}}},{key:"tweenToZoom",value:function(o){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&arguments[2]}},{key:"zoomIn",value:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;zoom.zoomIn(this.scene,o)}},{key:"zoomOut",value:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;zoom.zoomOut(this.scene,o)}},{key:"setZoom",value:function(o){zoom.set(this.scene,o)}},{key:"startFollowing",value:function(o){}}]),o}();_defineProperty(PhaserCamera,"id","phaser-camera");var _default=exports.default=PhaserCamera,zoom={maxZoom:16,minZoom:.05,current:.1,tweening:!1,init:function(o){}},currentZoomTween=null,zoomTweenDelay=333,lastZoomTweenTime=0;zoom.tweenTo=function(o,e,t,i){void 0===t&&(t=1e3);var n=(new Date).getTime();zoom.tweening&&void 0!==currentZoomTween&&n-lastZoomTweenTime>zoomTweenDelay&&currentZoomTween.stop(),zoom.tweening=!0,lastZoomTweenTime=(new Date).getTime(),e=Math.max(Math.min(e,zoom.maxZoom),zoom.minZoom),currentZoomTween=o.tweens.add({targets:o.cameras.main,zoom:e,duration:t,ease:"Sine.easeInOut",onUpdate:function(o){zoom.current=o.getValue()},onComplete:function(){zoom.tweening=!1,"function"==typeof i&&i()}})},zoom.zoomIn=function(o,e){(void 0===e&&(e=.01),zoom.tweening)||(e*=1/(2*o.cameras.main.zoom),o.cameras.main.zoom>=zoom.maxZoom||(o.cameras.main.zoom+=e))},zoom.zoomOut=function(o,e){(void 0===e&&(e=-.01),zoom.tweening)||(e*=(o.cameras.main.zoom-zoom.minZoom)/(zoom.maxZoom-zoom.minZoom),o.cameras.main.zoom<=zoom.minZoom||(o.cameras.main.zoom+=e,o.game.G.currentZoom=o.cameras.main.zoom))},zoom.set=function(o,e){zoom.tweening||(e>zoom.maxZoom&&(e=zoom.maxZoom),e<zoom.minZoom&&(e=zoom.minZoom),o.cameras.main.zoom=e,o.game.G.currentZoom=o.cameras.main.zoom,zoom.current=e)};

},{}]},{},[1])(1)
});

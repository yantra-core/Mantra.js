(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}(g.PLUGINS || (g.PLUGINS = {})).Tone = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _DrumKit=_interopRequireDefault(require("./instruments/DrumKit.js")),_startUp=_interopRequireDefault(require("./jingles/start-up.js")),_keyCodes=_interopRequireDefault(require("./keyCodes.js")),_harmonicShift=_interopRequireDefault(require("./util/harmonicShift.js")),_playJingle=_interopRequireDefault(require("./util/playJingle.js")),_playSpatialSound=_interopRequireDefault(require("./util/playSpatialSound.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var TonePlugin=function(){function t(){_classCallCheck(this,t),this.id=t.id,this.playIntro=!1,this.userEnabled=!1,this.lastNotePlayed=null,this.keyCodes=_keyCodes.default,this.toneStarted=!1}return _createClass(t,[{key:"init",value:function(t){var e=this;this.game=t,this.bindUtilityFunctions(),"undefined"==typeof Tone?(console.log("Tone is not defined, attempting to load it from vendor"),t.loadScripts(["/vendor/tone.min.js"],function(){return e.toneReady()})):this.toneReady()}},{key:"bindUtilityFunctions",value:function(){this.harmonicShift=_harmonicShift.default.bind(this),this.playJingle=_playJingle.default.bind(this),this.playSpatialSound=_playSpatialSound.default.bind(this),this.game.systemsManager.addSystem(this.id,this)}},{key:"toneReady",value:function(){this.synth=(new Tone.Synth).toDestination(),this.drumKit=new _DrumKit.default,this.limiter=new Tone.Limiter(-6).toDestination(),this.synth.connect(this.limiter),this.synth.volume.value=-3,Tone.Transport.lookAhead=.5,this.game.playSpatialSound=this.playSpatialSound,this.game.playDrum=this.playDrum.bind(this),this.game.playNote=this.playNote.bind(this),console.log("Tone is ready",_startUp.default),this.playIntro&&this.playJingle(_startUp.default),this.game.emit("plugin::ready::tone",this)}},{key:"playNote",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;n=Math.min(Math.max(n,0),.5),t=t||this.selectRandomNote(),this.lastNotePlayed=t;try{this.synth.triggerAttackRelease(t,e,i,n)}catch(t){console.log("WARNING: Tone.js synth not ready yet. Skipping note play",t)}}},{key:"playDrum",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"kick";this.startTone(),this.drumKit.play(t)}},{key:"startTone",value:function(){this.toneStarted||(Tone.start(),this.toneStarted=!0)}},{key:"selectRandomNote",value:function(){var t=Object.keys(this.keyCodes),e=t[Math.floor(Math.random()*t.length)];return this.lastNotePlayed&&(e=this.harmonicShift(this.lastNotePlayed,{type:"perfectFifth"})||this.harmonicShift("C4",{type:"perfectFifth"})),this.keyCodes[e].toneCode}}]),t}();_defineProperty(TonePlugin,"id","tone"),_defineProperty(TonePlugin,"async",!0);var _default=exports.default=TonePlugin;

},{"./instruments/DrumKit.js":2,"./jingles/start-up.js":3,"./keyCodes.js":4,"./util/harmonicShift.js":5,"./util/playJingle.js":6,"./util/playSpatialSound.js":7}],2:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var DrumKit=exports.default=function(){function e(){_classCallCheck(this,e),this.kick=(new Tone.MembraneSynth).toDestination(),this.snare=new Tone.NoiseSynth({noise:{type:"white"},envelope:{attack:.005,decay:.1,sustain:0}}).toDestination(),this.hiHatClosed=new Tone.MetalSynth({frequency:200,envelope:{attack:.001,decay:.1,sustain:0},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5}).toDestination(),this.hiHatOpen=new Tone.MetalSynth({frequency:200,envelope:{attack:.001,decay:.3,sustain:0},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5}).toDestination(),this.tomLow=new Tone.MembraneSynth({pitchDecay:.05,octaves:4,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01}}).toDestination(),this.tomHigh=new Tone.MembraneSynth({pitchDecay:.05,octaves:6,oscillator:{type:"sine"},envelope:{attack:.001,decay:.2,sustain:.01}}).toDestination()}return _createClass(e,[{key:"play",value:function(e){switch(e){case"kick":this.kick.triggerAttackRelease("C1","8n");break;case"snare":this.snare.triggerAttackRelease("8n");break;case"hat":case"hiHatClosed":this.hiHatClosed.triggerAttackRelease("32n");break;case"hiHatOpen":this.hiHatOpen.triggerAttackRelease("8n");break;case"tomLow":this.tomLow.triggerAttackRelease("G2","8n");break;case"tomHigh":this.tomHigh.triggerAttackRelease("A4","8n");break;default:console.log("Unknown drum sound")}}}]),e}();

},{}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default=exports.default={header:{keySignatures:[],meta:[],name:"Single Staff",ppq:480,tempos:[{bpm:145.03368407312598,ticks:0}],timeSignatures:[{ticks:0,timeSignature:[4,4],measures:0}]},tracks:[{channel:0,controlChanges:{0:[{number:0,ticks:0,time:0,value:0}],32:[{number:32,ticks:0,time:0,value:0}]},pitchBends:[],instrument:{family:"piano",number:0,name:"acoustic grand piano"},name:"Track 1",notes:[],endOfTrackTicks:7680},{channel:0,controlChanges:{},pitchBends:[],instrument:{family:"reed",number:71,name:"clarinet"},name:"",notes:[{duration:.13100404999999998,durationTicks:152,midi:55,name:"G3",ticks:0,time:0,velocity:.7874015748031497},{duration:.13100404999999998,durationTicks:152,midi:60,name:"C4",ticks:159,time:.13703713125,velocity:.7874015748031497},{duration:.13014218125,durationTicks:151,midi:64,name:"E4",ticks:319,time:.27493613125,velocity:.7874015748031497},{duration:.13100405000000004,durationTicks:152,midi:67,name:"G4",ticks:480,time:.413697,velocity:.7874015748031497},{duration:.13100404999999993,durationTicks:152,midi:72,name:"C5",ticks:639,time:.55073413125,velocity:.7874015748031497},{duration:.1301421812500001,durationTicks:151,midi:76,name:"E5",ticks:799,time:.6886331312499999,velocity:.7874015748031497},{duration:.3930121500000001,durationTicks:456,midi:79,name:"G5",ticks:960,time:.827394,velocity:.7874015748031497},{duration:.3930121500000001,durationTicks:456,midi:76,name:"E5",ticks:1440,time:1.241091,velocity:.7874015748031497},{duration:.13100404999999982,durationTicks:152,midi:56,name:"G#3",ticks:1920,time:1.654788,velocity:.7874015748031497},{duration:.13100405000000004,durationTicks:152,midi:60,name:"C4",ticks:2079,time:1.7918251312499998,velocity:.7874015748031497},{duration:.1301421812500001,durationTicks:151,midi:63,name:"D#4",ticks:2239,time:1.92972413125,velocity:.7874015748031497},{duration:.13100405000000004,durationTicks:152,midi:68,name:"G#4",ticks:2400,time:2.068485,velocity:.7874015748031497},{duration:.1310040499999996,durationTicks:152,midi:72,name:"C5",ticks:2559,time:2.20552213125,velocity:.7874015748031497},{duration:.1301421812500001,durationTicks:151,midi:75,name:"D#5",ticks:2719,time:2.34342113125,velocity:.7874015748031497},{duration:.3930121500000001,durationTicks:456,midi:80,name:"G#5",ticks:2880,time:2.482182,velocity:.7874015748031497},{duration:.3930121500000001,durationTicks:456,midi:75,name:"D#5",ticks:3360,time:2.895879,velocity:.7874015748031497},{duration:.13100405000000004,durationTicks:152,midi:58,name:"A#3",ticks:3840,time:3.309576,velocity:.7874015748031497},{duration:.1310040499999996,durationTicks:152,midi:62,name:"D4",ticks:3999,time:3.4466131312500004,velocity:.7874015748031497},{duration:.1301421812500001,durationTicks:151,midi:65,name:"F4",ticks:4159,time:3.5845121312499995,velocity:.7874015748031497},{duration:.13100405000000004,durationTicks:152,midi:70,name:"A#4",ticks:4320,time:3.723273,velocity:.7874015748031497},{duration:.1310040499999996,durationTicks:152,midi:74,name:"D5",ticks:4479,time:3.8603101312500003,velocity:.7874015748031497},{duration:.1301421812500001,durationTicks:151,midi:77,name:"F5",ticks:4639,time:3.9982091312499994,velocity:.7874015748031497},{duration:.39301214999999967,durationTicks:456,midi:82,name:"A#5",ticks:4800,time:4.13697,velocity:.7874015748031497},{duration:.1310040499999996,durationTicks:152,midi:82,name:"A#5",ticks:5280,time:4.550667,velocity:.7874015748031497},{duration:.1310040499999996,durationTicks:152,midi:82,name:"A#5",ticks:5439,time:4.68770413125,velocity:.7874015748031497},{duration:.1301421812500001,durationTicks:151,midi:82,name:"A#5",ticks:5599,time:4.825603131249999,velocity:.7874015748031497},{duration:.39301214999999967,durationTicks:456,midi:76,name:"E5",ticks:5760,time:4.964364,velocity:.7874015748031497}]},{channel:0,controlChanges:{0:[{number:0,ticks:0,time:0,value:0}],32:[{number:32,ticks:0,time:0,value:0}]},pitchBends:[],instrument:{family:"piano",number:0,name:"acoustic grand piano"},name:"Sequenced By",notes:[],endOfTrackTicks:7680},{channel:1,controlChanges:{},pitchBends:[],instrument:{family:"reed",number:71,name:"clarinet"},name:"",notes:[{duration:.13100404999999998,durationTicks:152,midi:52,name:"E3",ticks:160,time:.137899,velocity:.7086614173228346},{duration:.13100404999999998,durationTicks:152,midi:55,name:"G3",ticks:320,time:.275798,velocity:.7086614173228346},{duration:.13100405000000004,durationTicks:152,midi:60,name:"C4",ticks:480,time:.413697,velocity:.7086614173228346},{duration:.13100404999999993,durationTicks:152,midi:64,name:"E4",ticks:640,time:.551596,velocity:.7086614173228346},{duration:.13100405000000004,durationTicks:152,midi:67,name:"G4",ticks:800,time:.689495,velocity:.7086614173228346},{duration:.3930121500000001,durationTicks:456,midi:72,name:"C5",ticks:960,time:.827394,velocity:.7086614173228346},{duration:.3930121500000001,durationTicks:456,midi:67,name:"G4",ticks:1440,time:1.241091,velocity:.7086614173228346},{duration:.13100405000000026,durationTicks:152,midi:51,name:"D#3",ticks:2080,time:1.7926869999999997,velocity:.7874015748031497},{duration:.13100404999999982,durationTicks:152,midi:56,name:"G#3",ticks:2240,time:1.9305860000000001,velocity:.7874015748031497},{duration:.13100405000000004,durationTicks:152,midi:60,name:"C4",ticks:2400,time:2.068485,velocity:.7874015748031497},{duration:.13100405000000004,durationTicks:152,midi:63,name:"D#4",ticks:2560,time:2.206384,velocity:.7874015748031497},{duration:.13100405000000004,durationTicks:152,midi:68,name:"G#4",ticks:2720,time:2.344283,velocity:.7874015748031497},{duration:.3930121500000001,durationTicks:456,midi:72,name:"C5",ticks:2880,time:2.482182,velocity:.7086614173228346},{duration:.3930121500000001,durationTicks:456,midi:68,name:"G#4",ticks:3360,time:2.895879,velocity:.7086614173228346},{duration:.1310040499999996,durationTicks:152,midi:53,name:"F3",ticks:4e3,time:3.4474750000000003,velocity:.7874015748031497},{duration:.13100405000000004,durationTicks:152,midi:58,name:"A#3",ticks:4160,time:3.5853739999999994,velocity:.7874015748031497},{duration:.13100405000000004,durationTicks:152,midi:62,name:"D4",ticks:4320,time:3.723273,velocity:.7874015748031497},{duration:.1310040499999996,durationTicks:152,midi:65,name:"F4",ticks:4480,time:3.8611720000000003,velocity:.7874015748031497},{duration:.13100405000000004,durationTicks:152,midi:70,name:"A#4",ticks:4640,time:3.9990709999999994,velocity:.7874015748031497},{duration:.39301214999999967,durationTicks:456,midi:74,name:"D5",ticks:4800,time:4.13697,velocity:.7874015748031497},{duration:.39301214999999967,durationTicks:456,midi:74,name:"D5",ticks:5280,time:4.550667,velocity:.7874015748031497},{duration:.39301214999999967,durationTicks:456,midi:84,name:"C6",ticks:5760,time:4.964364,velocity:.7874015748031497}]},{channel:0,controlChanges:{0:[{number:0,ticks:0,time:0,value:0}],32:[{number:32,ticks:0,time:0,value:0}]},pitchBends:[],instrument:{family:"piano",number:0,name:"acoustic grand piano"},name:"MIDI225368@aol.com",notes:[],endOfTrackTicks:7680},{channel:2,controlChanges:{},pitchBends:[],instrument:{family:"reed",number:71,name:"clarinet"},name:"",notes:[{duration:.13100405000000004,durationTicks:152,midi:48,name:"C3",ticks:480,time:.413697,velocity:.7874015748031497},{duration:.13100404999999993,durationTicks:152,midi:52,name:"E3",ticks:639,time:.55073413125,velocity:.7874015748031497},{duration:.1301421812500001,durationTicks:151,midi:55,name:"G3",ticks:799,time:.6886331312499999,velocity:.7874015748031497},{duration:.3930121500000001,durationTicks:456,midi:64,name:"E4",ticks:960,time:.827394,velocity:.7874015748031497},{duration:.3930121500000001,durationTicks:456,midi:60,name:"C4",ticks:1440,time:1.241091,velocity:.7874015748031497},{duration:.13100405000000004,durationTicks:152,midi:48,name:"C3",ticks:2400,time:2.068485,velocity:.7874015748031497},{duration:.1310040499999996,durationTicks:152,midi:51,name:"D#3",ticks:2559,time:2.20552213125,velocity:.7874015748031497},{duration:.1301421812500001,durationTicks:151,midi:56,name:"G#3",ticks:2719,time:2.34342113125,velocity:.7874015748031497},{duration:.3930121500000001,durationTicks:456,midi:63,name:"D#4",ticks:2880,time:2.482182,velocity:.7874015748031497},{duration:.3930121500000001,durationTicks:456,midi:60,name:"C4",ticks:3360,time:2.895879,velocity:.7874015748031497},{duration:.19650607499999984,durationTicks:228,midi:50,name:"D3",ticks:4320,time:3.723273,velocity:.7874015748031497},{duration:.1310040499999996,durationTicks:152,midi:53,name:"F3",ticks:4479,time:3.8603101312500003,velocity:.7874015748031497},{duration:.1301421812500001,durationTicks:151,midi:58,name:"A#3",ticks:4639,time:3.9982091312499994,velocity:.7874015748031497},{duration:.39301214999999967,durationTicks:456,midi:65,name:"F4",ticks:4800,time:4.13697,velocity:.7874015748031497},{duration:.1310040499999996,durationTicks:152,midi:62,name:"D4",ticks:5280,time:4.550667,velocity:.7874015748031497},{duration:.1310040499999996,durationTicks:152,midi:62,name:"D4",ticks:5439,time:4.68770413125,velocity:.7874015748031497},{duration:.1301421812500001,durationTicks:151,midi:62,name:"D4",ticks:5599,time:4.825603131249999,velocity:.7874015748031497},{duration:.39301214999999967,durationTicks:456,midi:60,name:"C4",ticks:5760,time:4.964364,velocity:.7874015748031497}]}]};

},{}],4:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var keyCodes={"1m":{keyName:"A Minor",toneCode:"A4"},"2m":{keyName:"E Minor",toneCode:"E4"},"3m":{keyName:"B Minor",toneCode:"B4"},"4m":{keyName:"F♯ Minor",toneCode:"F#4"},"5m":{keyName:"C♯ Minor",toneCode:"C#4"},"6m":{keyName:"G♯ Minor",toneCode:"G#4"},"7m":{keyName:"D♯ Minor",toneCode:"D#4"},"8m":{keyName:"A♯ Minor",toneCode:"A#4"},"9m":{keyName:"F Minor",toneCode:"F4"},"10m":{keyName:"C Minor",toneCode:"C4"},"11m":{keyName:"G Minor",toneCode:"G4"},"12m":{keyName:"D Minor",toneCode:"D4"},"1d":{keyName:"A Major",toneCode:"A4"},"2d":{keyName:"E Major",toneCode:"E4"},"3d":{keyName:"B Major",toneCode:"B4"},"4d":{keyName:"F♯ Major",toneCode:"F#4"},"5d":{keyName:"C♯ Major",toneCode:"C#4"},"6d":{keyName:"G♯ Major",toneCode:"G#4"},"7d":{keyName:"D♯ Major",toneCode:"D#4"},"8d":{keyName:"A♯ Major",toneCode:"A#4"},"9d":{keyName:"F Major",toneCode:"F4"},"10d":{keyName:"C Major",toneCode:"C4"},"11d":{keyName:"G Major",toneCode:"G4"},"12d":{keyName:"D Major",toneCode:"D4"}},_default=exports.default=keyCodes;

},{}],5:[function(require,module,exports){
"use strict";function harmonicShift(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"perfectFifth"},r=["1m","2m","3m","4m","5m","6m","7m","8m","9m","10m","11m","12m","1d","2d","3d","4d","5d","6d","7d","8d","9d","10d","11d","12d"],n=r.indexOf(e);if(-1===n){var d=Object.keys(this.keyCodes).find(function(o){return t.keyCodes[o].toneCode===e});d&&(n=r.indexOf(d))}if(-1!==n){switch(o.type){case"perfectFifth":n+=e.endsWith("m")?-7:7;break;case"majorMinorSwap":n+=e.endsWith("m")?12:-12;break;case"shift":if("number"!=typeof o.amount||Math.abs(o.amount)>3)throw new Error("Invalid shift amount");n+=o.amount;break;default:throw new Error("Invalid transition type")}return r[n=(n+24)%24]}console.log("WARNING: Could not find Traktor Key Code",e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=harmonicShift;

},{}],6:[function(require,module,exports){
"use strict";function playIntroJingle(e){var t=this,n=this,o=[],a=Tone.now()+.5;e.tracks.forEach(function(e){t.synth=new Tone.PolySynth(Tone.Synth,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination(),o.push(n.synth),e.notes.forEach(function(e){n.playNote(e.name,e.duration,e.time+a,e.velocity)})})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=playIntroJingle;

},{}],7:[function(require,module,exports){
"use strict";function playSpatialSound(t,e){this.toneStarted||(Tone.start(),this.toneStarted=!0);var o=this.game.width,n=(t.position.x-e.position.x)/o,a=new Tone.Panner(n).toDestination(),i=Math.sqrt(Math.pow(t.velocity.x,2)+Math.pow(t.velocity.y,2))/10,s=new Tone.FMSynth({harmonicity:8,modulationIndex:2,oscillator:{type:"sine"},envelope:{attack:.01,decay:.2,sustain:0,release:.1},modulation:{type:"square"},modulationEnvelope:{attack:.01,decay:.2,sustain:0,release:.1}}).connect(a),r=.2+.3*(1-i),l=24*i;s.triggerAttack("C4",Tone.now()),setTimeout(function(){s.setNote("C".concat(4-l),Tone.now()),s.triggerRelease(Tone.now()+r)},10)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=playSpatialSound;

},{}]},{},[1])(1)
});

(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}(g.PLUGINS || (g.PLUGINS = {})).Entity = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Component=function(){function e(t,r){_classCallCheck(this,e),this.name=t,this.data={},this.game=r}return _createClass(e,[{key:"set",value:function(e,t){var r=Array.isArray(e)?e[0]:e;if(this.game){var i=this.game.components.lockedProperties.get(r);if(this.isLocked(i,this.name))return}if(Array.isArray(e)){for(var n=this.data,o=0;o<e.length-1;o++)n[e[o]]||(n[e[o]]={}),n=n[e[o]];n[e[e.length-1]]=t}else this.data[e]=t;this.game&&this.game.entities&&this.game.entities.has(r)&&(this.game.entities.get(r)[this.name]=this.get(r))}},{key:"get",value:function(e){if(Array.isArray(e)){for(var t=this.data,r=0;r<e.length;r++){if(void 0===t[e[r]])return null;t=t[e[r]]}return t}return void 0===this.data[e]||null===this.data[e]?null:this.data[e]}},{key:"remove",value:function(e){if(Array.isArray(e)){for(var t=this.data,r=0;r<e.length-1;r++){if(void 0===t[e[r]])return;t=t[e[r]]}delete t[e[e.length-1]]}else delete this.data[e]}},{key:"isLocked",value:function(e,t){if(!e)return!1;if(Array.isArray(t)){for(var r=e,i=0;i<t.length;i++){if(void 0===r[t[i]])return!1;r=r[t[i]]}return!0}return void 0!==e[t]}}]),e}(),_default=exports.default=Component;

},{}],2:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Component2=_interopRequireDefault(require("./Component.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,o=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var TimersComponent=function(e){_inherits(r,_Component2["default"]);var t=_createSuper(r);function r(e,o){var n;return _classCallCheck(this,r),(n=t.call(this,e,o)).timers={},n}return _createClass(r,[{key:"setTimer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.timers[e]={startTime:Date.now(),duration:1e3*t,isInterval:r,completed:!1}}},{key:"getTimer",value:function(e){return this.timers[e]}},{key:"checkTimer",value:function(e){if(!this.timers[e])return!1;var t=this.timers[e],r=Date.now();return!t.completed&&r>=t.startTime+t.duration&&(t.isInterval?(this.resetTimer(e),"intervalCompleted"):(t.completed=!0,!0))}},{key:"resetTimer",value:function(e){this.timers[e]&&(this.timers[e].startTime=Date.now(),this.timers[e].completed=!1)}},{key:"removeTimer",value:function(e){delete this.timers[e]}}]),r}(),_default=exports.default=TimersComponent;

},{"./Component.js":1}],3:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_toPropertyKey(o.key),o)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Entity=function(){function t(e){_classCallCheck(this,t),this.id=e,this.components={}}return _createClass(t,[{key:"getTimer",value:function(t){return this.timers[t]}}]),t}(),_default=exports.default=Entity;

},{}],4:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _createEntity=_interopRequireDefault(require("./lib/createEntity.js")),_getEntity=_interopRequireDefault(require("./lib/getEntity.js")),_inflateEntity=_interopRequireDefault(require("./lib/inflateEntity.js")),_removeEntity=_interopRequireDefault(require("./lib/removeEntity.js")),_updateEntity=_interopRequireDefault(require("./lib/updateEntity.js")),_layoutEntity=_interopRequireDefault(require("./lib/layoutEntity.js")),_removeAllEntities=_interopRequireDefault(require("./lib/removeAllEntities.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,n,o,a,l=[],s=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(i=o.call(r)).done)&&(l.push(i.value),l.length!==t);s=!0);}catch(e){u=!0,n=e}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw n}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var Entity=function(){function e(){_classCallCheck(this,e),this.id=e.id,this.nextEntityId=1}return _createClass(e,[{key:"init",value:function(e){this.game=e,e.entities=new Map,this.game.systemsManager.addSystem(this.id,this),this.game.createEntity=_createEntity.default.bind(this),this.game.getEntity=_getEntity.default.bind(this),this.game.removeEntity=_removeEntity.default.bind(this),this.game.getEntityByName=this.getEntityByName.bind(this),this.game.getEntities=this.allEntities.bind(this),this.game.updateEntity=_updateEntity.default.bind(this),this.game.inflateEntity=_inflateEntity.default.bind(this),this.game.hasEntity=this.hasEntity.bind(this),this.game.findEntity=this.findEntity.bind(this),this.game.removeAllEntities=_removeAllEntities.default.bind(this),this.removeAllEntities=_removeAllEntities.default.bind(this),this.layoutEntity=_layoutEntity.default.bind(this)}},{key:"hasEntity",value:function(e){return this.game.entities.has(e)}},{key:"findEntity",value:function(e){"string"==typeof e&&(e={name:e});var t,r=_createForOfIteratorHelper(this.game.entities);try{for(r.s();!(t=r.n()).done;){var i=_slicedToArray(t.value,2),n=(i[0],i[1]),o=!0;for(var a in e)if(n[a]!==e[a]){o=!1;break}if(o)return n}}catch(e){r.e(e)}finally{r.f()}}},{key:"getEntityByName",value:function(e){var t,r=_createForOfIteratorHelper(this.game.entities);try{for(r.s();!(t=r.n()).done;){var i=_slicedToArray(t.value,2),n=(i[0],i[1]);if(n.name===e)return n}}catch(e){r.e(e)}finally{r.f()}}},{key:"_generateId",value:function(){return this.nextEntityId++}},{key:"cleanupDestroyedEntities",value:function(){var e=this;this.game.lifecycle.triggerHook("before.cleanupRemovedEntities");var t=this.game.components.destroyed.data,r=function(r){"string"==typeof r&&(r=parseInt(r));var i=e.game.components.type.get(r);if(t[r]){for(var n in"function"==typeof e.game.physics.removeBody&&e.game.physics.removeBody(r),e.game.components)e.game.components[n].remove(r);e.game.entities.delete(r),delete e.game.data.ents._[r],e.game.data.ents[i]&&(e.game.data.ents[i]=e.game.data.ents[i].filter(function(e){return Number(e.id)!==Number(r)}))}};for(var i in t)r(i);this.game.lifecycle.triggerHook("after.cleanupRemovedEntities")}},{key:"allEntities",value:function(){return this.game.entities}},{key:"applyLockedProperties",value:function(e,t){if(t)for(var r in console.log("Processing lockedProperties properties"),t){var i=this.game.components[r].get(e);if(console.log("currentVal",i,"key",r,t),null!=i){if("object"!==_typeof(t[r])||Array.isArray(t[r]))!0===t[r]&&(console.log("Setting lockedProperties property",r,"to",i),this.game.components.lockedProperties.set(e,_defineProperty({},r,i)));else for(var n in console.log("lockedProperties[key]",t[r]),t[r])if(console.log("subKey",n,t[r][n]),!0===t[r][n]){var o=i[n];null!=o?(console.log("Setting lockedProperties property","".concat(r,".").concat(n),"to",o),this.game.components.lockedProperties.set(e,_defineProperty({},r,_defineProperty({},n,o)))):console.log("Error: No such component or invalid value for","".concat(r,".").concat(n))}}else console.log("Error: No such component or invalid value for",r)}}}]),e}();_defineProperty(Entity,"id","entity"),_defineProperty(Entity,"removable",!1);var _default=exports.default=Entity;

},{"./lib/createEntity.js":5,"./lib/getEntity.js":6,"./lib/inflateEntity.js":7,"./lib/layoutEntity.js":8,"./lib/removeAllEntities.js":9,"./lib/removeEntity.js":10,"./lib/updateEntity.js":11}],5:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=createEntity;var _Entity=_interopRequireDefault(require("../../../Entity/Entity.js")),_TimersComponent=_interopRequireDefault(require("../../../Component/TimersComponent.js")),_ensureColorInt=_interopRequireDefault(require("./util/ensureColorInt.js")),_layoutEntity=_interopRequireDefault(require("./layoutEntity.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function ownKeys(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach(function(e){_defineProperty(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function distanceSquared(t,e,i,n){var o=i-t,a=n-e;return o*o+a*a}function deferEntityCreation(t){spatialStructure.add(t)}function createEntity(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e=this.game.lifecycle.triggerHook("before.createEntity",e),!i){var n={id:t=this._generateId(),name:null,kind:null,body:!0,shape:"triangle",color:null,position:{x:0,y:0,z:0},startingPosition:null,velocity:{x:0,y:0,z:0},rotation:0,mass:100,density:100,health:1/0,score:0,height:100,width:100,depth:16,size:{width:100,height:100,depth:16},lifetime:null,maxSpeed:9999,isStatic:!1,isSensor:!1,restitution:0,container:null,items:null,sutra:null,scene:[],meta:null,collectable:!1,hasInventory:!0,owner:0,inputs:null,value:null,destroyed:!1,type:"NONE",friction:.1,frictionAir:.01,frictionStatic:.5,lockedProperties:null,actionRateLimiter:null,timers:null,yCraft:null,text:null,style:null,texture:null,collisionStart:!0,collisionActive:!1,collisionEnd:!1,pointerdown:!1,pointerup:!1,pointermove:!1,pointerover:!1,pointerout:!1,pointerenter:!1,pointerleave:!1,onDrop:null,afterItemCollected:null,afterRemoveEntity:null,afterCreateEntity:null,afterUpdate:null,update:null,exit:null,ctick:this.game.tick};if("object"===_typeof(e.size)?(e.width=e.size.width,e.height=e.size.height,e.depth=e.size.depth):e.size={width:e.width,height:e.height,depth:e.depth},(e=_objectSpread(_objectSpread({},n),e)).position&&("number"!=typeof e.position.x||isNaN(e.position.x)||"number"!=typeof e.position.y||isNaN(e.position.y)))throw console.log("Entity.createEntity could not create with data",e),new Error("Invalid position for entity");if(this.game.systems.rbush&&this.game.systems.rbush.addEntity(e),this.game.deferredEntities[e.id.toString()]=e,this.game.config.useFoV){var o=this.game.getCurrentPlayer();if(o){var a=e.position||{x:0,y:0,z:0};if(distanceSquared(o.position.x,o.position.y,a.x,a.y)>this.game.data.fieldOfView*this.game.data.fieldOfView)return}}}t=e.id;new _Entity.default(t);e.startingPosition||(e.startingPosition=e.position);var r,s=e,d=s.name,m=s.type,p=s.kind,l=s.position,h=s.rotation,u=s.startingPosition,c=s.body,g=s.mass,y=s.density,f=s.velocity,C=s.isSensor,v=s.isStatic,b=s.lockedProperties,E=s.width,_=s.height,w=s.depth,S=s.size,P=s.radius,j=s.shape,x=s.color,O=s.maxSpeed,R=s.health,k=s.score,D=s.items,I=s.container,q=s.sutra,z=s.scene,A=s.meta,N=s.collectable,T=s.hasInventory,K=s.owner,V=s.inputs,L=s.value,U=s.lifetime,H=s.yCraft,M=s.text,F=s.style,W=s.texture,Y=s.collisionActive,B=s.collisionStart,G=s.collisionEnd,J=s.pointerdown,Q=s.pointerup,X=s.pointermove,Z=s.pointerenter,$=s.pointerleave,tt=s.pointerover,et=s.pointerout,it=s.onDrop,nt=s.afterRemoveEntity,ot=(s.afterCreateEntity,s.afterUpdateEntity),at=s.afterItemCollected,rt=s.update,st=s.exit,dt=s.ctick,mt=(l.x,l.y,(0,_ensureColorInt.default)(x));if(this.game.addComponent(t,"type",m||"PLAYER"),this.game.addComponent(t,"name",d||null),this.game.addComponent(t,"kind",p),this.game.addComponent(t,"position",l),this.game.addComponent(t,"startingPosition",u),this.game.addComponent(t,"velocity",f),this.game.addComponent(t,"rotation",h),this.game.addComponent(t,"mass",g),this.game.addComponent(t,"density",y),this.game.addComponent(t,"health",R),this.game.addComponent(t,"score",k),this.game.addComponent(t,"width",E),this.game.addComponent(t,"height",_),this.game.addComponent(t,"depth",w),this.game.addComponent(t,"size",S),this.game.addComponent(t,"radius",P),this.game.addComponent(t,"shape",j),this.game.addComponent(t,"color",mt),this.game.addComponent(t,"maxSpeed",O),this.game.addComponent(t,"owner",K),this.game.addComponent(t,"items",D),this.game.addComponent(t,"scene",z),this.game.addComponent(t,"meta",A),this.game.addComponent(t,"collectable",N),this.game.addComponent(t,"hasInventory",T),this.game.addComponent(t,"value",L),this.game.addComponent(t,"inputs",V),this.game.addComponent(t,"lifetime",U),this.game.addComponent(t,"destroyed",!1),this.game.addComponent(t,"creationTime",Date.now()),this.game.addComponent(t,"isSensor",C),this.game.addComponent(t,"isStatic",v),this.game.addComponent(t,"lockedProperties",b),this.game.addComponent(t,"actionRateLimiter",{}),this.game.addComponent(t,"timers",new _TimersComponent.default("timers",t,this.game)),this.game.addComponent(t,"yCraft",H),this.game.addComponent(t,"text",M),this.game.addComponent(t,"style",F),this.game.addComponent(t,"texture",W),this.game.addComponent(t,"afterItemCollected",at),this.game.addComponent(t,"afterRemoveEntity",nt),this.game.addComponent(t,"afterCreateEntity",nt),this.game.addComponent(t,"afterUpdateEntity",ot),this.game.addComponent(t,"collisionActive",Y),this.game.addComponent(t,"collisionStart",B),this.game.addComponent(t,"collisionEnd",G),this.game.addComponent(t,"pointerdown",J),this.game.addComponent(t,"pointerup",Q),this.game.addComponent(t,"pointermove",X),this.game.addComponent(t,"pointerenter",Z),this.game.addComponent(t,"pointerleave",$),this.game.addComponent(t,"pointerover",tt),this.game.addComponent(t,"pointerout",et),this.game.addComponent(t,"onDrop",it),this.game.addComponent(t,"update",rt),this.game.addComponent(t,"exit",st),this.game.addComponent(t,"ctick",dt),"object"===_typeof(q)&&null!==q&&"function"==typeof q.rules?("object"!==_typeof(q.config)&&(q.config={}),r=q.rules(this.game,t,q.config)):r=q,this.game.addComponent(t,"sutra",r),c){var pt={entityId:t,width:E,height:_,radius:P,type:m,shape:j,position:l,velocity:f,rotation:h,mass:g,density:y,isStatic:v,isSensor:C,restitution:e.restitution,friction:e.friction,frictionAir:e.frictionAir,frictionStatic:e.frictionStatic};pt.myEntityId=t,this.game.physics.addToWorld(pt),!f||0===f.x&&0===f.y||this.game.physics.setVelocity(t,f),l&&this.game.physics.setPosition(t,l),void 0!==h&&this.game.physics&&this.game.physics.setRotation&&this.game.physics.setRotation(t,h)}this.game.entities.set(t,{id:t});var lt,ht=this.game.getEntity(t);return void 0===ht.pendingRender&&(ht.pendingRender={}),this.game.graphics.forEach(function(t){ht.pendingRender[t.id]=!0}),this.game.entities.set(t,ht),I&&this.layoutEntity(I,t),this.game.data.ents=this.game.data.ents||{},this.game.data.ents._=this.game.data.ents._||{},this.game.data.ents._[t]=ht,this.game.data.ents[ht.type]=this.game.data.ents[ht.type]||[],this.game.data.ents[ht.type].push(ht),"function"==typeof e.afterCreateEntity&&(lt=e.afterCreateEntity),lt&&lt(e),ht=this.game.lifecycle.triggerHook("after.createEntity",e)}

},{"../../../Component/TimersComponent.js":2,"../../../Entity/Entity.js":3,"./layoutEntity.js":8,"./util/ensureColorInt.js":12}],6:[function(require,module,exports){
"use strict";function getEntity(t){if("string"==typeof t&&(t=parseInt(t)),!this.game.entities.has(t))return null;var e={};for(var n in this.game.components){var r=this.game.getComponent(t,n);null!=r&&(e[n]=r)}return 0===Object.keys(e).length?null:(e.id=t,e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=getEntity;

},{}],7:[function(require,module,exports){
"use strict";function inflateEntity(e){var t=this.game;if(!0===e.destroyed)return t.removeGraphic(e.id),void t.removeEntity(e.id);if(this.game.removedEntities.has(e.id))console.log("Skipping update for locally removed entity:",e.id);else if(t.entities.get(e.id))t.updateEntity(e);else{if(void 0===e.height||void 0===e.width)return;t.createEntity(e)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=inflateEntity;

},{}],8:[function(require,module,exports){
"use strict";function layoutEntity(t,i){var o=this,e=this.game.findEntity(t);if(!e)throw new Error("Container not found: "+t);var n=e.position||{x:0,y:0,z:0},r="none",a="center";if(e.style&&e.style.layout&&(r=e.style.layout),e.style&&e.style.origin&&(a=e.style.origin),e.meta&&e.meta.layout&&(r=e.meta.layout),console.log("containerEntcontainerEntcontainerEntcontainerEnt",e),e.items||(e.items=[]),e.items.push(i),"none"===r){var s=this.game.getEntity(i);if(!s)return void console.error("Entity not found: "+i);var y=0,l=0;"top-left"===a&&(y=-e.size.width/2,l=-e.size.height/2);var c={x:n.x+y+s.position.x-e.size.width/2,y:n.y+l+s.position.y-e.size.height/2,z:n.z};this.game.updateEntity({id:i,position:c})}if("grid"===r){var u=e.meta.grid.columns||1,d=e.meta.grid.rows||1;if(e.style&&e.style.grid&&(u=e.style.grid.columns||u,d=e.style.grid.rows||d),"number"!=typeof u||"number"!=typeof d)throw console.log("containerEnt.layout",e.layout),new Error("Grid layout requires cols and rows to be numbers");var g=e.items||[];g=g.map(function(t){return o.game.getEntity(t)});var m=e.size,h=m.width/u,f=m.height/d;g.forEach(function(t,i){var e=Math.floor(i/u),r=i%u;if(t){var a=n.x-m.width/2+0,s=n.y-m.height/2+0,y=(n.z,{x:a+r*h+h/2,y:s+e*f+f/2,z:t.position.z});o.game.updateEntity({id:t.id,position:y},{skipAfterUpdateEntity:!0})}else console.log("warning: item not found in container",i,t)})}if("stack"===r){var p,E=this.game.getEntity(i);if(!E)return void console.error("Entity not found: "+i);p=E.size.height+5;var v=e.items.length-1,w={x:n.x+0*v,y:n.y+v*p,z:n.z};this.game.updateEntity({id:i,position:w}),console.log("Entity ".concat(i," stacked at index ").concat(v," with position (").concat(w.x,", ").concat(w.y,", ").concat(w.z,") relative to container"))}if("function"==typeof r)throw console.log("adding item to container using custom layout algorithm"),new Error("Custom layout algorithm functions are yet implemented!")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=layoutEntity;

},{}],9:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function removeAllEntities(t){var e=!1,o=[];if("boolean"==typeof t&&(e=t),"object"===_typeof(t)&&Array.isArray(t.excludeByName)&&(o=t.excludeByName),this.game.data.ents){for(var r in this.game.data.ents._){var a=this.game.data.ents._[r];(a.id!==this.game.currentPlayerId||e)&&(o.includes(a.name)||(a&&a.yCraft&&a.yCraft.part&&a.yCraft.part.unload&&a.yCraft.part.unload(),this.game.removeEntity(a.id)))}e&&(this.game.currentPlayerId=null)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=removeAllEntities;

},{}],10:[function(require,module,exports){
"use strict";function removeEntity(e){var t,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this.game.entities.get(e);if(s&&("function"==typeof s.afterRemoveEntity&&(t=s.afterRemoveEntity),!1!==this.game.lifecycle.triggerHook("before.removeEntity",s))){if(s&&this.game.systems.graphics&&s.graphics&&this.game.systems.graphics.removeGraphic(e),s){if(this.game.components.destroyed.set(e,!0),this.game.components.timers.get(e)){var r=this.game.components.timers.get(e);for(var m in r.timers)r.removeTimer(m)}var o=this.game.getEntity(e);this.game.entities.set(e,o),o&&this.game.systems.rbush&&i&&(this.game.systems.rbush.removeEntity(o),delete this.game.deferredEntities[e])}t&&t(s),this.game.lifecycle.triggerHook("after.removeEntity",s)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=removeEntity;

},{}],11:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=updateEntity;var _ensureColorInt=_interopRequireDefault(require("./util/ensureColorInt.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,i)}return o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(t,e,o){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,e||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function updateEntity(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e="string"==typeof t||"number"==typeof t?_objectSpread({id:t},e):t,null==(e=this.game.lifecycle.triggerHook("before.updateEntity",e)))return console.warn("updateEntity was not provided a valid entityData",e),void console.warn("This is most likely the result of passing invalid data to updateEntity()");var i=e.id;if(void 0===i&&e.name){var n=this.game.getEntityByName(e.name);n&&(i=n.id)}if(void 0===i)return console.log("Error: updateEntity was not provided a valid entity.id or entity.name",e),void console.log("This is most likely the result of passing invalid data to updateEntity()");var s=this.game.getEntity(i);if(!s)return console.log("Error: updateEntity called for non-existent entity",i,e),void console.log("This should not happen, if a new state came in it should be created");if(!e.destroyed){if(s.pendingRender={},this.game.graphics.forEach(function(t){s.pendingRender[t.id]=!0}),e.color){var r=(0,_ensureColorInt.default)(e.color);this.game.components.color.set(i,r)}var a=!1;if(e.height&&(a=!0,this.game.components.height.set(i,e.height)),e.width&&(a=!0,this.game.components.width.set(i,e.width)),e.radius&&(a=!0),e.size&&(a=!0,this.game.components.size.set(i,e.size)),a&&this.game.physics.setBodySize(i,e),e.position&&(this.game.components.position.set(i,e.position),this.game.physics.setPosition(i,e.position)),e.velocity&&this.game.physics.setVelocity(i,e.velocity),e.health&&this.game.components.health.set(i,e.health),void 0!==e.thickness&&null!==e.thickness&&this.game.components.width.set(i,e.thickness),void 0!==e.update){var p=this.game.components.update.get(i);if(this.game.data.ents._[i])if(null===e.update)this.game.components.update.set(i,null);else{var c=this.game.make();c.onUpdate(e.update),p&&p.handlers&&p.handlers.length&&p.handlers.forEach(function(t){c.onUpdate(t)}),s.update=c.config.update,this.game.components.update.set(i,c.config.update)}}if(void 0!==e.value&&this.game.components.value.set(i,e.value),void 0!==e.meta){var u={},l=this.game.components.meta.get(i);u=l?_objectSpread(_objectSpread({},l),e.meta):e.meta,this.game.components.meta.set(i,u)}if(void 0!==e.score&&null!==e.score&&this.game.components.score.set(i,e.score),void 0!==e.rotation&&(this.game.physics&&this.game.physics.setRotation?this.game.physics.setRotation(i,e.rotation):console.log("WARNING: physics.setRotation is not defined")),void 0!==e.text&&this.game.components.text.set(i,e.text),void 0!==e.items&&this.game.components.items.set(i,e.items),void 0!==e.sutra&&this.game.components.sutra.set(i,e.sutra),void 0!==e.items&&this.game.components.items.set(i,e.items),void 0!==e.style&&this.game.components.style.set(i,e.style),void 0!==e.texture){var m,d=this.game.components.texture.get(i);m="string"==typeof e.texture?e.texture:_objectSpread(_objectSpread({},d),e.texture),this.game.components.texture.set(i,m)}this.game.systems.rbush;var y,h=this.game.getEntity(i);if(!0!==o.skipAfterUpdateEntity)"function"==typeof h.afterUpdateEntity&&(y=h.afterUpdateEntity),y&&y(h);return h=this.game.lifecycle.triggerHook("after.updateEntity",h)}this.removeEntity(i)}

},{"./util/ensureColorInt.js":12}],12:[function(require,module,exports){
"use strict";function ensureColorInt(e){if(!e)return e;var r={red:"#FF0000",green:"#00FF00",blue:"#fff007",black:"#000000",white:"#FFFFFF",yellow:"#FFFF00",purple:"#800080",orange:"#FFA500",pink:"#FFC0CB"};return"number"==typeof e?e:"string"==typeof e&&e.startsWith("#")?parseInt(e.replace("#",""),16):"string"==typeof e&&r[e.toLowerCase()]?parseInt(r[e.toLowerCase()].replace("#",""),16):(console.error("Unrecognized color format:",e),parseInt("000000",16))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ensureColorInt;

},{}]},{},[4])(4)
});

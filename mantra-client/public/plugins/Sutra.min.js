(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}(g.PLUGINS || (g.PLUGINS = {})).Sutra = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=defaultMouseMovement;var moving=!1,movingToPosition={};function defaultMouseMovement(o){o.on("pointerUp",function(t,n){var e=o.config.mouseMovementButton||"RIGHT";void 0!==o.currentPlayerId&&o.currentPlayerId&&(o.isTouchDevice()?t.endedFirstTouch&&(moving=!1,o.updateEntity(o.currentPlayerId,{update:null})):!1===t.buttons[e]&&(moving=!1,o.updateEntity(o.currentPlayerId,{update:null})))}),o.on("pointerMove",function(t,n){if(o.data&&o.data.ents&&o.data.ents.PLAYER){var e=t.position,i=o.data.ents.PLAYER[0];if(void 0!==i){var a=i.position;if(a&&moving){var s=Math.atan2(e.y-a.y,e.x-a.x);movingToPosition={x:e.x,y:e.y,rotation:s}}}}}),o.on("pointerDown",function(t,n){if(o.data&&o.data.ents&&o.data.ents.PLAYER){var e=o.config.mouseMovementButton||"RIGHT",i=o.config.mouseActionButton||"LEFT",a=t.position,s=o.data.ents.PLAYER[0];if(void 0!==s){var u=s.position;if(u){"function"!=typeof s.update&&o.updateEntity(s.id,{update:function(t){if(moving&&movingToPosition.x&&movingToPosition.y){var n=movingToPosition.rotation,e={x:1.5*Math.cos(n),y:1.5*Math.sin(n)};o.applyForce(o.data.ents.PLAYER[0].id,e)}}});var d=Math.atan2(a.y-u.y,a.x-u.x);o.isTouchDevice()?n.pointerId===t.firstTouchId?(moving=!0,movingToPosition={x:a.x,y:a.y,rotation:d}):n.pointerId===t.secondTouchId&&useItem(o,s,d):(t.buttons[e]&&(moving=!0,movingToPosition={x:a.x,y:a.y,rotation:d}),t.buttons[i]&&useItem(o,s,d))}}}})}function useItem(o,t,n){if(t.meta&&t.meta.equippedItems&&t.meta.equippedItems.length){var e=t.meta.equippedItems[0],i=o.systems[e.plugin][e.method];"function"==typeof i?i(t.id,n):console.error("Method not found",e.method)}else o.systems.boomerang&&o.systems.boomerang.throwBoomerang(t.id,n)}

},{}],2:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=platformMovement;var _defaultMouseMovement=_interopRequireDefault(require("./defaultMouseMovement.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function platformMovement(t){var e=t.createSutra();e.addCondition("PLAYER_UP",{op:"or",conditions:["W","DPAD_UP"]}),e.addCondition("PLAYER_DOWN",{op:"or",conditions:["S","DPAD_DOWN"]}),e.addCondition("MOVE_LEFT",{op:"or",conditions:["A","DPAD_LEFT"]}),e.addCondition("MOVE_RIGHT",{op:"or",conditions:["D","DPAD_RIGHT"]}),e.addCondition("PLAYER_JUMP",{op:"or",conditions:["SPACE","H","BUTTON_B"]}),e.addCondition("PLAYER_RUN",{op:"or",conditions:["J","BUTTON_X"]}),e.addCondition("ZOOM_IN",{op:"or",conditions:["K","BUTTON_A"]}),e.addCondition("ZOOM_OUT",{op:"or",conditions:["L","BUTTON_Y"]}),e.addCondition("isRunning",{op:"or",conditions:["S","K"]}),e.if("MOVE_LEFT").then("MOVE_LEFT").then("updateSprite",{sprite:"playerLeftWalk"}),e.if("MOVE_RIGHT").then("MOVE_RIGHT").then("updateSprite",{sprite:"playerRightWalk"}),e.if("PLAYER_DOWN").then("DUCK").map("determineDuckingSprite").then("updateSprite"),e.addMap("determineDuckingSprite",function(t,e){return"playerLeftWalk"===t.texture.sprite?t.texture.sprite="playerDownLeft":t.texture.sprite="playerDownRight",t}),e.on("updateSprite",function(e,i){var n=i.data.sprite||e.texture.sprite;t.updateEntity({id:e.id,texture:{frameIndex:0,sheet:e.texture.sheet,sprite:n,animationPlaying:!0}})}),e.addCondition("isPlayer",function(t){return"PLAYER"===t.type});var i=40;e.if("isPlayer").then(function(t){t.if("PLAYER_RUN").then("RUN").else("WALK")}),e.if("isPlayer").then(function(t){t.if("PLAYER_JUMP").then("JUMP").then("updateSprite",{sprite:"playerRightJump"})}),e.on("JUMP",function(e,n,o){o.inputTicks.SPACE>=i||(t.applyForce(e.id,{x:0,y:-2.3,z:0}),t.updateEntity({id:e.id,rotation:0,sprite:"playerRightJump"}))});var n=1;return e.on("RUN",function(t){n=1.6,i=35}),e.on("WALK",function(t){n=1,i=25}),e.on("DUCK",function(e){t.applyForce(e.id,{x:0,y:.5,z:0}),t.updateEntity({id:e.id,rotation:Math.PI})}),e.on("MOVE_LEFT",function(e,i,o){t.applyForce(e.id,{x:-n,y:0,z:0}),t.updateEntity({id:e.id,rotation:-Math.PI/2})}),e.on("MOVE_RIGHT",function(e){t.applyForce(e.id,{x:n,y:0,z:0}),t.updateEntity({id:e.id,rotation:Math.PI/2})}),e.on("FIRE_BULLET",function(e){t.systems.bullet.fireBullet(e.id)}),e.on("SWING_SWORD",function(e){t.systems.sword&&t.systems.sword.swingSword(e.id)}),(0,_defaultMouseMovement.default)(t),e}

},{"./defaultMouseMovement.js":1}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=topdownMovement;var _defaultMouseMovement=_interopRequireDefault(require("./defaultMouseMovement.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperty(t,e,o){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function topdownMovement(t){var e=t.createSutra();function o(t){return(t.MOVE_UP||t.MOVE_DOWN)&&(t.MOVE_LEFT||t.MOVE_RIGHT)}e.addCondition("PLAYER_UP",{op:"or",conditions:["W","DPAD_UP"]}),e.addCondition("PLAYER_DOWN",{op:"or",conditions:["S","DPAD_DOWN"]}),e.addCondition("PLAYER_LEFT",{op:"or",conditions:["A","DPAD_LEFT"]}),e.addCondition("PLAYER_RIGHT",{op:"or",conditions:["D","DPAD_RIGHT"]}),e.addCondition("USE_ITEM_1",{op:"or",conditions:["SPACE","H","BUTTON_B"]}),e.addCondition("USE_ITEM_2",{op:"or",conditions:["J","BUTTON_X"]}),e.addCondition("USE_ITEM_3",{op:"or",conditions:["K","BUTTON_A"]}),e.addCondition("USE_ITEM_4",{op:"or",conditions:["L","BUTTON_Y"]}),e.addCondition("ZOOM_IN",{op:"or",conditions:["K","BUTTON_A"]}),e.addCondition("ZOOM_OUT",{op:"or",conditions:["L","BUTTON_Y"]}),e.if("PLAYER_UP").then("MOVE_UP").then("updateSprite",{sprite:"playerUp"}),e.if("PLAYER_LEFT").then("MOVE_LEFT").then("updateSprite",{sprite:"playerLeft"}),e.if("PLAYER_DOWN").then("MOVE_DOWN").then("updateSprite",{sprite:"playerDown"}),e.if("PLAYER_RIGHT").then("MOVE_RIGHT").then("updateSprite",{sprite:"playerRight"}),e.if("USE_ITEM_1").then("FIRE_BULLET").map("determineShootingSprite").then("updateSprite"),e.if("USE_ITEM_2").then("THROW_BOOMERANG"),e.if("ZOOM_IN").then("ZOOM_IN"),e.if("ZOOM_OUT").then("ZOOM_OUT"),e.addMap("determineShootingSprite",function(t,e){var o;if(void 0===t.texture)return t;var n=t.rotation%(2*Math.PI),i=(_defineProperty(o={0:"playerRodUp"},Math.PI/2,"playerRodRight"),_defineProperty(o,Math.PI,"playerRodDown"),_defineProperty(o,-Math.PI/2,"playerRodLeft"),o);return t.texture.sprite=i[n]||t.currentSprite,t}),e.on("updateSprite",function(e,o){if(void 0!==e.texture){var n=o.data.sprite||e.texture.sprite;t.updateEntity({id:e.id,texture:{frameIndex:0,sheet:e.texture.sheet,sprite:n,animationPlaying:!0}})}});return e.on("MOVE_UP",function(n,i){i.state=i.state||{},i.state.MOVE_UP=!0;var r={x:0,y:-2,z:0};o(e.state)&&(r.y*=.7071),t.applyForce(n.id,r),t.updateEntity({id:n.id,rotation:0})}),e.on("MOVE_DOWN",function(n,i){i.state=i.state||{},i.state.MOVE_DOWN=!0;var r={x:0,y:2,z:0};o(e.state)&&(r.y*=.7071),t.applyForce(n.id,r),t.updateEntity({id:n.id,rotation:Math.PI})}),e.on("MOVE_LEFT",function(n,i){i.state=i.state||{},i.state.MOVE_LEFT=!0;var r={x:-2,y:0,z:0};o(e.state)&&(r.x*=.7071),t.applyForce(n.id,r),t.updateEntity({id:n.id,rotation:-Math.PI/2})}),e.on("MOVE_RIGHT",function(n,i){i.state=i.state||{},i.state.MOVE_RIGHT=!0;var r={x:2,y:0,z:0};o(e.state)&&(r.x*=.7071),t.applyForce(n.id,r),t.updateEntity({id:n.id,rotation:Math.PI/2})}),e.on("FIRE_BULLET",function(e){t.systems.bullet&&t.systems.bullet.fireBullet(e.id)}),e.on("SWING_SWORD",function(e){t.systems.sword&&t.systems.sword.swingSword(e.id)}),e.on("THROW_BOOMERANG",function(e){t.systems.boomerang&&t.systems.boomerang.throwBoomerang(e.id)}),e.on("CAMERA_SHAKE",function(e){t.shakeCamera(1e3)}),e.on("ZOOM_IN",function(e){var o=t.data.camera.currentZoom||1;t.setZoom(o+.05)}),e.on("ZOOM_OUT",function(e){var o=t.data.camera.currentZoom||1;t.setZoom(o-.05)}),!1!==t.config.defaultMouseMovement&&(0,_defaultMouseMovement.default)(t),e}

},{"./defaultMouseMovement.js":1}],4:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _index=require("../../../../sutra/index.js"),_defaultTopdownMovement=_interopRequireDefault(require("../../lib/Game/defaults/defaultTopdownMovement.js")),_defaultPlatformMovement=_interopRequireDefault(require("../../lib/Game/defaults/defaultPlatformMovement.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,u=[],s=!0,l=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(u.push(r.value),u.length!==e);s=!0);}catch(t){l=!0,i=t}finally{try{if(!s&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return u}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _createForOfIteratorHelper(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var Sutra=function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).defaultMovement,n=void 0===e||e;_classCallCheck(this,t),this.id=t.id,this.inputCache={},this.inputTickCount={},this.inputDuration={},this.defaultMovement=n,this.inputsBound=!1}return _createClass(t,[{key:"init",value:function(t){this.game=t,this.game.createSutra=_index.createSutra,this.game.setSutra=this.setSutra.bind(this),this.game.setRules=this.setSutra.bind(this),this.game.systemsManager.addSystem(this.id,this);var e=this;if(this.game.on("entityInput::handleInputs",function(t,n){e.inputCache=n}),"object"===_typeof(t.rules));else{var n=(0,_index.createSutra)(t);this.setSutra(n)}this.inputsBound||(e.bindInputsToSutraConditions(),e.defaultMovement&&("topdown"===e.game.config.mode&&e.game.useSutra((0,_defaultTopdownMovement.default)(e.game),"mode-topdown"),"platform"===e.game.config.mode&&e.game.useSutra((0,_defaultPlatformMovement.default)(e.game),"mode-platform")),e.inputsBound=!0)}},{key:"bindDefaultMovementSutra",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"topdown";"topdown"===t&&this.game.useSutra((0,_defaultTopdownMovement.default)(this.game),"mode-topdown"),"platform"===t&&this.game.useSutra((0,_defaultPlatformMovement.default)(this.game),"mode-platform")}},{key:"bindInputsToSutraConditions",value:function(){this.bindKeyCodesToSutraConditions(),this.bindGamepadToSutraConditions()}},{key:"bindGamepadToSutraConditions",value:function(){var t=this;if(this.game.systems.gamepad){console.log("Binding all gamepad events to Sutra conditions...");var e=this.game.systems.gamepad.controls,n=function(e){t.game.rules.addCondition(e,function(t,n){return t.id===game.currentPlayerId&&n.input.controls[e]})};for(var r in e)n(r)}}},{key:"bindMouseCodesToSutraConditions",value:function(){}},{key:"bindKeyCodesToSutraConditions",value:function(){var t=this;if(this.game.systems.keyboard){console.log("Binding all keyboard events to Sutra conditions...");var e=this.game.systems.keyboard.controls,n=function(e){t.game.rules.addCondition(e,function(n,r){var i;return n.id===t.game.currentPlayerId&&(null===(i=r.input.keyStates[e])||void 0===i?void 0:i.down)}),t.game.rules.addCondition(e+"_UP",function(n,r){var i;return n.id===t.game.currentPlayerId&&(null===(i=r.input.keyStates[e])||void 0===i?void 0:i.up)}),t.game.rules.addCondition(e+"_HOLD",function(n,r){var i;return n.id===t.game.currentPlayerId&&(null===(i=r.input.keyStates[e])||void 0===i?void 0:i.pressed)})};for(var r in e)n(r)}}},{key:"update",value:function(){var t=this.game;if(this.inputCache){for(var e in Object.keys(this.inputCache).length>0&&(t.data.input=this.inputCache),this.inputTickCount)this.inputCache.controls&&!this.inputCache.controls[e]&&(this.inputTickCount[e]=0);for(var n in this.inputDuration)this.inputCache.controls&&!this.inputCache.controls[n]&&(this.inputDuration[n]=0);for(var r in this.inputCache.controls)!0===this.inputCache.controls[r]&&(this.inputTickCount[r]=this.inputTickCount[r]||0,this.inputTickCount[r]++),!1===this.inputCache.controls[r]&&(this.inputTickCount[r]=this.inputTickCount[r]||0,this.inputTickCount[r]=0),!0===this.inputCache.controls[r]&&(this.inputDuration[r]=this.inputDuration[r]||0,this.inputDuration[r]+=1e3/t.data.fps),!1===this.inputCache.controls[r]&&(this.inputDuration[r]=this.inputDuration[r]||0,this.inputDuration[r]=0);t.data.inputTicks=this.inputTickCount,t.data.inputDuration=this.inputDuration}t.data.camera=t.data.camera||{},t.data.camera.position=t.data.camera.position||{x:0,y:0},t.data&&t.data.input&&(t.data.input.keyStates=t.systems.keyboard.keyStates);var i,a=_createForOfIteratorHelper(t.entities.entries());try{for(a.s();!(i=a.n()).done;){var o=_slicedToArray(i.value,2),u=(o[0],o[1]);"function"==typeof u.update&&u.update(u),t.data.game=t,t.rules&&t.rules.tick(u,t.data),u.sutra&&u.sutra.tick(u,t.data)}}catch(t){a.e(t)}finally{a.f()}t.data&&t.data.collisions&&(t.data.collisions.forEach(function(e){t.rules&&t.rules.tick(e,t.data),e.bodyA.sutra&&e.bodyA.sutra.tick(e,t.data),e.bodyB.sutra&&e.bodyB.sutra.tick(e,t.data)}),t.data.collisions=t.data.collisions.filter(function(t){return"ACTIVE"===t.kind})),t.rules.emit("tick",t.data),t.data.input={},t.data.inputTicks={},t.data.inputDuration={},this.inputCache={}}},{key:"setSutra",value:function(t){this.game.rules=t,this.game.systems["gui-sutra"]&&this.game.systems["gui-sutra"].setRules(t)}},{key:"render",value:function(){}},{key:"destroy",value:function(){}}]),t}();_defineProperty(Sutra,"id","sutra");var _default=exports.default=Sutra;

},{"../../../../sutra/index.js":5,"../../lib/Game/defaults/defaultPlatformMovement.js":2,"../../lib/Game/defaults/defaultTopdownMovement.js":3}],5:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Sutra",{enumerable:!0,get:function(){return _sutra.default}}),exports.createSutra=createSutra;var _sutra=_interopRequireDefault(require("./lib/sutra.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function createSutra(){return new _sutra.default}

},{"./lib/sutra.js":15}],6:[function(require,module,exports){
"use strict";function evaluateCompositeCondition(t,e,n){var o,i=this;switch(o="function"==typeof e?e(n):e,t.op){case"and":return t.conditions.every(function(t){return i.evaluateCondition(t,o,n)});case"or":return t.conditions.some(function(t){return i.evaluateCondition(t,o,n)});case"not":return!this.evaluateCondition(t.conditions,o,n);default:return!1}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=evaluateCompositeCondition;

},{}],7:[function(require,module,exports){
"use strict";function evaluateCondition(n,t,e){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this;i="function"==typeof t?t(e):t;o.conditions;if("string"==typeof n){var r=o.conditions[n];if(r||(r=this.conditions[n]),r)return Array.isArray(r)?r.every(function(n){return"function"==typeof n.func?n.func(i,e):o.evaluateDSLCondition(n.original,i,e)}):["and","or","not"].includes(r.op)?o.evaluateCompositeCondition(r,i,e):o.evaluateSingleCondition(r,i,e)}else{if("function"==typeof n)return n(i,e);if(Array.isArray(n))return n.every(function(n){return o.evaluateCondition(n,i,e)})}return!1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=evaluateCondition;

},{}],8:[function(require,module,exports){
"use strict";function evaluateDSLCondition(e,t,r){var a,n,o=this,u=this.resolveOperator(e.op);switch(a="function"==typeof t?t(r):t,void 0===(n=e.gamePropertyPath?this.getNestedValue(r,e.gamePropertyPath):e.gameProperty?r[e.gameProperty]:a[e.property])&&(n=0),u){case"lessThan":return n<e.value;case"greaterThan":return n>e.value;case"equals":return n===e.value;case"notEquals":return n!==e.value;case"lessThanOrEqual":return n<=e.value;case"greaterThanOrEqual":return n>=e.value;case"and":return e.conditions.every(function(e){return o.evaluateDSLCondition(e,a,r)});case"or":return e.conditions.some(function(e){return o.evaluateDSLCondition(e,a,r)});case"not":return!this.evaluateDSLCondition(e.condition,a,r);default:return!1}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=evaluateDSLCondition;

},{}],9:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function evaluateSingleCondition(t,o,e){var n;if(n="function"==typeof o?o(e):o,"string"==typeof t){var i=this.conditions[t];if(i){if(["and","or","not"].includes(i.op))return this.evaluateCompositeCondition(i,n,e);if("function"==typeof i)return i(n,e);if("object"===_typeof(i.original))return this.evaluateDSLCondition(i.original,n,e)}}return"function"==typeof t&&t(n,e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=evaluateSingleCondition;

},{}],10:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exportToEnglish;var _i18n=_interopRequireDefault(require("./i18n.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var formatData=function t(e,r){return"object"!==_typeof(e)||null===e?"".concat(r).concat(e):Object.entries(e).map(function(e){var n=_slicedToArray(e,2),o=n[0],a=n[1],i="";if("function"==typeof a)i="".concat(a.name,"()");else if("object"===_typeof(a)&&null!==a){i="\n".concat(t(a,r+"  "))}else i=a;return"".concat(r).concat(o,": ").concat(i)}).join("\n")};function exportToEnglish(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",n=_i18n.default[r]||_i18n.default.en;return!this.tree||0===this.tree.length&&this.subtrees?Object.keys(this.subtrees).map(function(n){var o=t.subtrees[n];return"@".concat(n,"=>\n").concat(exportToEnglish.call(o,e+1,r))}).join("\n")+"\n":this.tree.map(function(o){return function e(o,a){var i=" ".repeat(2*a),c=(" ".repeat(2*a)," ".repeat(2*a+2)," ".repeat(2*(a+2))),u="";if(o.action)return"".concat(i).concat(o.action);if(o.if){var l;l=Array.isArray(o.if)?o.if.join(" ".concat(n.andKeyword," ")):o.if;var f="".concat(i).concat(n.ifKeyword," ").concat(l);if(o.then){var s=o.then.map(function(t){var r=e(t,a+1);return t.data&&(r+="\n".concat(formatData(t.data,c))),r}).join("\n");f+="\n".concat(s)}if(o.else){var y=o.else.map(function(t){var r=e(t,a+1);return t.data&&(r+="\n".concat(formatData(t.data,c))),r}).join("\n");f+="\n".concat(i).concat(n.elseKeyword,"\n").concat(y)}u+=f}if(o.subtree){var p=t.subtrees[o.subtree];p&&(u+="".concat(i," @").concat(o.subtree,"=>\n").concat(exportToEnglish.call(p,a+1,r)))}return 0===a&&(u+="\n"),u}(o,e)}).join("\n").concat("")+"\n"}

},{"./i18n.js":11}],11:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var languageConfig={en:{ifKeyword:"if",thenKeyword:"then",elseKeyword:"else",andKeyword:"and",subtreeKeyword:"subtree"},zh:{ifKeyword:"如果",thenKeyword:"那么",elseKeyword:"否则",andKeyword:"和",subtreeKeyword:"子树"},ja:{ifKeyword:"もし",thenKeyword:"ならば",elseKeyword:"それ以外",andKeyword:"と",subtreeKeyword:"サブツリー"}},_default=exports.default=languageConfig;

},{}],12:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default=exports.default={eq:"equals","==":"equals",neq:"notEquals","!=":"notEquals",lt:"lessThan","<":"lessThan",lte:"lessThanOrEqual","<=":"lessThanOrEqual",gt:"greaterThan",">":"greaterThan",gte:"greaterThanOrEqual",">=":"greaterThanOrEqual","&&":"and","||":"or","!":"not"};

},{}],13:[function(require,module,exports){
"use strict";function parsePath(e){return e.split(".").reduce(function(e,t){var r=t.match(/([^\[]+)(\[\d+\])?/);return r&&(e.push(r[1]),r[2]&&e.push(parseInt(r[2].replace(/[\[\]]/g,"")))),e},[])}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=parsePath;

},{}],14:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=serializeToJson;var _excluded=["parent"];function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,n=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var o,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function serializeToJson(){var e={tree:this.tree.map(function(e){return serializeNode(e)}),conditions:{}};for(var t in this.conditions)"function"==typeof this.conditions[t]&&(e.conditions[t]="object"===_typeof(this.conditions[t].original)?this.conditions[t].original:{type:"customFunction"});return JSON.stringify(e,null,2)}function serializeNode(e){e.parent;var t=_objectWithoutProperties(e,_excluded);return t.then&&Array.isArray(t.then)&&(t.then=t.then.map(function(e){return serializeNode(e)})),t.else&&Array.isArray(t.else)&&(t.else=t.else.map(function(e){return serializeNode(e)})),t}

},{}],15:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _exportToEnglish=_interopRequireDefault(require("./exportToEnglish.js")),_serializeToJson=_interopRequireDefault(require("./serializeToJson.js")),_evaluateCondition=_interopRequireDefault(require("./evaluateCondition.js")),_evaluateSingleCondition=_interopRequireDefault(require("./evaluateSingleCondition.js")),_evaluateDSLCondition=_interopRequireDefault(require("./evaluateDSLCondition.js")),_evaluateCompositeCondition=_interopRequireDefault(require("./evaluateCompositeCondition.js")),_parsePath=_interopRequireDefault(require("./parsePath.js")),_operatorAliases=_interopRequireDefault(require("./operatorAliases.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _createForOfIteratorHelper(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(s.push(i.value),s.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var logger=function(){},Sutra=function(){function t(){_classCallCheck(this,t),this.tree=[],this.conditions={},this.listeners={},this.maps={},this.state={},this.satisfiedActions={},this.satisfiedConditions={},this.operators=["equals","notEquals","greaterThan","lessThan","greaterThanOrEqual","lessThanOrEqual","and","or","not"],this.operatorAliases=_operatorAliases.default,this.exportToEnglish=_exportToEnglish.default,this.serializeToJson=_serializeToJson.default,this.toJSON=_serializeToJson.default,this.toEnglish=_exportToEnglish.default,this.evaluateCondition=_evaluateCondition.default,this.evaluateSingleCondition=_evaluateSingleCondition.default,this.evaluateDSLCondition=_evaluateDSLCondition.default,this.evaluateCompositeCondition=_evaluateCompositeCondition.default,this.parsePath=_parsePath.default,this.nodeIdCounter=0}return _createClass(t,[{key:"use",value:function(t,e){var n=this,i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.tree.length,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]);this.subtrees=this.subtrees||{},t.isSubtree=!0,t.parent=this,this.subtrees[e]=t,i&&(this.sharedListeners=!0,this.listeners=_objectSpread(_objectSpread({},this.listeners),t.listeners),this.anyListeners=[].concat(_toConsumableArray(this.anyListeners||[]),_toConsumableArray(t.anyListeners||[])),t.listeners=this.listeners,t.anyListeners=this.anyListeners),Object.entries(t.conditions).forEach(function(t){var i=_slicedToArray(t,2),r=i[0],o=i[1];n.conditions[r]&&console.warn("Condition '".concat(r,"' from subtree '").concat(e,"' will overwrite an existing condition in the main Sutra.")),n.addCondition(r,o)}),t.conditions=_objectSpread(_objectSpread({},this.conditions),t.conditions)}},{key:"on",value:function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}},{key:"emit",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var r;(this.emitLocal.apply(this,[t].concat(n)),this.isSubtree&&this.sharedListeners&&this.parent)&&(r=this.parent).emitShared.apply(r,[t].concat(n))}},{key:"emitLocal",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.listeners[t]&&this.listeners[t].forEach(function(t){return t.apply(void 0,n)}),this.anyListeners&&this.anyListeners.forEach(function(e){return e.apply(void 0,[t].concat(n))})}},{key:"emitShared",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.listeners[t]&&this.listeners[t].forEach(function(t){return t.apply(void 0,n)}),this.anyListeners&&this.anyListeners.forEach(function(e){return e.apply(void 0,[t].concat(n))}),Object.values(this.subtrees).forEach(function(e){e.listeners[t]&&e.listeners[t].forEach(function(t){return t.apply(void 0,n)}),e.anyListeners&&e.anyListeners.forEach(function(e){return e.apply(void 0,[t].concat(n))})})}},{key:"onAny",value:function(t){this.anyListeners=this.anyListeners||[],this.anyListeners.push(t)}},{key:"if",value:function(){var t=Array.from(arguments),e=this.tree.length>0?this.tree[this.tree.length-1]:null;if(e&&!e.then)Array.isArray(e.if)||(e.if=[e.if]),e.if=e.if.concat(t);else{var n={if:t.length>1?t:t[0]};n.state=this.state,n.satisfiedConditions=this.satisfiedConditions,n.satisfiedActions=this.satisfiedActions,this.addAction(n)}return this}},{key:"then",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.tree[this.tree.length-1];if(i.then||(i.then=[]),"function"==typeof t){var r={if:function(t){var n={if:t,then:[]};return n.state=e.state,n.satisfiedConditions=e.satisfiedConditions,n.satisfiedActions=e.satisfiedActions,n.sutraPath="".concat(i.sutraPath,".then[").concat(i.then.length,"]"),i.then.push(n),r},then:function(t){var n=i.then[i.then.length-1];n.state=e.state,n.satisfiedConditions=e.satisfiedConditions,n.satisfiedActions=e.satisfiedActions,n.then||(n.then=[]);var o={action:t};return o.state=e.state,o.satisfiedConditions=e.satisfiedConditions,o.satisfiedActions=e.satisfiedActions,o.sutraPath="".concat(n.sutraPath,".then[").concat(n.then.length,"]"),n.then.push(o),r},else:function(t){var n=i.then[i.then.length-1];n.state=e.state,n.satisfiedConditions=e.satisfiedConditions,n.satisfiedActions=e.satisfiedActions,n.else||(n.else=[]);var o={action:t};return o.state=e.state,o.satisfiedConditions=e.satisfiedConditions,o.satisfiedActions=e.satisfiedActions,o.sutraPath="".concat(n.sutraPath,".else[").concat(n.else.length,"]"),n.else.push(o),r},map:function(t){var e={map:t};return i.then.push(e),r}};t(r)}else{var o;this.subtrees&&(o=this.subtrees[t]);var a={};a.state=this.state,a.satisfiedConditions=this.satisfiedConditions,a.satisfiedActions=this.satisfiedActions,n&&(a.data=n),o?(i.subtree=t,delete i.then):(a.action=t,a.sutraPath="".concat(i.sutraPath,".then[").concat(i.then.length,"]"),i.then.push(a))}return this}},{key:"else",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.tree[this.tree.length-1];if(n.else||(n.else=[]),"function"==typeof t){var i={if:function(t){var e={if:t,then:[],else:[]};return n.else.push(e),i},then:function(t){var r=n.else[n.else.length-1];return r.then||(r.then=[]),r.then.push({action:t,data:e}),i},else:function(t){var r=n.else[n.else.length-1];return r.else||(r.else=[]),r.else.push({action:t,data:e}),i}};t(i)}else n.else.push({action:t,data:e});return this}},{key:"addMap",value:function(t,e){var n={map:t,func:e};this.maps[t]=n,this.generateSutraPath(n,"tree",this.tree.length-1,null)}},{key:"executeMap",value:function(t,e,n){if("function"==typeof t.func){var i=t.func(e,n);if(void 0!==i)return i}return e}},{key:"map",value:function(t){var e=this.tree[this.tree.length-1];e||(e={then:[]}),e.then||(e.then=[]);var n={map:t};return e.then.push(n),this}},{key:"addAction",value:function(t){this.tree.push(t),this.generateSutraPath(t,"tree",this.tree.length-1,null)}},{key:"addCondition",value:function(t,e){var n=this;this.originalConditions=this.originalConditions||{},Array.isArray(e)?this.conditions[t]=e.map(function(e){if("function"==typeof e)return n.originalConditions[t]=n.originalConditions[t]||[],n.originalConditions[t].push({type:"function",func:e}),{func:function(t,n){return e(t,n)},original:null};n.originalConditions[t]=n.originalConditions[t]||[],n.originalConditions[t].push(e);return{func:function(t,i){return n.evaluateDSLCondition(e,t,i)},original:e}}):this.storeSingleCondition(t,e)}},{key:"removeCondition",value:function(t){return!!this.conditions[t]&&(delete this.conditions[t],this.originalConditions&&this.originalConditions[t]&&delete this.originalConditions[t],!0)}},{key:"updateCondition",value:function(t,e){var n=this;if(!this.conditions[t])return!1;if("function"==typeof e)this.conditions[t]=e;else{if("object"!==_typeof(e))return!1;if(Array.isArray(e))e.forEach(function(e){if("and"===e.op||"or"===e.op||"not"===e.op){var i=function(t,i){return n.evaluateDSLCondition(e,t,i)};i.original=e,n.conditions[t]=i}else{var r=function(t,i){return n.evaluateDSLCondition(e,t,i)};r.original=e,n.conditions[t]=r}});else if("and"===e.op||"or"===e.op||"not"===e.op){var i=function(t,i){return n.evaluateDSLCondition(e,t,i)};i.original=e,this.conditions[t]=i}else{var r=function(t,i){return n.evaluateDSLCondition(e,t,i)};r.original=e,this.conditions[t]=r}}return this.originalConditions[t]=e,!0}},{key:"storeSingleCondition",value:function(t,e){var n=this;if("function"==typeof e&&e.original||(this.originalConditions=this.originalConditions||{},this.originalConditions[t]=e),"and"===e.op||"or"===e.op||"not"===e.op)this.conditions[t]=e,this.originalConditions[t]=e;else if("function"==typeof e)this.conditions[t]=function(t,n){var i=!1;try{i=e(t,n)}catch(t){}return i};else{var i=function(t,i){return n.evaluateDSLCondition(e,t,i)};i.original=e,this.conditions[t]=i}}},{key:"resolveOperator",value:function(t){return this.operatorAliases[t]||t}},{key:"setOperatorAlias",value:function(t,e){this.operatorAliases[t]=e}},{key:"getConditionFunction",value:function(t){return this.conditions[t]}},{key:"getCondition",value:function(t){return this.originalConditions?this.originalConditions[t]:void 0}},{key:"getOperators",value:function(){return Object.keys(this.operatorAliases)}},{key:"traverseNode",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t.subtree){var r=this.subtrees[t.subtree];r?(!t.if||this.evaluateCondition(t.if,e,n,r))&&(t.state[t.if]=!0,t.satisfiedConditions[t.if]=!0,r.tick(e,n)):console.warn("Subtree '".concat(t.subtree,"' not found."))}else{var o=i||e;if(t.map){var a=this.maps[t.map];if(!a)throw new Error('Map "'.concat(t.map,'" not found'));var s=this.executeMap(a,o,n);void 0!==s&&(i=s)}if(t.action)this.executeAction(t.action,i||o,t,n);else!t.if||this.evaluateCondition(t.if,i||o,n)?(this.state[t.if]=!0,this.satisfiedConditions[t.if]=!0,this.processBranch(t.then,i||o,n,i)):this.processBranch(t.else,i||o,n,i)}}},{key:"processBranch",value:function(t,e,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Array.isArray(t)&&t.forEach(function(t){return i.traverseNode(t,e,n,r)})}},{key:"executeAction",value:function(t,e,n,i){var r={};n.data||(n.data={});var o=e;Object.entries(o).forEach(function(t){var e=_slicedToArray(t,2),a=e[0],s=e[1];"function"==typeof s?a.includes("after")||a.includes("before")||a.includes("on")||(r[a]=s(o,i,n)):r[a]=s}),Object.entries(n.data).forEach(function(t){var e=_slicedToArray(t,2),a=e[0],s=e[1];r[a]="function"==typeof s?s(o,i,n):s});var a=r;this.state[t]=!0,this.satisfiedActions[t]=!0,this.emit(t,a,n,i)}},{key:"updateEntity",value:function(t,e,n){Object.entries(e).forEach(function(e){var n=_slicedToArray(e,2),i=n[0],r=n[1];t[i]="function"==typeof r?r():r})}},{key:"generateSutraPath",value:function(t,e,n,i){var r=this,o=-1===n?e:"".concat(e,"[").concat(n,"]");t.sutraPath=o,t.parent=i,t.then&&Array.isArray(t.then)&&t.then.forEach(function(e,n){return r.generateSutraPath(e,"".concat(o,".then"),n,t)}),t.else&&Array.isArray(t.else)&&t.else.forEach(function(e,n){return r.generateSutraPath(e,"".concat(o,".else"),n,t)})}},{key:"getNestedValue",value:function(t,e){return this.parsePath(e).reduce(function(t,e){return t&&void 0!==t[e]?t[e]:void 0},t)}},{key:"findNode",value:function(t){var e,n=this,i=_createForOfIteratorHelper(this.parsePath(t));try{for(i.s();!(e=i.n()).done;){var r=e.value;if(void 0===n[r])return;n=n[r]}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"removeNode",value:function(t){for(var e=this.parsePath(t),n=this,i=0;i<e.length-1;i++){var r=e[i];if(void 0===n[r])return;n=n[r]}var o=e[e.length-1];if(Array.isArray(n)&&"number"==typeof o){if(n.length>o){n.splice(o,1);var a=e.slice(0,-1).reduce(function(t,e,n){return 0===n?e:isNaN(e)?"".concat(t,".").concat(e):"".concat(t,"[").concat(e,"]")},"");this.updateSutraPaths(n,o,a)}}else void 0!==n[o]&&delete n[o]}},{key:"updateSutraPaths",value:function(t,e,n){for(var i=e;i<t.length;i++){var r=n.replace(/\.(\d+)(?=\[|$)/g,"[$1]");this.generateSutraPath(t[i],r,i,t[i].parent)}}},{key:"updateNode",value:function(t,e){var n=this.findNode(t);return!!n&&(Object.assign(n,e),!0)}},{key:"tick",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.tree.forEach(function(t){t.state={},t.satisfiedConditions={},t.satisfiedActions={}}),this.state={},this.satisfiedActions={},this.satisfiedConditions={};var i=!1;this.tree.forEach(function(r){r.subtree?(i=!0,e.traverseNode(r,t,n)):e.traverseNode(r,t,n)}),this.subtrees&&!i&&Object.values(this.subtrees).forEach(function(e){e.tick(t,n)})}},{key:"getSubtree",value:function(t){return this.subtrees[t]}},{key:"getReadableSutraPath",value:function(t){var e=this.findNode(t);if(!e)return"Invalid path";return function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e.parent)return n;var i=e.parent;return t(i,(i.if?"".concat(i.if):i.action?"".concat(i.action):"unknown")+(n?" and "+n:""))}(e)}}]),t}(),_default=exports.default=Sutra;

},{"./evaluateCompositeCondition.js":6,"./evaluateCondition.js":7,"./evaluateDSLCondition.js":8,"./evaluateSingleCondition.js":9,"./exportToEnglish.js":10,"./operatorAliases.js":12,"./parsePath.js":13,"./serializeToJson.js":14}]},{},[4])(4)
});
